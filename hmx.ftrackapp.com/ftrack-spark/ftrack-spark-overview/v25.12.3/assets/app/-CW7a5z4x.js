const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../overview-LRLOcrzk.js","../timezone-CfX5okG4.js","../timezone-CBjq_w_O.css","../react-redux-DXtVCp7S.js","../dashboard_menu-VJOU_9Xr.js","../AdapterDayjs-Bvi1y6ZV.js","../dnd.esm-DJdoJ469.js","../container-Bo_26EzI.js","../use_project_model-AMT5CJ0X.js","../use_project_model-CHuZ7cjf.css","../simple_selector-CUYtGXKj.js","../project_scheduler-BaQrButZ.js","../handlers-C4pvPSEu.js","../project_store_handlers-BTSSMpvV.js","../user_scheduler-YiWjA8Zy.js","../container-De-npv_P.css","../ZoomIn-y75_nB5Q.js","../KeyboardArrowLeft-9A4ABTZ8.js","../date_range_menu_button-Dw4gXrSp.js","../timerange-C5fXGiLO.js","../file_drop_container-DN36Osho.js","../overview-DxJX8a4F.css","../mytasks-BpzRvNnR.js","../report-nQUyZb76.js","../projects-C5SlQwtp.js","../systemsettings-D8I5dogA.js","../KeyboardBackspace-DPqL4OWn.js","../account-xYLw6vZI.js","../my_tasks_scheduler-D0XFZDgi.js","../ChevronLeft-By41q3Nw.js","../group_by_dialog-C1b6D7Wu.js"])))=>i.map(i=>d[i]);
import{u as H,a as Zs,b as Rr,q as Pr,r as p,c as eo,d as to,e as so,g as Qt,o as X,f as et,i as Si,h as _i,j as e,S as Ii,A as Ci,k as In,l as Mi,m as de,n as oe,E as Xt,p as F,s as Ti,t as J,C as qo,M as tt,L as Le,v as we,w as oo,x as Ar,D as We,y as x,z as je,B as Ei,F as Ne,G as Oe,H as Be,I as Ct,T as M,J as Ve,K as U,N as Lr,O as C,P as Dr,Q as Ri,R as $t,U as Or,V as ie,W as ve,X as Z,Y as zr,Z as he,_ as St,$ as Bt,a0 as Go,a1 as Pi,a2 as Ai,a3 as Li,a4 as Di,a5 as Fr,a6 as Oi,a7 as zi,a8 as D,a9 as Te,aa as Ee,ab as Fi,ac as Zt,ad as $i,ae as Ni,af as ze,ag as Ce,ah as Cn,ai as le,aj as Ko,ak as ls,al as ws,am as ue,an as Re,ao as xt,ap as Yo,aq as Wi,ar as be,as as xo,at as De,au as qs,av as Bi,aw as $r,ax as Vi,ay as Nr,az as Jo,aA as Vt,aB as _e,aC as Qo,aD as Ui,aE as no,aF as Hi,aG as qi,aH as Gi,aI as ro,aJ as ao,aK as Ut,aL as ae,aM as Xe,aN as gs,aO as Wr,aP as st,aQ as Ki,aR as Br,aS as Xo,aT as Yi,aU as Ue,aV as Ji,aW as xs,aX as Qi,aY as Kt,aZ as Xi,a_ as Nt,a$ as Zi,b0 as rt,b1 as K,b2 as Vr,b3 as Zo,b4 as Ur,b5 as Hr,b6 as Mn,b7 as el,b8 as qr,b9 as tl,ba as Gr,bb as sl,bc as ol,bd as nl,be as rl,bf as $e,bg as hs,bh as al,bi as il,bj as ll,bk as cl,bl as dl,bm as ul,bn as pl,bo as He,bp as ml,bq as Ft,br as Kr,bs as ht,bt as fl,bu as hl,bv as me,bw as ye,bx as Oo,by as Yr,bz as Jr,bA as Qr,bB as gl,bC as xl,bD as bl,bE as yl,bF as Me,bG as It,bH as en,bI as _t,bJ as cs,bK as ds,bL as us,bM as es,bN as bs,bO as Xr,bP as tn,bQ as jl,bR as kl,bS as sn,bT as Qe,bU as on,bV as W,bW as io,bX as lo,bY as wl,bZ as vl,b_ as Tn,b$ as En,c0 as Sl,c1 as _l,c2 as Zr,c3 as Il,c4 as Cl,c5 as gt,c6 as nn,c7 as ea,c8 as Ml,c9 as ta,ca as Rn,cb as co,cc as Tl,cd as $s,ce as El,cf as Rl,cg as Pl,ch as Al,ci as Pn,cj as Ll,ck as Dl,cl as Ol,cm as zl,cn as ys,co as Fl,cp as rn,cq as $l,cr as vs,cs as sa,ct as uo,cu as Jt,cv as oa,cw as Nl,cx as an,cy as Wl,cz as An,cA as na,cB as Bl,cC as Vl,cD as ra,cE as Ul,cF as pt,cG as Hl,cH as ql,cI as Gl,cJ as Kl,cK as Yl,cL as aa,cM as Jl,cN as Ql,cO as zo,cP as Gs,cQ as ia,cR as Ln,cS as Xl,cT as Zl,cU as Dn,cV as ec,cW as tc,cX as la,cY as sc,cZ as oc,c_ as nc,c$ as rc,d0 as ac,d1 as ic,d2 as lc,d3 as On,d4 as cc,d5 as dc,d6 as uc,d7 as pc,d8 as mc,d9 as fc,da as hc,db as zn,dc as gc,dd as xc,de as bc,df as yc,dg as jc,dh as kc,di as wc,dj as vc,dk as Sc,dl as _c,dm as Ic,dn as Cc,dp as Mc,dq as Tc,dr as Ec,ds as Rc,dt as Pc,du as Ac}from"../timezone-CfX5okG4.js";import{L as Lc,S as ca,A as Dc,a as Oc}from"../AdapterDayjs-Bvi1y6ZV.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"1376c2dfcf1c8ac569ab45b646dcd27fefc25e41"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="5b28efe0-c6bb-49c9-95c2-3f3be2d32338",t._sentryDebugIdIdentifier="sentry-dbid-5b28efe0-c6bb-49c9-95c2-3f3be2d32338")})()}catch{}async function zc(t,s){return(await t.call([{action:"permissions",...s}]))[0]?.data?.__create}function da({entityType:t,entityData:s}){const o=H(),n={entity_type:t,entity_data:s};return Zs({queryKey:["permissions",n],queryFn:()=>zc(o,n)})?.data??!1}const Fo=5,$o=["recent-project-ids"],Fc=Pr({queryKey:$o,staleTime:1/0,queryFn:async()=>{const t=new Date().toISOString().split("T")[0],s=Qt().serverInformation?.user_information?.id,[o,n]=await Qt().call([X.query(et({entityType:"UserApplicationState",filter:`user_id is '${s}' and key is 'recent-projects'`,projection:["value"],limit:1})),X.query(et({entityType:"Project",filter:`start_date <= "${t}" and end_date >= "${t}"`,projection:["id"],limit:Fo,orderBy:"start_date"}))]);try{const r=[];if(o.data){const a=o.data[0]?.value;return a&&r.push(...JSON.parse(a)),n.data&&r.push(...n.data.map(i=>i.id)),so(r).slice(0,Fo)}}catch(r){console.error("Failed to fetch recent projects",r)}return[]}});function $c(){const t=H(),s=t.serverInformation?.user_information?.id,{data:o}=Rr(Fc),n=p.useRef(o),r=eo(),{mutate:a}=to({mutationKey:$o,mutationFn:p.useCallback(async i=>{const l=n.current,c=so([i,...l]).slice(0,Fo);n.current=c,await t.ensure("UserApplicationState",{user_id:s,key:"recent-projects",value:JSON.stringify(c)},["user_id","key"]),l.includes(i)||r.setQueryData($o,c)},[s,r,t])});return{recentProjectIds:o,updateRecentProjects:a}}Si({apiUser:window.FT.apiUser,apiKey:window.FT.csrfToken,clientToken:window.FT.clientToken,autoConnectEventHub:window.FT.usePush!==!1,serverInformationValues:["annotation_line_sensitivity","annotation_line_style","automation_limit_days","automation_limit_size","client_ip","custom_widget","default_colors","default_module","display_task_dates_as_time","display_week_numbers","enable_account_settings","enable_new_sidebar_info_tab","enable_new_navigation","enable_new_navigation_forced","i18n_message_url_ftrack_spark_overview","intercom","is_24hr_time_enforced","is_annotation_line_setting_enabled","is_big_zoom_tools_enabled","is_multipart_upload_enabled","is_new_actions_ui_enabled","is_personal_api_key_enabled","is_prevent_media_download_enabled","is_prevent_asset_upload_enabled","is_review_allow_share_links_settings_available","is_review_require_passphrase_settings_available","is_review_watermarking_settings_available","isScopeEnabled","is_smooth_annotations_enabled","is_two_factor_authentication_enabled","is_two_factor_authentication_enforced","license","max_automations","mixpanel","preferred_language","product","review_sync","review_pro","spark_sentry_dsn","status_progress","subscriptionBillingUrl","userpilot","user_information","version_number_padding","week_startday","workday_length","workspace_timezone","require_billing_info_before","review_spacebar_action","review_toolbar_appearance","use_workspace_timezone_enabled"],applicationId:"ftrack.web-studio"});function Nc({children:t}){const{context:s,handleContinueEditing:o,handleDiscard:n}=_i();return e.jsxs(Ii.Provider,{value:s,children:[t,e.jsxs(Ci,{value:"sidebar",children:[e.jsx(In,{variant:"primary"}),e.jsx(In,{variant:"secondary"})]}),e.jsx(Mi,{open:!!s.prompt,handleContinueEditing:o,handleDiscard:n})]})}const Wc=F({"error-message":{id:"ftrack-spark.components.ext.error-message",description:"Generic error message when Ext components fail",defaultMessage:"An unexpected error has occurred. Please reload the page and try again. If the problem persists, please contact support."}});function Fn({children:t}){const{FT:s}=de(),o=oe();return e.jsx(Xt,{FallbackComponent:()=>null,onError:n=>{s.notifyError(o.formatMessage(Wc["error-message"])),Ti(n)},children:t})}const Bc=J(e.jsx("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"})),Vc=J(e.jsx("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5M2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1m18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1M11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1m0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1M5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0z"})),ua=J([e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M7.35 18.5C8.66 17.56 10.26 17 12 17s3.34.56 4.65 1.5c-1.31.94-2.91 1.5-4.65 1.5s-3.34-.56-4.65-1.5m10.79-1.38C16.45 15.8 14.32 15 12 15s-4.45.8-6.14 2.12C4.7 15.73 4 13.95 4 12c0-4.42 3.58-8 8-8s8 3.58 8 8c0 1.95-.7 3.73-1.86 5.12"},"0"),e.jsx("path",{d:"M12 6c-1.93 0-3.5 1.57-3.5 3.5S10.07 13 12 13s3.5-1.57 3.5-3.5S13.93 6 12 6m0 5c-.83 0-1.5-.67-1.5-1.5S11.17 8 12 8s1.5.67 1.5 1.5S12.83 11 12 11"},"1")]),pa=J(e.jsx("path",{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25z"})),Uc=J(e.jsx("path",{d:"M15 4v7H5.17L4 12.17V4zm1-2H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1m5 4h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1"})),ma=J(e.jsx("path",{d:"M13.25 16.74c0 .69-.53 1.26-1.25 1.26-.7 0-1.26-.56-1.26-1.26 0-.71.56-1.25 1.26-1.25.71 0 1.25.55 1.25 1.25M11.99 6c-1.77 0-2.98 1.15-3.43 2.49l1.64.69c.22-.67.74-1.48 1.8-1.48 1.62 0 1.94 1.52 1.37 2.33-.54.77-1.47 1.29-1.96 2.16-.39.69-.31 1.49-.31 1.98h1.82c0-.93.07-1.12.22-1.41.39-.72 1.11-1.06 1.87-2.17.68-1 .42-2.36-.02-3.08-.51-.84-1.52-1.51-3-1.51M19 5H5v14h14zm0-2c1.1 0 2 .9 2 2v14c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2z"})),Hc=J(e.jsx("path",{d:"M16 14v3H8v-7c0-2.21 1.79-4 4-4 .85 0 1.64.26 2.28.72l1.43-1.43c-.64-.51-1.39-.88-2.21-1.09v-.7c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.7C7.91 4.86 6 7.21 6 10v7H4v2h16v-2h-2v-3zm-4 8c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2M24 8h-3V5h-2v3h-3v2h3v3h2v-3h3z"})),qc=J(e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2m0-15.5c2.49 0 4 2.02 4 4.5v.1l2 2V11c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68c-.24.06-.47.15-.69.23l1.64 1.64c.18-.02.36-.05.55-.05M5.41 3.35 4 4.76l2.81 2.81C6.29 8.57 6 9.74 6 11v5l-2 2v1h14.24l1.74 1.74 1.41-1.41zM16 17H8v-6c0-.68.12-1.32.34-1.9L16 16.76z"})),Gc=J(e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2m6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5z"})),Kc=J([e.jsx("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM15 20H6c-.55 0-1-.45-1-1v-1h10zm4-1c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),e.jsx("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")]),Yc=J([e.jsx("path",{d:"M19.03 3.56c-1.67-1.39-3.74-2.3-6.03-2.51v2.01c1.73.19 3.31.88 4.61 1.92zM11 3.06V1.05c-2.29.2-4.36 1.12-6.03 2.51l1.42 1.42C7.69 3.94 9.27 3.25 11 3.06M4.98 6.39 3.56 4.97C2.17 6.64 1.26 8.71 1.05 11h2.01c.19-1.73.88-3.31 1.92-4.61M20.94 11h2.01c-.21-2.29-1.12-4.36-2.51-6.03l-1.42 1.42c1.04 1.3 1.73 2.88 1.92 4.61M7 12l3.44 1.56L12 17l1.56-3.44L17 12l-3.44-1.56L12 7l-1.56 3.44z"},"0"),e.jsx("path",{d:"M12 21c-3.11 0-5.85-1.59-7.46-4H7v-2H1v6h2v-2.7c1.99 2.84 5.27 4.7 9 4.7 4.87 0 9-3.17 10.44-7.56l-1.96-.45C19.25 18.48 15.92 21 12 21"},"1")]),Jc=J([e.jsx("path",{d:"M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1m0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5z"},"0"),e.jsx("path",{d:"M17.5 10.5c.88 0 1.73.09 2.5.26V9.24c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99M13 12.49v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26V11.9c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.3-4.5.83m4.5 1.84c-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26v-1.52c-.79-.16-1.64-.24-2.5-.24"},"1")]),Qc=J(e.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"})),fa=J(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),Xc=J(e.jsx("path",{d:"m10 17 5-5-5-5z"})),Zc=({expandOn:t,action:s})=>t==="click"?e.jsx(Ar,{"aria-label":"moreicon",onClick:s,sx:{"&.MuiSvgIcon-root":{fontSize:"fontSizeLarge"}}}):e.jsx(Xc,{sx:{"& .MuiSvgIcon-root":{height:20,width:20}}}),ed=({subMenuItems:t,mainMenuItem:s,startIcon:o,itemLabel:n,onClose:r,selected:a,expandOn:i="hover",onClick:l=()=>null})=>{const[c,u]=p.useState(!1),d=p.useRef(null),m=p.useCallback(()=>u(!0),[]),h=p.useCallback(()=>{u(!1)},[]);return e.jsx(qo,{onClickAway:h,mouseEvent:"onClick",children:e.jsxs(tt,{ref:d,sx:[c&&{backgroundColor:"action.hover"},{pr:1}],onMouseEnter:i==="hover"?()=>m():()=>{},onMouseLeave:i==="hover"?()=>h():()=>{},selected:a,onClick:l,children:[e.jsx(Le,{children:o}),e.jsx(we,{children:n}),e.jsx(Zc,{"aria-label":"more",action:()=>{m()},expandOn:i}),e.jsx(oo,{TransitionProps:{onExited:()=>d.current?.focus()},disableRestoreFocus:!0,sx:{pointerEvents:"none","& .MuiList-root":{pointerEvents:"auto"},"& .MuiMenuItem-root":{gap:1,py:.25}},anchorEl:d.current,open:c,onClose:h,anchorOrigin:{horizontal:"right",vertical:"top"},children:t.map(f=>e.jsx(Ze,{onClick:()=>f?.onClick?.(s),itemLabel:f.itemLabel,startIcon:f.startIcon,onClose:r},f.key))})]})})},ha=p.createContext(null),td=({children:t})=>{const[s,o]=p.useState(null),n=p.useMemo(()=>l=>new Promise(c=>{o({config:l,resolve:c})}),[]),r=p.useCallback(l=>{s&&(s.resolve(l),o(null))},[s]),a=p.useCallback(()=>r(!1),[r]),i=p.useCallback(()=>r(!0),[r]);return e.jsxs(ha.Provider,{value:{showConfirmation:n},children:[t,e.jsx(We,{open:!!s,children:s?.config.content({confirm:i,cancel:a})})]})},sd=()=>{const t=p.useContext(ha);if(!t)throw new Error("useConfirmationDialog must be used within a ConfirmationDialogProvider");return t},ce=F({"help-center":{id:"ftrack-spark-components.account-menu-list-items.help-center",defaultMessage:"Help center"},"developer-hub":{id:"ftrack-spark-components.account-menu-list-items.developer-hub",defaultMessage:"Developer hub"},"api-reference":{id:"ftrack-spark-components.account-menu-list-items.api-reference",defaultMessage:"API reference"},"contact-us":{id:"ftrack-spark-components.account-menu-list-items.contact-us",defaultMessage:"Contact us"},"desktop-notifications-off":{id:"ftrack-spark-components.account-menu-list-items.desktop-notifications-off",defaultMessage:"Desktop notifications off"},"desktop-notifications-on":{id:"ftrack-spark-components.account-menu-list-items.desktop-notifications-on",defaultMessage:"Desktop notifications on"},"desktop-notifications":{id:"ftrack-spark-components.account-menu-list-items.desktop-notifications",defaultMessage:"Desktop notifications"},"log-out":{id:"ftrack-spark-components.account-menu-list-items.log-out",defaultMessage:"Log out"},"my-account":{id:"ftrack-spark-components.account-menu-list-items.my-account",defaultMessage:"My Account"},"subscription-and-billing":{id:"ftrack-spark-components.account-menu-list-items.subscription-and-billing",defaultMessage:"Subscription and billing"},"switch-theme":{id:"ftrack-spark-components.account-menu-list-items.switch-theme",defaultMessage:"Switch theme"},"system-settings":{id:"ftrack-spark-components.account-menu-list-items.system-settings",defaultMessage:"System settings"},"upgrade-to-review-pro":{id:"ftrack-spark-components.account-menu-list-items.upgrade-to-review-pro",defaultMessage:"Upgrade to Review Pro"},"whats-new":{id:"ftrack-spark-components.account-menu-list-items.whats-new",defaultMessage:"What's new"},help:{id:"ftrack-spark-components.account-menu-list-items.help",defaultMessage:"Help"},cancel:{id:"ftrack-spark-components.account-menu-list-items.cancel",defaultMessage:"Cancel"},reload:{id:"ftrack-spark-components.account-menu-list-items.reload",defaultMessage:"Reload"},"switch-theme-dialog-content":{id:"ftrack-spark-components.account-menu-list-items.switch-theme-dialog-content",defaultMessage:"Your preference has been updated. Do you want to reload the page to apply the changes? Any unsaved changes will be lost."},"reset-navigation":{id:"ftrack-spark-components.account-menu-list-items.reset-navigation",defaultMessage:"Opt out of new navigation"},"opt-out-dialog-title":{id:"ftrack-spark-components.account-menu-list-items.opt-out-dialog-title",defaultMessage:"Opt out of new navigation"},"opt-out-dialog-content-main":{id:"ftrack-spark-components.account-menu-list-items.opt-out-dialog-content-main",defaultMessage:"You can always opt back in from the account menu."},"opt-out-dialog-content-description":{id:"ftrack-spark-components.account-menu-list-items.opt-out-dialog-content-description",defaultMessage:"Opting out opens a feedback form where you can share your thoughts on the new navigation experience."},"opt-out":{id:"ftrack-spark-components.account-menu-list-items.opt-out",defaultMessage:"Opt out and provide feedback"}}),od=[{itemLabel:e.jsx(x,{...ce["help-center"]}),startIcon:e.jsx(ma,{}),onClick:()=>window.open("https://www.ftrack.com/help-studio","_blank"),key:"help-center"},{itemLabel:e.jsx(x,{...ce["developer-hub"]}),startIcon:e.jsx(Qc,{}),onClick:()=>window.open("https://developer.ftrack.com","_blank"),key:"developer-hub"},{itemLabel:e.jsx(x,{...ce["api-reference"]}),startIcon:e.jsx(Jc,{}),onClick:()=>window.FT.util.generateApiReference(),key:"api-reference"},{itemLabel:e.jsx(x,{...ce["contact-us"]}),startIcon:e.jsx(Uc,{}),onClick:()=>window.FT.util.openZendeskBot(),key:"contact-us"}],nd=({onClose:t})=>{const{FT:s}=de(),o=H(),{showConfirmation:n}=sd(),r=o.serverInformation?.enable_new_navigation_forced,a=p.useCallback(async()=>{await n({content:({confirm:l,cancel:c})=>e.jsx(ad,{confirm:l,cancel:c})})&&(await o.ensure("EntitySetting",{parent_id:s.getUserId(),parent_type:"User",group:"BETA",name:"enable_new_navigation",value:"false"},["parent_id","group","name"]),window.open("https://docs.google.com/forms/d/e/1FAIpQLSdNNM7XvB2OpYRm7GlqQe8P_gtwS2JzbhB7Tc1WBwNrWR_jJw/viewform","_blank"),window.location.reload())},[n,o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{onClick:()=>window.location.href="/login/logout",itemLabel:e.jsx(x,{...ce["log-out"]}),startIcon:e.jsx(Bc,{}),onClose:t},"log-out"),e.jsx(je,{variant:"middle"}),r?null:e.jsx(Ze,{onClick:a,itemLabel:e.jsx(x,{...ce["reset-navigation"]}),startIcon:e.jsx(Yc,{}),onClose:t},"navigation-flag"),e.jsx(rd,{}),s?.isAuth("CONFIGURE")?e.jsx(ld,{onClose:t}):null,s.tour.Tour.getWhatsNewTourId()?e.jsx(Ze,{onClick:()=>Ei({id:s.tour.Tour.getWhatsNewTourId(),force:!0}),itemLabel:e.jsx(x,{...ce["whats-new"]}),startIcon:e.jsx(pa,{}),onClose:t},"whats-new"):null,e.jsx(id,{onClose:t}),e.jsx(ed,{subMenuItems:od,itemLabel:e.jsx(x,{...ce.help}),startIcon:e.jsx(ma,{}),onClose:t},"help"),e.jsx(Ze,{onClick:()=>Ne({view:"account_settings_override",itemId:"me",slideEntityId:"",slideEntityType:""}),itemLabel:e.jsx(x,{...ce["my-account"]}),startIcon:e.jsx(ua,{}),onClose:t},"my-account")]})},rd=()=>{const[t,s]=p.useState(!1),{FT:o}=de(),n=H(),r=()=>{const a=o.getThemeStylesheet(),i=o.getUserId();a.id||(a.id="ft-theme-stylesheet");let l;o?.getCurrentTheme(a)==="light"?l="dark":l="light",n.ensure("EntitySetting",{parent_id:i,parent_type:"User",group:"DEFAULT",name:"theme",value:l},["parent_id","group","name"]),s(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{onClick:r,startIcon:e.jsx(Vc,{}),itemLabel:e.jsx(x,{...ce["switch-theme"]})},"switch-theme"),e.jsxs(We,{open:t,children:[e.jsx(Oe,{children:e.jsx(x,{...ce["switch-theme"]})}),e.jsx(Be,{children:e.jsx(Ct,{children:e.jsx(x,{...ce["switch-theme-dialog-content"]})})}),e.jsxs(Ve,{children:[e.jsx(U,{color:"neutral",onClick:()=>s(!1),children:e.jsx(x,{...ce.cancel})}),e.jsx(U,{color:"primary",onClick:()=>window.location.reload(),children:e.jsx(x,{...ce.reload})})]})]})]})},Ze=({startIcon:t,itemLabel:s,onClick:o,disabled:n,onClose:r})=>{const a=p.useCallback(i=>{o?.(),r?.(i),i.stopPropagation()},[r,o]);return e.jsxs(tt,{onClick:a,disabled:n,sx:{height:32,"&.MuiMenuItem-root .MuiListItemIcon-root":{minWidth:t?20:0}},children:[e.jsx(Le,{children:t}),e.jsx(we,{children:s})]})},ad=({confirm:t,cancel:s})=>e.jsxs(e.Fragment,{children:[e.jsx(Oe,{children:e.jsx(x,{...ce["opt-out-dialog-title"]})}),e.jsx(Be,{children:e.jsxs(Ct,{children:[e.jsx(M,{gutterBottom:!0,children:e.jsx(x,{...ce["opt-out-dialog-content-main"]})}),e.jsx(x,{...ce["opt-out-dialog-content-description"]})]})}),e.jsxs(Ve,{children:[e.jsx(U,{color:"neutral",onClick:s,children:e.jsx(x,{...ce.cancel})}),e.jsx(U,{color:"primary",onClick:t,endIcon:e.jsx(fa,{}),children:e.jsx(x,{...ce["opt-out"]})})]})]}),id=({onClose:t})=>{const{FT:s}=de();let o;const n=s?.Notification.getPermission();switch(n){case 2:o={itemLabel:e.jsx(x,{...ce["desktop-notifications-off"]}),startIcon:e.jsx(qc,{})};break;case 0:o={itemLabel:e.jsx(x,{...ce["desktop-notifications-on"]}),startIcon:e.jsx(Gc,{})};break;default:o={itemLabel:e.jsx(x,{...ce["desktop-notifications"]}),startIcon:e.jsx(Hc,{})};break}return p.createElement(Ze,{...o,onClick:()=>s?.Notification.requestPermission(),disabled:n!==1,key:"desktop-notifications",onClose:t})},ld=({onClose:t})=>{const{FT:s}=de(),o=H(),n=!0,r=o.serverInformation?.subscriptionBillingUrl,a=o.serverInformation?.review_pro.display_upsell_cta;return e.jsxs(e.Fragment,{children:[e.jsxs(e.Fragment,{children:[e.jsx(Ze,{onClick:()=>r?window.open(r,"_blank"):Ne({itemId:"newconfigure",view:"account"}),itemLabel:e.jsx(x,{...ce["subscription-and-billing"]}),startIcon:e.jsx(Kc,{}),onClose:t},"subscription-and-billing"),e.jsx(je,{variant:"middle"})]}),a&&(r||n)?e.jsx(Ze,{onClick:()=>s?.util.showUpgradeToReviewProDialog(),itemLabel:e.jsx(x,{...ce["upgrade-to-review-pro"]}),startIcon:e.jsx(pa,{}),onClose:t},"upgrade-to-review-pro"):null,e.jsx(Ze,{onClick:p.useCallback(()=>Ne({view:"about",itemId:"newconfigure",slideEntityId:"",slideEntityType:""}),[]),itemLabel:e.jsx(x,{...ce["system-settings"]}),startIcon:e.jsx(Lr,{}),onClose:t},"system-settings")]})},cd=F({account:{description:"Fallback label for account settings menu.",defaultMessage:"Account",id:"KBjmjC"}}),dd=({isDrawerCollapsed:t})=>{const s=H()?.serverInformation?.user_information,o=oe(),n=s?.first_name&&s.last_name?s?.first_name+" "+s?.last_name:o.formatMessage(cd.account),[r,a]=p.useState(!1),i=p.useRef(null),l=()=>{a(!0)},c=()=>{a(!1)};return e.jsxs(C,{sx:{px:t?0:1.5,py:1,width:"100%",borderTop:t?"none":"1px solid",borderColor:t?"transparent":"other.outlineBorder"},ref:i,children:[e.jsxs(U,{endIcon:e.jsx($t,{in:!t,orientation:"horizontal",timeout:900,sx:{height:24},children:e.jsx(Or,{sx:{transform:r?"rotate(180deg)":"rotate(0deg)"}})}),color:"neutral",disableFocusRipple:!0,disableTouchRipple:!0,disableRipple:!0,sx:{color:"text.primary",px:.5,textTransform:"capitalize",fontWeight:"fontWeightRegular",minWidth:t?52:64,maxWidth:"100%",width:"auto",justifycontent:"flex-start"},onClick:l,children:[e.jsx(Dr,{alt:n,src:s?.thumbnail_id?s?.thumbnail_url:void 0,sx:{mr:t?0:1.5,bgcolor:s?.thumbnail_id&&s?.thumbnail_url?"transparent":"blue.main",color:"blue.contrastText",fontSize:"fontSizeXsmall",fontWeight:"fontWeightMedium",height:24,width:24,textAlign:"center",border:"none"},children:typeof n=="string"?Ri(n):""}),e.jsx($t,{in:!t,orientation:"horizontal",sx:{"& .MuiCollapse-wrapperInner":{width:"100%"}},children:e.jsx(M,{sx:{whiteSpace:"nowrap",textOverflow:"ellipsis",display:"block",overflow:"hidden"},children:n})})]}),e.jsx(oo,{anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},sx:{"& .MuiList-root":{py:1},"& .MuiMenuItem-root":{gap:1,px:2,py:.25,height:32},"& .MuiListItemIcon-root .MuiSvgIcon-root":{height:20,width:20},"& .MuiListItemText-root .MuiTypography-root":{fontSize:"fontSizeRegular"}},anchorEl:i.current,open:r,onClose:c,MenuListProps:{dense:!0},id:"accounts-menu",children:e.jsx(nd,{onClose:c})})]})};function ud({url:t,...s}){return e.jsx(ie,{disableRipple:!0,sx:{p:0},...s,children:e.jsx(C,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",border:"1px solid",borderColor:"other.outlineBorder",borderRadius:.5,backgroundColor:"transparent",overflow:"hidden"},children:t?e.jsx("img",{src:t,alt:"Company logo",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4}}):e.jsx("img",{src:Lc,alt:"ftrack logo",style:{width:"100%",height:"100%",objectFit:"contain"}})})})}const pd=F({search:{id:"ftrack-spark-components.navigation-header.search",defaultMessage:"Search"}}),md=({isDrawerCollapsed:t})=>{const{FT:s,isReady:o}=de(),{data:n}=ve({name:"company_custom_logo",entityType:"SettingComponent",projection:["name","thumbnail_url"],filter:'group is "EXPORT" and name is "export_logo"',staleTime:1/0}),{data:r}=ve({name:"company_custom_logo",entityType:"Setting",projection:["value"],filter:'group is "EXPORT" and name is "export_name"',staleTime:1/0}),a=r?.[0]?.value,i=n?.[0]?.thumbnail_url?.url,c=H().serverInformation?.default_module??"home";return e.jsxs(C,{sx:{display:"flex",justifyContent:t?"center":"space-between",alignItems:"center",p:"18px 14px",borderBottom:"1px solid",borderColor:"other.outlineBorder"},children:[e.jsxs(C,{sx:{display:t?"none":"flex",alignItems:"center",gap:"7px",overflow:"hidden"},children:[e.jsx(ud,{url:i,onClick:p.useCallback(()=>Ne({slideEntityId:"",slideEntityType:"",dashboardId:"",itemId:c}),[c])}),a&&e.jsx(M,{sx:{textWrap:"nowrap",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"120px"},children:a})]}),e.jsx(Z,{title:e.jsx(x,{...pd.search}),placement:"right",children:e.jsx(ie,{sx:{color:"text.secondary",cursor:"pointer"},onClick:p.useCallback(()=>o&&s.action.fn.showSearch(),[s,o]),children:e.jsx(zr,{})})})]})},ga=J(e.jsx("path",{d:"m12 2-5.5 9h11zm0 3.84L13.93 9h-3.87zM17.5 13c-2.49 0-4.5 2.01-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.01 4.5-4.5-2.01-4.5-4.5-4.5m0 7c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5M3 21.5h8v-8H3zm2-6h4v4H5z"})),xa=J(e.jsx("path",{d:"M16.59 7.58 10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),ln=J(e.jsx("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2"})),bo=F({overview:{id:"ftrack-spark-components.navigation-list.overview",defaultMessage:"Overview"},"my-tasks":{id:"ftrack-spark-components.navigation-list.my-tasks",defaultMessage:"My tasks"},reports:{id:"ftrack-spark-components.navigation-list.reports",defaultMessage:"Reports"}}),fd=t=>{Ne({itemId:t,dashboardId:"",slideEntityId:"",slideEntityType:"",view:"",entityId:"",entityType:"",objectType:""})},hd=[{icon:e.jsx(ga,{}),text:e.jsx(x,{...bo.overview}),itemId:"overview",permission:"ACCESS_OVERVIEW"},{icon:e.jsx(xa,{}),text:e.jsx(x,{...bo["my-tasks"]}),itemId:"home",permission:"HOME"},{icon:e.jsx(ln,{}),text:e.jsx(x,{...bo.reports}),itemId:"report",permission:"REPORTS"}],gd=({isDrawerCollapsed:t})=>{const s=he("itemId"),o=p.useMemo(()=>hd.map(r=>{const a=s===r.itemId?"primary.main":"text.primary";return window.FT?.isAuth(r.permission)?e.jsx(xd,{item:r,handleNavigation:()=>fd(r.itemId),activeColor:a,isDrawerCollapsed:t},"main_navigation_"+r.itemId):null}),[s,t]),n=p.useMemo(()=>o.filter(r=>r!==null).length>0,[o]);return e.jsx(St,{sx:{display:"flex",flexDirection:"column",borderBottom:n?"1px solid":"none",borderColor:"other.outlineBorder",px:0,py:n?1.5:0,overflow:"hidden",overflowY:"auto",minHeight:"max-content"},children:o})},xd=({isDrawerCollapsed:t,item:s,activeColor:o,handleNavigation:n})=>e.jsx(Z,{title:s.text,placement:"right",children:e.jsx(Bt,{sx:{p:t?"auto":"0px 15px 0px 24px",height:"37px",transition:"width 0.5s ease","&:hover":{bgcolor:"action.hover",cursor:"pointer"}},children:e.jsxs(Go,{disableRipple:!0,onClick:()=>n(s.itemId),sx:{p:0,gap:1,"&:hover":{bgcolor:"transparent"}},children:[e.jsx(Le,{sx:{minWidth:0,color:o},children:s.icon}),!t&&e.jsx(we,{primary:s.text,sx:{fontWeight:"fontWeightMedium",textWrap:"nowrap"},primaryTypographyProps:{color:o}})]})})}),ba=J(e.jsx("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7zm4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2m-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2"})),bd=J(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"})),cn=J(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),yd=J(e.jsx("path",{d:"m7 14 5-5 5 5z"})),ya=({title:t,onClose:s,placeholder:o,searchTooltip:n,actionTooltip:r,NavAccordionContent:a,isActionVisible:i,onActionClick:l,sx:c,listSx:u,isInsideNav:d=!0,id:m,filterItems:h})=>{const f=localStorage.getItem(`ftrack-is-${m}-collapsed`),b=f?!JSON.parse(f):!0,[g,y]=p.useState(b),[j,w]=p.useState(!1),[v,I]=p.useState(""),[E,L]=p.useState(""),_=p.useCallback(S=>{I(S.target.value)},[]),R=p.useCallback(S=>{L(S)},[]),k=p.useCallback(()=>{j&&(w(!1),I("")),s?.()},[j,s]);return e.jsx(St,{id:m,sx:{display:"flex",overflowY:"hidden",flexDirection:"column",overflowX:"hidden",p:0,pt:1,...c},subheader:e.jsx(qo,{onClickAway:k,children:e.jsxs(C,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",mx:1,mb:.5,"&:hover":{backgroundColor:j?"transparent":"rgba(255, 255, 255, 0.08)",borderRadius:j?"none":"8px"}},onClick:()=>{!j&&d&&y(S=>(localStorage.setItem(`ftrack-is-${m}-collapsed`,S.toString()),!S))},children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center",width:"100%",height:"32px",px:j?0:1,fontSize:"small",bgcolor:"transparent",overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",pr:.5},children:[j&&e.jsx(ca,{disableClose:!0,iconColor:"text.primary",debounce:500,placeholder:o,onChange:_,onReset:()=>w(!1),onKeyDown:S=>{S.key==="Escape"&&(S.stopPropagation(),w(!1),I(""))},filterItems:h?.map(({title:S,disabled:A,filter:z},P)=>e.jsx(tt,{disabled:A,onClick:()=>R(z),selected:!A&&z===E,children:S},P)),sx:{height:32,borderColor:"other.standardFieldLine",borderRadius:"8px",backgroundColor:"action.selected","& .MuiButtonBase-root":{width:24,height:24},"& input::placeholder":{color:"text.secondary"},"& .MuiSvgIcon-root":{color:"text.secondary"}}}),!j&&e.jsxs(e.Fragment,{children:[e.jsx(Pi,{component:"div",sx:{fontSize:"small",pl:.5,pr:0,bgcolor:"transparent"},children:t}),d&&(g?e.jsx(yd,{sx:{color:"text.secondary",width:16,height:16}}):e.jsx(Ai,{sx:{color:"text.secondary",width:16,height:16}}))]})]}),e.jsxs(C,{sx:{display:"flex",pr:.5},children:[e.jsx($n,{className:"action-icon","data-testid":`search-${m}`,onClick:S=>{S.stopPropagation(),y(!0),w(!0)},icon:e.jsx(Z,{title:n,disableInteractive:!0,children:e.jsx(bd,{sx:{color:"text.secondary",width:16,height:16}})}),isActive:j,sx:{display:j?"none":"block"}}),i&&e.jsx($n,{className:"action-icon","data-testid":`add-to-${m}`,isActive:j,icon:e.jsx(Z,{title:r,disableInteractive:!0,placement:"right",children:e.jsx(cn,{sx:{color:"text.secondary",width:16,height:16}})}),onClick:S=>{S.stopPropagation(),l?.()}})]})]})}),children:e.jsx($t,{in:d?g:!0,timeout:"auto",sx:{mx:1,overflowY:"auto",...u},children:e.jsx(a,{isSearchActive:j,searchValue:v,filterValue:E})})})},$n=({className:t,isActive:s,icon:o,onClick:n,...r})=>e.jsx(ie,{className:t,size:"small",onClick:n,...r,children:o}),jd=Li({memoize:Di,memoizeOptions:{maxSize:1,equalityCheck:Object.is}}),ee=(t,s,o,n,r,a,i,l,...c)=>{if(c.length>0)throw new Error("Unsupported number of selectors");let u;if(t&&s&&o&&n&&r&&a&&i&&l)u=(d,m,h,f)=>{const b=t(d,m,h,f),g=s(d,m,h,f),y=o(d,m,h,f),j=n(d,m,h,f),w=r(d,m,h,f),v=a(d,m,h,f),I=i(d,m,h,f);return l(b,g,y,j,w,v,I,m,h,f)};else if(t&&s&&o&&n&&r&&a&&i)u=(d,m,h,f)=>{const b=t(d,m,h,f),g=s(d,m,h,f),y=o(d,m,h,f),j=n(d,m,h,f),w=r(d,m,h,f),v=a(d,m,h,f);return i(b,g,y,j,w,v,m,h,f)};else if(t&&s&&o&&n&&r&&a)u=(d,m,h,f)=>{const b=t(d,m,h,f),g=s(d,m,h,f),y=o(d,m,h,f),j=n(d,m,h,f),w=r(d,m,h,f);return a(b,g,y,j,w,m,h,f)};else if(t&&s&&o&&n&&r)u=(d,m,h,f)=>{const b=t(d,m,h,f),g=s(d,m,h,f),y=o(d,m,h,f),j=n(d,m,h,f);return r(b,g,y,j,m,h,f)};else if(t&&s&&o&&n)u=(d,m,h,f)=>{const b=t(d,m,h,f),g=s(d,m,h,f),y=o(d,m,h,f);return n(b,g,y,m,h,f)};else if(t&&s&&o)u=(d,m,h,f)=>{const b=t(d,m,h,f),g=s(d,m,h,f);return o(b,g,m,h,f)};else if(t&&s)u=(d,m,h,f)=>{const b=t(d,m,h,f);return s(b,m,h,f)};else if(t)u=t;else throw new Error("Missing arguments");return u},kd=t=>(...s)=>{const o=new WeakMap;let n=1;const r=s[s.length-1],a=s.length-1||1,i=Math.max(r.length-a,0);if(i>3)throw new Error("Unsupported number of arguments");return(c,u,d,m)=>{let h=c.__cacheKey__;h||(h={id:n},c.__cacheKey__=h,n+=1);let f=o.get(h);if(!f){const b=s.length===1?[j=>j,r]:s;let g=s;const y=[void 0,void 0,void 0];switch(i){case 0:break;case 1:{g=[...b.slice(0,-1),()=>y[0],r];break}case 2:{g=[...b.slice(0,-1),()=>y[0],()=>y[1],r];break}case 3:{g=[...b.slice(0,-1),()=>y[0],()=>y[1],()=>y[2],r];break}default:throw new Error("Unsupported number of arguments")}f=jd(...g),f.selectorArgs=y,o.set(h,f)}switch(i){case 3:f.selectorArgs[2]=m;case 2:f.selectorArgs[1]=d;case 1:f.selectorArgs[0]=u}switch(i){case 0:return f(c);case 1:return f(c,u);case 2:return f(c,u,d);case 3:return f(c,u,d,m);default:throw new Error("unreachable")}}},Ss=kd();var yo={exports:{}},jo={},ko={exports:{}},wo={};var Nn;function wd(){if(Nn)return wo;Nn=1;var t=Fr();function s(m,h){return m===h&&(m!==0||1/m===1/h)||m!==m&&h!==h}var o=typeof Object.is=="function"?Object.is:s,n=t.useState,r=t.useEffect,a=t.useLayoutEffect,i=t.useDebugValue;function l(m,h){var f=h(),b=n({inst:{value:f,getSnapshot:h}}),g=b[0].inst,y=b[1];return a(function(){g.value=f,g.getSnapshot=h,c(g)&&y({inst:g})},[m,f,h]),r(function(){return c(g)&&y({inst:g}),m(function(){c(g)&&y({inst:g})})},[m]),i(f),f}function c(m){var h=m.getSnapshot;m=m.value;try{var f=h();return!o(m,f)}catch{return!0}}function u(m,h){return h()}var d=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:l;return wo.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:d,wo}var Wn;function vd(){return Wn||(Wn=1,ko.exports=wd()),ko.exports}var Bn;function Sd(){if(Bn)return jo;Bn=1;var t=Fr(),s=vd();function o(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var n=typeof Object.is=="function"?Object.is:o,r=s.useSyncExternalStore,a=t.useRef,i=t.useEffect,l=t.useMemo,c=t.useDebugValue;return jo.useSyncExternalStoreWithSelector=function(u,d,m,h,f){var b=a(null);if(b.current===null){var g={hasValue:!1,value:null};b.current=g}else g=b.current;b=l(function(){function j(L){if(!w){if(w=!0,v=L,L=h(L),f!==void 0&&g.hasValue){var _=g.value;if(f(_,L))return I=_}return I=L}if(_=I,n(v,L))return _;var R=h(L);return f!==void 0&&f(_,R)?(v=L,_):(v=L,I=R)}var w=!1,v,I,E=m===void 0?null:m;return[function(){return j(d())},E===null?void 0:function(){return j(E())}]},[d,m,h,f]);var y=r(u,b[0],b[1]);return i(function(){g.hasValue=!0,g.value=y},[y]),c(y),y},jo}var Vn;function _d(){return Vn||(Vn=1,yo.exports=Sd()),yo.exports}var Id=_d();function ne(t,s,o,n,r){const a=i=>s(i,o,n,r);return Id.useSyncExternalStoreWithSelector(t.subscribe,t.getSnapshot,t.getSnapshot,a)}const Cd=()=>{};function Md(t,s,o){const n=Oi(Td,{store:t,selector:s}).current;n.effect=o,zi(n.onMount)}function Td(t){const{store:s,selector:o}=t;let n=o(s.state);const r={effect:Cd,dispose:null,subscribe:()=>{r.dispose??=s.subscribe(a=>{const i=o(a);if(!Object.is(n,i)){const l=n;n=i,r.effect(l,i)}})},onMount:()=>(r.subscribe(),()=>{r.dispose?.(),r.dispose=null})};return r.subscribe(),r}class dn{static create(s){return new dn(s)}constructor(s){this.state=s,this.listeners=new Set,this.updateTick=0}subscribe=s=>(this.listeners.add(s),()=>{this.listeners.delete(s)});getSnapshot=()=>this.state;setState(s){this.state=s,this.updateTick+=1;const o=this.updateTick,n=this.listeners.values();let r;for(;r=n.next(),!r.done;){if(o!==this.updateTick)return;const a=r.value;a(s)}}update(s){for(const o in s)if(!Object.is(this.state[o],s[o])){this.setState(D({},this.state,s));return}}set(s,o){Object.is(this.state[s],o)||this.setState(D({},this.state,{[s]:o}))}}function Ed(t){return Te("MuiRichTreeView",t)}Ee("MuiRichTreeView",["root","item","itemContent","itemGroupTransition","itemIconContainer","itemLabel","itemCheckbox","itemLabelInput"]);function ja(t){return Fi}const Un={};function js(t,s){const o=p.useRef(Un);return o.current===Un&&(o.current=t(s)),o}function No(t,s,o,n){const r=js(Rd).current;return Pd(r,t,s,o,n)&&Ad(r,[t,s,o,n]),r.callback}function Rd(){return{callback:null,cleanup:null,refs:[]}}function Pd(t,s,o,n,r){return t.refs[0]!==s||t.refs[1]!==o||t.refs[2]!==n||t.refs[3]!==r}function Ad(t,s){if(t.refs=s,s.every(o=>o==null)){t.callback=null;return}t.callback=o=>{if(t.cleanup&&(t.cleanup(),t.cleanup=null),o!=null){const n=Array(s.length).fill(null);for(let r=0;r<s.length;r+=1){const a=s[r];if(a!=null)switch(typeof a){case"function":{const i=a(o);typeof i=="function"&&(n[r]=i);break}case"object":{a.current=o;break}}}t.cleanup=()=>{for(let r=0;r<s.length;r+=1){const a=s[r];if(a!=null)switch(typeof a){case"function":{const i=n[r];typeof i=="function"?i():a(null);break}case"object":{a.current=null;break}}}}}}}class Ld{maxListeners=20;warnOnce=!1;events={};on(s,o,n={}){let r=this.events[s];r||(r={highPriority:new Map,regular:new Map},this.events[s]=r),n.isFirst?r.highPriority.set(o,!0):r.regular.set(o,!0)}removeListener(s,o){this.events[s]&&(this.events[s].regular.delete(o),this.events[s].highPriority.delete(o))}removeAllListeners(){this.events={}}emit(s,...o){const n=this.events[s];if(!n)return;const r=Array.from(n.highPriority.keys()),a=Array.from(n.regular.keys());for(let i=r.length-1;i>=0;i-=1){const l=r[i];n.highPriority.has(l)&&l.apply(this,o)}for(let i=0;i<a.length;i+=1){const l=a[i];n.regular.has(l)&&l.apply(this,o)}}once(s,o){const n=this;this.on(s,function r(...a){n.removeListener(s,r),o.apply(n,a)})}}const Dd=t=>t.isPropagationStopped!==void 0,ka=()=>{const[t]=p.useState(()=>new Ld),s=p.useCallback((...n)=>{const[r,a,i={}]=n;i.defaultMuiPrevented=!1,!(Dd(i)&&i.isPropagationStopped())&&t.emit(r,a,i)},[t]),o=p.useCallback((n,r)=>(t.on(n,r),()=>{t.removeListener(n,r)}),[t]);return{instance:{$$publishEvent:s,$$subscribeEvent:o}}};ka.params={};const wa=({plugins:t})=>{const s=new Set(t);return{instance:{getAvailablePlugins:()=>s}}};wa.params={};const po={treeId:ee(t=>t.id.treeId)};let Hn=0;const Od=()=>(Hn+=1,`mui-tree-view-${Hn}`),un=({id:t,treeId:s="",itemId:o})=>t??`${s}-${o}`,pn=({params:t,store:s})=>{p.useEffect(()=>{const n=s.state.id;t.id===n.providedTreeId&&n.treeId!==void 0||s.set("id",D({},n,{treeId:t.id??Od()}))},[s,t.id]);const o=ne(s,po.treeId);return{getRootProps:()=>({id:o})}};pn.params={id:!0};pn.getInitialState=({id:t})=>({id:{treeId:void 0,providedTreeId:t}});const zd=[ka,wa,pn],Fd=["apiRef"],$d=t=>{let{props:{apiRef:s},plugins:o}=t,n=Zt(t.props,Fd);const r=p.useMemo(()=>{const l={};return o.forEach(c=>{Object.assign(l,c.params)}),l},[o]),{forwardedProps:a,pluginParams:i}=p.useMemo(()=>{const l={},c={};Object.keys(n).forEach(d=>{const m=n[d];r[d]?l[d]=m:c[d]=m});const u=o.reduce((d,m)=>m.applyDefaultValuesToParams?m.applyDefaultValuesToParams({params:d}):d,l);return{forwardedProps:c,pluginParams:u}},[o,n,r]);return{forwardedProps:a,pluginParams:i,apiRef:s}},Nd=t=>{const{plugins:s,instance:o,publicAPI:n,store:r,rootRef:a}=t,i=p.useCallback(u=>{let d=null,m=null;const h=[],f={};s.forEach(y=>{if(!y.itemPlugin)return;const j=y.itemPlugin({props:u,rootRef:d,contentRef:m});j?.rootRef&&(d=j.rootRef),j?.contentRef&&(m=j.contentRef),j?.propsEnhancers&&(h.push(j.propsEnhancers),Object.keys(j.propsEnhancers).forEach(w=>{f[w]=!0}))});const b=y=>j=>{const w={};return h.forEach(v=>{const I=v[y];I!=null&&Object.assign(w,I(j))}),w},g=Object.fromEntries(Object.keys(f).map(y=>[y,b(y)]));return{contentRef:m,rootRef:d,propsEnhancers:g}},[s]),l=p.useCallback(({itemId:u,children:d,idAttribute:m})=>{let h=d;for(let f=s.length-1;f>=0;f-=1){const b=s[f];b.wrapItem&&(h=b.wrapItem({instance:o,itemId:u,children:h,idAttribute:m}))}return h},[s,o]),c=p.useCallback(({children:u})=>{let d=u;for(let m=s.length-1;m>=0;m-=1){const h=s[m];h.wrapRoot&&(d=h.wrapRoot({children:d}))}return d},[s]);return p.useMemo(()=>({runItemPlugins:i,wrapItem:l,wrapRoot:c,instance:o,publicAPI:n,store:r,rootRef:a}),[i,l,c,o,n,r,a])};function Wd(t){return t.current==null&&(t.current={}),t}function Bd(t){const s=p.useRef({});return t?Wd(t):s}const Vd=({plugins:t,rootRef:s,props:o})=>{const n=p.useMemo(()=>[...zd,...t],[t]),{pluginParams:r,forwardedProps:a,apiRef:i}=$d({plugins:n,props:o}),l=js(()=>({})).current,c=Bd(i),u=p.useRef(null),d=No(u,s),m=js(()=>{const y={};for(const j of n)j.getInitialState&&Object.assign(y,j.getInitialState(r));return new dn(y)}).current,h=Nd({plugins:n,instance:l,publicAPI:c.current,store:m,rootRef:u}),f=[],b=y=>{const j=y({instance:l,params:r,rootRef:u,plugins:n,store:m});j.getRootProps&&f.push(j.getRootProps),j.publicAPI&&Object.assign(c.current,j.publicAPI),j.instance&&Object.assign(l,j.instance)};return n.forEach(b),{getRootProps:(y={})=>{const j=D({role:"tree"},a,y,{ref:d});return f.forEach(w=>{Object.assign(j,w(y))}),j},rootRef:d,contextValue:h}},va=p.createContext(null),Ht=()=>{const t=p.useContext(va);if(t==null)throw new Error(["MUI X: Could not find the Tree View context.","It looks like you rendered your component outside of a SimpleTreeView or RichTreeView parent component.","This can also happen if you are bundling multiple versions of the Tree View."].join(`
`));return t},Sa=p.createContext({classes:{},slots:{},slotProps:{}}),_a=()=>p.useContext(Sa),vo={};function Ud(t){const{contextValue:s,classes:o=vo,slots:n=vo,slotProps:r=vo,children:a}=t,i=p.useMemo(()=>({classes:o,slots:{collapseIcon:n.collapseIcon,expandIcon:n.expandIcon,endIcon:n.endIcon},slotProps:{collapseIcon:r.collapseIcon,expandIcon:r.expandIcon,endIcon:r.endIcon}}),[o,n.collapseIcon,n.expandIcon,n.endIcon,r.collapseIcon,r.expandIcon,r.endIcon]);return e.jsx(va.Provider,{value:s,children:e.jsx(Sa.Provider,{value:i,children:s.wrapRoot({children:a})})})}const So=$i[`useInsertionEffect${Math.random().toFixed(1)}`.slice(0,-3)],Hd=So&&So!==p.useLayoutEffect?So:t=>t();function Pe(t){const s=js(qd).current;return s.next=t,Hd(s.effect),s.trampoline}function qd(){const t={next:void 0,callback:Gd,trampoline:(...s)=>t.callback?.(...s),effect:()=>{t.callback=t.next}};return t}function Gd(){}const ot="__TREE_VIEW_ROOT_PARENT_ID__",Kd=t=>{const s={};return t.forEach((o,n)=>{s[o]=n}),s},Ks=(t,s)=>{if(s==null)return!1;let o=t[s];if(!o)return!1;if(o.disabled)return!0;for(;o.parentId!=null;){if(o=t[o.parentId],!o)return!1;if(o.disabled)return!0}return!1};function Ia(t){const{config:s,items:o,disabledItemsFocusable:n}=t,r={},a={},i={},l={};function c(u,d,m){const h=d??ot,{metaLookup:f,modelLookup:b,orderedChildrenIds:g,childrenIndexes:y,itemsChildren:j}=Ca({config:s,items:u,parentId:d,depth:m,isItemExpandable:(w,v)=>!!v&&v.length>0,otherItemsMetaLookup:r});Object.assign(r,f),Object.assign(a,b),i[h]=g,l[h]=y;for(const w of j)c(w.children||[],w.id,m+1)}return c(o,null,0),{disabledItemsFocusable:n,itemMetaLookup:r,itemModelLookup:a,itemOrderedChildrenIdsLookup:i,itemChildrenIndexesLookup:l,domStructure:"nested"}}function Ca(t){const{config:s,items:o,parentId:n,depth:r,isItemExpandable:a,otherItemsMetaLookup:i}=t,l={},c={},u=[],d=[],m=h=>{const f=s.getItemId?s.getItemId(h):h.id;Yd({id:f,parentId:n,item:h,itemMetaLookup:i,siblingsMetaLookup:l});const b=s.getItemLabel?s.getItemLabel(h):h.label;if(b==null)throw new Error(["MUI X: The Tree View component requires all items to have a `label` property.","Alternatively, you can use the `getItemLabel` prop to specify a custom label for each item.","An item was provided without label in the `items` prop:",JSON.stringify(h)].join(`
`));const g=(s.getItemChildren?s.getItemChildren(h):h.children)||[];d.push({id:f,children:g}),c[f]=h,l[f]={id:f,label:b,parentId:n,idAttribute:void 0,expandable:a(h,g),disabled:s.isItemDisabled?s.isItemDisabled(h):!1,depth:r},u.push(f)};for(const h of o)m(h);return{metaLookup:l,modelLookup:c,orderedChildrenIds:u,childrenIndexes:Kd(u),itemsChildren:d}}function Yd({id:t,parentId:s,item:o,itemMetaLookup:n,siblingsMetaLookup:r}){if(t==null)throw new Error(["MUI X: The Tree View component requires all items to have a unique `id` property.","Alternatively, you can use the `getItemId` prop to specify a custom id for each item.","An item was provided without id in the `items` prop:",JSON.stringify(o)].join(`
`));if(r[t]!=null||n[t]!=null&&n[t].parentId!==s)throw new Error(["MUI X: The Tree View component requires all items to have a unique `id` property.","Alternatively, you can use the `getItemId` prop to specify a custom id for each item.",`Two items were provided with the same id in the \`items\` prop: "${t}"`].join(`
`))}const Ma=p.createContext(()=>-1),Jd=[],$={domStructure:ee(t=>t.items.domStructure),disabledItemFocusable:ee(t=>t.items.disabledItemsFocusable),itemMetaLookup:ee(t=>t.items.itemMetaLookup),itemOrderedChildrenIdsLookup:ee(t=>t.items.itemOrderedChildrenIdsLookup),itemMeta:ee((t,s)=>t.items.itemMetaLookup[s??ot]??null),itemOrderedChildrenIds:ee((t,s)=>t.items.itemOrderedChildrenIdsLookup[s??ot]??Jd),itemModel:ee((t,s)=>t.items.itemModelLookup[s]),isItemDisabled:ee((t,s)=>Ks(t.items.itemMetaLookup,s)),itemIndex:ee((t,s)=>{const o=t.items.itemMetaLookup[s];return o==null?-1:t.items.itemChildrenIndexesLookup[o.parentId??ot][o.id]}),itemParentId:ee((t,s)=>t.items.itemMetaLookup[s]?.parentId??null),itemDepth:ee((t,s)=>t.items.itemMetaLookup[s]?.depth??0),canItemBeFocused:ee((t,s)=>t.items.disabledItemsFocusable||!Ks(t.items.itemMetaLookup,s))},_s=({instance:t,params:s,store:o})=>{const n=p.useMemo(()=>({isItemDisabled:s.isItemDisabled,getItemLabel:s.getItemLabel,getItemChildren:s.getItemChildren,getItemId:s.getItemId}),[s.isItemDisabled,s.getItemLabel,s.getItemChildren,s.getItemId]),r=p.useCallback(j=>$.itemModel(o.state,j),[o]),a=p.useCallback(j=>$.itemMeta(o.state,j)?.parentId||null,[o]),i=Pe(({itemId:j,shouldBeDisabled:w})=>{if(!o.state.items.itemMetaLookup[j])return;const v=D({},o.state.items.itemMetaLookup);v[j]=D({},v[j],{disabled:w??!v[j].disabled}),o.set("items",D({},o.state.items,{itemMetaLookup:v}))}),l=p.useCallback(()=>{const j=w=>{const v=$.itemModel(o.state,w),I=D({},v),E=$.itemOrderedChildrenIds(o.state,w);return E.length>0?I.children=E.map(j):delete I.children,I};return $.itemOrderedChildrenIds(o.state,null).map(j)},[o]),c=p.useCallback(j=>$.itemOrderedChildrenIds(o.state,j),[o]),u=j=>{const w=$.itemMeta(o.state,j);if(w==null)return null;const v=un({treeId:po.treeId(o.state),itemId:j,id:w.idAttribute});return document.getElementById(v)},d=p.useRef(!1),m=p.useCallback(()=>{d.current=!0},[]),h=p.useCallback(()=>d.current,[]),f=({items:j,parentId:w,getChildrenCount:v})=>{const I=w??ot,E=w==null?-1:$.itemDepth(o.state,w),{metaLookup:L,modelLookup:_,orderedChildrenIds:R,childrenIndexes:k}=Ca({config:n,items:j,parentId:w,depth:E+1,isItemExpandable:v?A=>v(A)>0:()=>!1,otherItemsMetaLookup:$.itemMetaLookup(o.state)}),S={itemModelLookup:D({},o.state.items.itemModelLookup,_),itemMetaLookup:D({},o.state.items.itemMetaLookup,L),itemOrderedChildrenIdsLookup:D({},o.state.items.itemOrderedChildrenIdsLookup,{[I]:R}),itemChildrenIndexesLookup:D({},o.state.items.itemChildrenIndexesLookup,{[I]:k})};o.set("items",D({},o.state.items,S))},b=Pe(j=>{const w=Object.keys(o.state.items.itemMetaLookup).reduce((L,_)=>{const R=o.state.items.itemMetaLookup[_];return R.parentId===j?L:D({},L,{[R.id]:R})},{}),v=D({},o.state.items.itemOrderedChildrenIdsLookup),I=D({},o.state.items.itemChildrenIndexesLookup),E=j??ot;delete I[E],delete v[E],o.set("items",D({},o.state.items,{itemMetaLookup:w,itemOrderedChildrenIdsLookup:v,itemChildrenIndexesLookup:I}))}),g=Pe(j=>{const w=D({},o.state.items.itemMetaLookup);for(const v of j)w[v]=D({},w[v],{expandable:!0});o.set("items",D({},o.state.items,{itemMetaLookup:w}))});p.useEffect(()=>{if(t.areItemUpdatesPrevented())return;const j=Ia({disabledItemsFocusable:s.disabledItemsFocusable,items:s.items,config:n});o.set("items",D({},o.state.items,j))},[t,o,s.items,s.disabledItemsFocusable,n]);const y=Pe((j,w)=>{s.onItemClick&&s.onItemClick(j,w)});return{getRootProps:()=>({style:{"--TreeView-itemChildrenIndentation":typeof s.itemChildrenIndentation=="number"?`${s.itemChildrenIndentation}px`:s.itemChildrenIndentation}}),publicAPI:{getItem:r,getItemDOMElement:u,getItemTree:l,getItemOrderedChildrenIds:c,setIsItemDisabled:i,getParentId:a},instance:{getItemDOMElement:u,preventItemUpdates:m,areItemUpdatesPrevented:h,setItemChildren:f,removeChildren:b,addExpandableItems:g,handleItemClick:y}}};_s.getInitialState=t=>({items:Ia({items:t.items,disabledItemsFocusable:t.disabledItemsFocusable,config:{isItemDisabled:t.isItemDisabled,getItemId:t.getItemId,getItemLabel:t.getItemLabel,getItemChildren:t.getItemChildren}})});_s.applyDefaultValuesToParams=({params:t})=>D({},t,{disabledItemsFocusable:t.disabledItemsFocusable??!1,itemChildrenIndentation:t.itemChildrenIndentation??"12px"});_s.wrapRoot=({children:t})=>e.jsx(Ma.Provider,{value:$.itemDepth,children:t});_s.params={disabledItemsFocusable:!0,items:!0,isItemDisabled:!0,getItemLabel:!0,getItemChildren:!0,getItemId:!0,onItemClick:!0,itemChildrenIndentation:!0};const Ta=()=>{},Qd=()=>{},Ys=typeof document<"u"?p.useLayoutEffect:Qd,_o=Ss(t=>t.expansion.expandedItems,t=>{const s=new Map;return t.forEach(o=>{s.set(o,!0)}),s}),pe={expandedItemsRaw:ee(t=>t.expansion.expandedItems),expandedItemsMap:_o,flatList:Ss($.itemOrderedChildrenIdsLookup,_o,(t,s)=>{function o(n){if(!s.has(n))return[n];const r=[n],a=t[n]||[];for(const i of a)r.push(...o(i));return r}return(t[ot]??[]).flatMap(o)}),triggerSlot:ee(t=>t.expansion.expansionTrigger),isItemExpanded:ee(_o,(t,s)=>t.has(s)),isItemExpandable:ee($.itemMeta,(t,s)=>t?.expandable??!1)},Ea=({isItemEditable:t,expansionTrigger:s})=>s||(t?"iconContainer":"content"),Xd=(t,s,o)=>{t.$$publishEvent(s,o)},mo=({instance:t,store:s,params:o})=>{Ta({controlled:o.expandedItems,defaultValue:o.defaultExpandedItems}),Ys(()=>{const u=Ea({isItemEditable:o.isItemEditable,expansionTrigger:o.expansionTrigger});s.state.expansion.expansionTrigger!==u&&s.set("expansion",D({},s.state.expansion,{expansionTrigger:u}))},[s,o.isItemEditable,o.expansionTrigger]);const n=(u,d)=>{o.expandedItems===void 0&&s.set("expansion",D({},s.state.expansion,{expandedItems:d})),o.onExpandedItemsChange?.(u,d)},r=Pe(()=>{n(null,[])}),a=Pe(({itemId:u,event:d,shouldBeExpanded:m})=>{const h=pe.expandedItemsRaw(s.state);let f;m?f=[u].concat(h):f=h.filter(b=>b!==u),o.onItemExpansionToggle&&o.onItemExpansionToggle(d,u,m),n(d,f)}),i=Pe(({itemId:u,event:d=null,shouldBeExpanded:m})=>{const h=pe.isItemExpanded(s.state,u),f=m??!h;if(h===f)return;const b={isExpansionPrevented:!1,shouldBeExpanded:f,event:d,itemId:u};Xd(t,"beforeItemToggleExpansion",b),!b.isExpansionPrevented&&t.applyItemExpansion({itemId:u,event:d,shouldBeExpanded:f})}),l=Pe(u=>pe.isItemExpanded(s.state,u)),c=(u,d)=>{const m=$.itemMeta(s.state,d);if(m==null)return;const f=$.itemOrderedChildrenIds(s.state,m.parentId).filter(g=>pe.isItemExpandable(s.state,g)&&!pe.isItemExpanded(s.state,g)),b=pe.expandedItemsRaw(s.state).concat(f);f.length>0&&(o.onItemExpansionToggle&&f.forEach(g=>{o.onItemExpansionToggle(u,g,!0)}),n(u,b))};return Ys(()=>{const u=o.expandedItems;u!==void 0&&s.set("expansion",D({},s.state.expansion,{expandedItems:u}))},[s,o.expandedItems]),{publicAPI:{setItemExpansion:i,isItemExpanded:l},instance:{setItemExpansion:i,applyItemExpansion:a,expandAllSiblings:c,resetItemExpansion:r}}},Zd=[];mo.applyDefaultValuesToParams=({params:t})=>D({},t,{defaultExpandedItems:t.defaultExpandedItems??Zd});mo.getInitialState=t=>({expansion:{expandedItems:t.expandedItems===void 0?t.defaultExpandedItems:t.expandedItems,expansionTrigger:Ea(t)}});mo.params={expandedItems:!0,defaultExpandedItems:!0,onExpandedItemsChange:!0,onItemExpansionToggle:!0,expansionTrigger:!0};const Wo=(t,s)=>{let o=s.length-1;for(;o>=0&&!$.canItemBeFocused(t,s[o]);)o-=1;if(o!==-1)return s[o]},Ra=(t,s)=>{const o=$.itemMeta(t,s);if(!o)return null;const n=$.itemOrderedChildrenIds(t,o.parentId),r=$.itemIndex(t,s);if(r===0)return o.parentId;let a=r-1;for(;!$.canItemBeFocused(t,n[a])&&a>=0;)a-=1;if(a===-1)return o.parentId==null?null:Ra(t,o.parentId);let i=n[a],l=Wo(t,$.itemOrderedChildrenIds(t,i));for(;pe.isItemExpanded(t,i)&&l!=null;)i=l,l=Wo(t,$.itemOrderedChildrenIds(t,i));return i},Ns=(t,s)=>{if(pe.isItemExpanded(t,s)){const n=$.itemOrderedChildrenIds(t,s).find(r=>$.canItemBeFocused(t,r));if(n!=null)return n}let o=$.itemMeta(t,s);for(;o!=null;){const n=$.itemOrderedChildrenIds(t,o.parentId),r=$.itemIndex(t,o.id);if(r<n.length-1){let a=r+1;for(;!$.canItemBeFocused(t,n[a])&&a<n.length-1;)a+=1;if($.canItemBeFocused(t,n[a]))return n[a]}o=$.itemMeta(t,o.parentId)}return null},Pa=t=>{let s=null;for(;s==null||pe.isItemExpanded(t,s);){const o=$.itemOrderedChildrenIds(t,s),n=Wo(t,o);if(n==null)return s;s=n}return s},Js=t=>$.itemOrderedChildrenIds(t,null).find(s=>$.canItemBeFocused(t,s)),Aa=(t,s,o)=>{if(s===o)return[s,o];const n=$.itemMeta(t,s),r=$.itemMeta(t,o);if(!n||!r)return[s,o];if(n.parentId===r.id||r.parentId===n.id)return r.parentId===n.id?[n.id,r.id]:[r.id,n.id];const a=[n.id],i=[r.id];let l=n.parentId,c=r.parentId,u=i.indexOf(l)!==-1,d=a.indexOf(c)!==-1,m=!0,h=!0;for(;!d&&!u;)m&&(a.push(l),u=i.indexOf(l)!==-1,m=l!==null,!u&&m&&(l=$.itemParentId(t,l))),h&&!u&&(i.push(c),d=a.indexOf(c)!==-1,h=c!==null,!d&&h&&(c=$.itemParentId(t,c)));const f=u?l:c,b=$.itemOrderedChildrenIds(t,f),g=a[a.indexOf(f)-1],y=i[i.indexOf(f)-1];return b.indexOf(g)<b.indexOf(y)?[s,o]:[o,s]},eu=(t,s,o)=>{const n=c=>{if(pe.isItemExpandable(t,c)&&pe.isItemExpanded(t,c))return $.itemOrderedChildrenIds(t,c)[0];let u=$.itemMeta(t,c);for(;u!=null;){const d=$.itemOrderedChildrenIds(t,u.parentId),m=$.itemIndex(t,u.id);if(m<d.length-1)return d[m+1];u=u.parentId?$.itemMeta(t,u.parentId):null}throw new Error("Invalid range")},[r,a]=Aa(t,s,o),i=[r];let l=r;for(;l!==a;)l=n(l),$.isItemDisabled(t,l)||i.push(l);return i},tu=t=>{let s=Js(t);const o=[];for(;s!=null;)o.push(s),s=Ns(t,s);return o},Bo=(t,s)=>s!==t.closest('*[role="treeitem"]'),La=Ss(t=>t.selection.selectedItems,t=>Array.isArray(t)?t:t!=null?[t]:[]),qn=Ss(La,t=>{const s=new Map;return t.forEach(o=>{s.set(o,!0)}),s}),se={selectedItemsRaw:ee(t=>t.selection.selectedItems),selectedItems:La,selectedItemsMap:qn,enabled:ee(t=>t.selection.isEnabled),isMultiSelectEnabled:ee(t=>t.selection.isMultiSelectEnabled),isCheckboxSelectionEnabled:ee(t=>t.selection.isCheckboxSelectionEnabled),propagationRules:ee(t=>t.selection.selectionPropagation),isItemSelected:ee(qn,(t,s)=>t.has(s)),canItemBeSelected:ee($.isItemDisabled,t=>t.selection.isEnabled,(t,s,o)=>s&&!t)},Ws=t=>{const s={};return t.forEach(o=>{s[o]=!0}),s},Da=({store:t,oldModel:s,newModel:o})=>{const n=new Map;return o.forEach(r=>{n.set(r,!0)}),{added:o.filter(r=>!se.isItemSelected(t.state,r)),removed:s.filter(r=>!n.has(r))}},su=({store:t,selectionPropagation:s,newModel:o,oldModel:n,additionalItemsToPropagate:r})=>{if(!s.descendants&&!s.parents)return o;let a=!1;const i=Ws(o),l=Da({store:t,newModel:o,oldModel:n});return r?.forEach(c=>{i[c]?l.added.includes(c)||l.added.push(c):l.removed.includes(c)||l.removed.push(c)}),l.added.forEach(c=>{if(s.descendants){const u=d=>{d!==c&&(a=!0,i[d]=!0),$.itemOrderedChildrenIds(t.state,d).forEach(u)};u(c)}if(s.parents){const u=m=>i[m]?$.itemOrderedChildrenIds(t.state,m).every(u):!1,d=m=>{const h=$.itemParentId(t.state,m);if(h==null)return;$.itemOrderedChildrenIds(t.state,h).every(u)&&(a=!0,i[h]=!0,d(h))};d(c)}}),l.removed.forEach(c=>{if(s.parents){let u=$.itemParentId(t.state,c);for(;u!=null;)i[u]&&(a=!0,delete i[u]),u=$.itemParentId(t.state,u)}if(s.descendants){const u=d=>{d!==c&&(a=!0,delete i[d]),$.itemOrderedChildrenIds(t.state,d).forEach(u)};u(c)}}),a?Object.keys(i):o},ou=ee((t,s)=>{if(se.isItemSelected(t,s))return"checked";let o=!1,n=!1;const r=i=>{i!==s&&(se.isItemSelected(t,i)?o=!0:n=!0),$.itemOrderedChildrenIds(t,i).forEach(r)};return r(s),se.propagationRules(t).parents?o&&n?"indeterminate":o&&!n?"checked":"empty":o?"indeterminate":"empty"}),nu=({props:t})=>{const{itemId:s}=t,{store:o}=Ht(),n=ne(o,se.isCheckboxSelectionEnabled),r=ne(o,se.canItemBeSelected,s),a=ne(o,ou,s),i=ne(o,se.canItemBeSelected,s);return{propsEnhancers:{root:()=>{let l;return a==="checked"?l=!0:a==="indeterminate"?l="mixed":i?l=!1:l=void 0,{"aria-checked":l}},checkbox:({externalEventHandlers:l,interactions:c})=>({tabIndex:-1,onChange:d=>{l.onChange?.(d),!d.defaultMuiPrevented&&se.canItemBeSelected(o.state,s)&&c.handleCheckboxSelection(d)},visible:n,disabled:!r,checked:a==="checked",indeterminate:a==="indeterminate"})}}},Is=({store:t,params:s})=>{Ta({controlled:s.selectedItems,defaultValue:s.defaultSelectedItems});const o=p.useRef(null),n=p.useRef({}),r=(h,f,b)=>{const g=se.selectedItemsRaw(t.state);let y;const j=se.isMultiSelectEnabled(t.state);if(j&&(s.selectionPropagation.descendants||s.selectionPropagation.parents)?y=su({store:t,selectionPropagation:s.selectionPropagation,newModel:f,oldModel:g,additionalItemsToPropagate:b}):y=f,s.onItemSelectionToggle)if(j){const w=Da({store:t,newModel:y,oldModel:g});s.onItemSelectionToggle&&(w.added.forEach(v=>{s.onItemSelectionToggle(h,v,!0)}),w.removed.forEach(v=>{s.onItemSelectionToggle(h,v,!1)}))}else s.onItemSelectionToggle&&y!==g&&(g!=null&&s.onItemSelectionToggle(h,g,!1),y!=null&&s.onItemSelectionToggle(h,y,!0));s.selectedItems===void 0&&t.set("selection",D({},t.state.selection,{selectedItems:y})),s.onSelectedItemsChange?.(h,y)},a=({itemId:h,event:f=null,keepExistingSelection:b=!1,shouldBeSelected:g})=>{if(!se.enabled(t.state))return;let y;const j=se.isMultiSelectEnabled(t.state);if(b){const w=se.selectedItems(t.state),v=se.isItemSelected(t.state,h);v&&(g===!1||g==null)?y=w.filter(I=>I!==h):!v&&(g===!0||g==null)?y=[h].concat(w):y=w}else g===!1||g==null&&se.isItemSelected(t.state,h)?y=j?[]:null:y=j?[h]:h;r(f,y,[h]),o.current=h,n.current={}},i=(h,[f,b])=>{if(!se.isMultiSelectEnabled(t.state))return;let y=se.selectedItems(t.state).slice();Object.keys(n.current).length>0&&(y=y.filter(I=>!n.current[I]));const j=Ws(y),w=eu(t.state,f,b),v=w.filter(I=>!j[I]);y=y.concat(v),r(h,y),n.current=Ws(w)},l=(h,f)=>{if(o.current!=null){const[b,g]=Aa(t.state,f,o.current);i(h,[b,g])}},c=(h,f)=>{i(h,[Js(t.state),f])},u=(h,f)=>{i(h,[f,Pa(t.state)])},d=h=>{if(!se.isMultiSelectEnabled(t.state))return;const b=tu(t.state);r(h,b),n.current=Ws(b)},m=(h,f,b)=>{if(!se.isMultiSelectEnabled(t.state))return;let y=se.selectedItems(t.state).slice();Object.keys(n.current).length===0?(y.push(b),n.current={[f]:!0,[b]:!0}):(n.current[f]||(n.current={}),n.current[b]?(y=y.filter(j=>j!==f),delete n.current[f]):(y.push(b),n.current[b]=!0)),r(h,y)};return Ys(()=>{t.set("selection",{selectedItems:s.selectedItems===void 0?t.state.selection.selectedItems:s.selectedItems,isEnabled:!s.disableSelection,isMultiSelectEnabled:s.multiSelect,isCheckboxSelectionEnabled:s.checkboxSelection,selectionPropagation:{descendants:s.selectionPropagation.descendants,parents:s.selectionPropagation.parents}})},[t,s.selectedItems,s.multiSelect,s.checkboxSelection,s.disableSelection,s.selectionPropagation.descendants,s.selectionPropagation.parents]),{getRootProps:()=>({"aria-multiselectable":s.multiSelect}),publicAPI:{setItemSelection:a},instance:{setItemSelection:a,selectAllNavigableItems:d,expandSelectionRange:l,selectRangeFromStartToItem:c,selectRangeFromItemToEnd:u,selectItemFromArrowNavigation:m}}};Is.itemPlugin=nu;const ru=[],au={};Is.applyDefaultValuesToParams=({params:t})=>D({},t,{disableSelection:t.disableSelection??!1,multiSelect:t.multiSelect??!1,checkboxSelection:t.checkboxSelection??!1,defaultSelectedItems:t.defaultSelectedItems??(t.multiSelect?ru:null),selectionPropagation:t.selectionPropagation??au});Is.getInitialState=t=>({selection:{selectedItems:t.selectedItems===void 0?t.defaultSelectedItems:t.selectedItems,isEnabled:!t.disableSelection,isMultiSelectEnabled:t.multiSelect,isCheckboxSelectionEnabled:t.checkboxSelection,selectionPropagation:t.selectionPropagation}});Is.params={disableSelection:!0,multiSelect:!0,checkboxSelection:!0,defaultSelectedItems:!0,selectedItems:!0,onSelectedItemsChange:!0,onItemSelectionToggle:!0,selectionPropagation:!0};const Gn=Ss(se.selectedItems,pe.expandedItemsMap,$.itemMetaLookup,$.disabledItemFocusable,t=>$.itemOrderedChildrenIds(t,null),(t,s,o,n,r)=>{const a=t.find(l=>{if(!n&&Ks(o,l))return!1;const c=o[l];return c&&(c.parentId==null||s.has(c.parentId))});if(a!=null)return a;const i=r.find(l=>n||!Ks(o,l));return i??null}),zt={defaultFocusableItemId:Gn,isItemTheDefaultFocusableItem:ee(Gn,(t,s)=>t===s),focusedItemId:ee(t=>t.focus.focusedItemId),isItemFocused:ee((t,s)=>t.focus.focusedItemId===s)},mn=({instance:t,params:s,store:o})=>{const n=Pe(d=>{zt.focusedItemId(o.state)!==d&&o.set("focus",D({},o.state.focus,{focusedItemId:d}))}),r=d=>{const m=$.itemMeta(o.state,d);return m&&(m.parentId==null||pe.isItemExpanded(o.state,m.parentId))},a=(d,m)=>{const h=t.getItemDOMElement(m);h&&h.focus(),n(m),s.onItemFocus&&s.onItemFocus(d,m)},i=Pe((d,m)=>{r(m)&&a(d,m)}),l=Pe(()=>{const d=zt.focusedItemId(o.state);if(d==null)return;if($.itemMeta(o.state,d)){const h=t.getItemDOMElement(d);h&&h.blur()}n(null)});Md(o,$.itemMetaLookup,()=>{const d=zt.focusedItemId(o.state);if(d==null||!!$.itemMeta(o.state,d))return;const h=zt.defaultFocusableItemId(o.state);if(h==null){n(null);return}a(null,h)});const c=d=>m=>{if(d.onFocus?.(m),m.defaultMuiPrevented)return;const h=zt.defaultFocusableItemId(o.state);m.target===m.currentTarget&&h!=null&&a(m,h)},u=d=>m=>{d.onBlur?.(m),!m.defaultMuiPrevented&&n(null)};return{getRootProps:d=>({onFocus:c(d),onBlur:u(d)}),publicAPI:{focusItem:i},instance:{focusItem:i,removeFocusedItem:l}}};mn.getInitialState=()=>({focus:{focusedItemId:null}});mn.params={onItemFocus:!0};const iu=[];function lu(t){p.useEffect(t,iu)}const ss=0;class fn{static create(){return new fn}currentId=ss;start(s,o){this.clear(),this.currentId=setTimeout(()=>{this.currentId=ss,o()},s)}isStarted(){return this.currentId!==ss}clear=()=>{this.currentId!==ss&&(clearTimeout(this.currentId),this.currentId=ss)};disposeEffect=()=>this.clear}function cu(){const t=js(fn.create).current;return lu(t.disposeEffect),t}const Bs=(t,s)=>t.getAvailablePlugins().has(s),mt={isItemEditable:ee(t=>t.label?.isItemEditable,$.itemModel,(t,s,o)=>!s||t==null?!1:typeof t=="boolean"?t:t(s)),isItemBeingEdited:ee((t,s)=>s==null?!1:t.label?.editedItemId===s),isAnyItemBeingEdited:ee(t=>!!t.label?.editedItemId)},du=({props:t})=>{const{store:s}=Ht(),{label:o,itemId:n}=t,[r,a]=p.useState(o),i=ne(s,mt.isItemEditable,n),l=ne(s,mt.isItemBeingEdited,n);return p.useEffect(()=>{l||a(o)},[l,o]),{propsEnhancers:{label:()=>({editable:i}),labelInput:({externalEventHandlers:c,interactions:u})=>i?{value:r??"","data-element":"labelInput",onChange:f=>{c.onChange?.(f),a(f.target.value)},onKeyDown:f=>{if(c.onKeyDown?.(f),f.defaultMuiPrevented)return;const b=f.target;f.key==="Enter"&&b.value?u.handleSaveItemLabel(f,b.value):f.key==="Escape"&&u.handleCancelItemLabelEditing(f)},onBlur:f=>{c.onBlur?.(f),!f.defaultMuiPrevented&&f.target.value&&u.handleSaveItemLabel(f,f.target.value)},autoFocus:!0,type:"text"}:{}}}},ft=({store:t,params:s})=>{const o=r=>{r!==null&&!mt.isItemEditable(t.state,r)||t.set("label",D({},t.state.label,{editedItemId:r}))},n=(r,a)=>{if(!a)throw new Error(["MUI X: The Tree View component requires all items to have a `label` property.","The label of an item cannot be empty.",r].join(`
`));const i=t.state.items.itemMetaLookup[r];i.label!==a&&(t.set("items",D({},t.state.items,{itemMetaLookup:D({},t.state.items.itemMetaLookup,{[r]:D({},i,{label:a})})})),s.onItemLabelChange&&s.onItemLabelChange(r,a))};return Ys(()=>{t.set("label",D({},t.state.label,{isItemEditable:s.isItemEditable}))},[t,s.isItemEditable]),{instance:{setEditedItem:o,updateItemLabel:n},publicAPI:{setEditedItem:o,updateItemLabel:n}}};ft.itemPlugin=du;ft.applyDefaultValuesToParams=({params:t})=>D({},t,{isItemEditable:t.isItemEditable??!1});ft.getInitialState=t=>({label:{isItemEditable:t.isItemEditable,editedItemId:null}});ft.params={onItemLabelChange:!0,isItemEditable:!0};function uu(t){return!!t&&t.length===1&&!!t.match(/\S/)}const pu=500,Oa=({instance:t,store:s,params:o})=>{const n=Ni(),r=p.useRef({}),a=p.useRef(""),i=cu(),l=Pe(g=>{r.current=g(r.current)}),c=ne(s,$.itemMetaLookup);p.useEffect(()=>{if(t.areItemUpdatesPrevented())return;const g={},y=j=>{g[j.id]=j.label.toLowerCase()};Object.values(c).forEach(y),r.current=g},[c,o.getItemId,t]);const u=g=>{const y=Ns(s.state,g);return y===null?Js(s.state):y},d=(g,y)=>{let j=null;const w={};let v=y.length>1?g:u(g);for(;j==null&&!w[v];)r.current[v]?.startsWith(y)?j=v:(w[v]=!0,v=u(v));return j},m=(g,y)=>{const j=y.toLowerCase(),w=`${a.current}${j}`,v=d(g,w);if(v!=null)return a.current=w,v;const I=d(g,j);return I!=null?(a.current=j,I):(a.current="",null)},h=g=>se.enabled(s.state)&&!$.isItemDisabled(s.state,g),f=g=>!$.isItemDisabled(s.state,g)&&pe.isItemExpandable(s.state,g);return{instance:{updateLabelMap:l,handleItemKeyDown:async(g,y)=>{if(g.defaultMuiPrevented||g.altKey||Bo(g.target,g.currentTarget))return;const j=g.ctrlKey||g.metaKey,w=g.key,v=se.isMultiSelectEnabled(s.state);switch(!0){case(w===" "&&h(y)):{g.preventDefault(),v&&g.shiftKey?t.expandSelectionRange(g,y):t.setItemSelection({event:g,itemId:y,keepExistingSelection:v,shouldBeSelected:void 0});break}case w==="Enter":{Bs(t,ft)&&mt.isItemEditable(s.state,y)&&!mt.isItemBeingEdited(s.state,y)?t.setEditedItem(y):f(y)?(t.setItemExpansion({event:g,itemId:y}),g.preventDefault()):h(y)&&(v?(g.preventDefault(),t.setItemSelection({event:g,itemId:y,keepExistingSelection:!0})):se.isItemSelected(s.state,y)||(t.setItemSelection({event:g,itemId:y}),g.preventDefault()));break}case w==="ArrowDown":{const I=Ns(s.state,y);I&&(g.preventDefault(),t.focusItem(g,I),v&&g.shiftKey&&h(I)&&t.selectItemFromArrowNavigation(g,y,I));break}case w==="ArrowUp":{const I=Ra(s.state,y);I&&(g.preventDefault(),t.focusItem(g,I),v&&g.shiftKey&&h(I)&&t.selectItemFromArrowNavigation(g,y,I));break}case(w==="ArrowRight"&&!n||w==="ArrowLeft"&&n):{if(j)return;if(pe.isItemExpanded(s.state,y)){const I=Ns(s.state,y);I&&(t.focusItem(g,I),g.preventDefault())}else f(y)&&(t.setItemExpansion({event:g,itemId:y}),g.preventDefault());break}case(w==="ArrowLeft"&&!n||w==="ArrowRight"&&n):{if(j)return;if(f(y)&&pe.isItemExpanded(s.state,y))t.setItemExpansion({event:g,itemId:y}),g.preventDefault();else{const I=$.itemParentId(s.state,y);I&&(t.focusItem(g,I),g.preventDefault())}break}case w==="Home":{h(y)&&v&&j&&g.shiftKey?t.selectRangeFromStartToItem(g,y):t.focusItem(g,Js(s.state)),g.preventDefault();break}case w==="End":{h(y)&&v&&j&&g.shiftKey?t.selectRangeFromItemToEnd(g,y):t.focusItem(g,Pa(s.state)),g.preventDefault();break}case w==="*":{t.expandAllSiblings(g,y),g.preventDefault();break}case(String.fromCharCode(g.keyCode)==="A"&&j&&v&&se.enabled(s.state)):{t.selectAllNavigableItems(g),g.preventDefault();break}case(!j&&!g.shiftKey&&uu(w)):{i.clear();const I=m(y,w);I!=null?(t.focusItem(g,I),g.preventDefault()):a.current="",i.start(pu,()=>{a.current=""});break}}}}}};Oa.params={};const mu=[_s,mo,Is,mn,Oa,ft],fu=Object.is;function hu(t,s){if(t===s)return!0;if(!(t instanceof Object)||!(s instanceof Object))return!1;let o=0,n=0;for(const r in t)if(o+=1,!fu(t[r],s[r])||!(r in s))return!1;for(const r in s)n+=1;return o===n}const Qs={dataSource:ee(t=>t.lazyLoading?.dataSource),isItemLoading:ee((t,s)=>t.lazyLoading?.dataSource.loading[s??ot]??!1),itemHasError:ee((t,s)=>!!t.lazyLoading?.dataSource.errors[s??ot]),itemError:ee((t,s)=>t.lazyLoading?.dataSource.errors[s??ot])},za=t=>Array.isArray(t)?t.length>0&&t.some(za):!!t,gu=({itemId:t,children:s})=>{const{instance:o,store:n,publicAPI:r}=Ht(),a=ne(n,pe.isItemExpandable,t),i=ne(n,Qs.isItemLoading,t),l=ne(n,Qs.itemHasError,t),c=za(s)||a,u=ne(n,pe.isItemExpanded,t),d=ne(n,zt.isItemFocused,t),m=ne(n,se.isItemSelected,t),h=ne(n,$.isItemDisabled,t),f=ne(n,mt.isItemBeingEdited,t),b=ne(n,mt.isItemEditable,t),g={expandable:c,expanded:u,focused:d,selected:m,disabled:h,editing:f,editable:b,loading:i,error:l},y=_=>{if(g.disabled)return;g.focused||o.focusItem(_,t);const R=se.isMultiSelectEnabled(n.state)&&(_.shiftKey||_.ctrlKey||_.metaKey);g.expandable&&!(R&&pe.isItemExpanded(n.state,t))&&o.setItemExpansion({event:_,itemId:t})},j=_=>{if(g.disabled)return;!g.focused&&!g.editing&&o.focusItem(_,t),se.isMultiSelectEnabled(n.state)&&(_.shiftKey||_.ctrlKey||_.metaKey)?_.shiftKey?o.expandSelectionRange(_,t):o.setItemSelection({event:_,itemId:t,keepExistingSelection:!0}):o.setItemSelection({event:_,itemId:t,shouldBeSelected:!0})},w=_=>{const R=_.nativeEvent.shiftKey,k=se.isMultiSelectEnabled(n.state);k&&R?o.expandSelectionRange(_,t):o.setItemSelection({event:_,itemId:t,keepExistingSelection:k,shouldBeSelected:_.target.checked})},v=()=>{Bs(o,ft)&&(f?o.setEditedItem(null):o.setEditedItem(t))};return{interactions:{handleExpansion:y,handleSelection:j,handleCheckboxSelection:w,toggleItemEditing:v,handleSaveItemLabel:(_,R)=>{Bs(o,ft)&&mt.isItemBeingEdited(n.state,t)&&(o.updateItemLabel(t,R),v(),o.focusItem(_,t))},handleCancelItemLabelEditing:_=>{Bs(o,ft)&&mt.isItemBeingEdited(n.state,t)&&(v(),o.focusItem(_,t))}},status:g,publicAPI:r}},Fa=t=>{const{runItemPlugins:s,instance:o,publicAPI:n,store:r}=Ht(),a=p.useContext(Ma),i=ne(r,(...B)=>typeof a=="function"?a(...B):a,t.itemId),{id:l,itemId:c,label:u,children:d,rootRef:m}=t,{rootRef:h,contentRef:f,propsEnhancers:b}=s(t),{interactions:g,status:y}=gu({itemId:c,children:d}),j=p.useRef(null),w=p.useRef(null),v=No(m,h,j),I=No(f,w),E=p.useRef(null),L=ne(r,po.treeId),_=ne(r,se.isCheckboxSelectionEnabled),R=un({itemId:c,treeId:L,id:l}),k=ne(r,zt.isItemTheDefaultFocusableItem,c),S={rootRefObject:j,contentRefObject:w,interactions:g},A=B=>O=>{B.onFocus?.(O),!O.defaultMuiPrevented&&!y.focused&&$.canItemBeFocused(r.state,c)&&O.currentTarget===O.target&&o.focusItem(O,c)},z=B=>O=>{if(B.onBlur?.(O),O.defaultMuiPrevented)return;const ge=o.getItemDOMElement(c);y.editing||O.relatedTarget&&Bo(O.relatedTarget,ge)&&(O.target&&O.target?.dataset?.element==="labelInput"&&Bo(O.target,ge)||O.relatedTarget?.dataset?.element==="labelInput")||o.removeFocusedItem()},P=B=>O=>{B.onKeyDown?.(O),!(O.defaultMuiPrevented||O.target?.dataset?.element==="labelInput")&&o.handleItemKeyDown(O,c)},T=B=>O=>{B.onDoubleClick?.(O),!O.defaultMuiPrevented&&g.toggleItemEditing()},N=B=>O=>{B.onClick?.(O),o.handleItemClick(O,c),!(O.defaultMuiPrevented||E.current?.contains(O.target))&&(pe.triggerSlot(r.state)==="content"&&g.handleExpansion(O),_||g.handleSelection(O))},Y=B=>O=>{B.onMouseDown?.(O),!O.defaultMuiPrevented&&(O.shiftKey||O.ctrlKey||O.metaKey||y.disabled)&&O.preventDefault()},te=B=>O=>{B.onClick?.(O),!O.defaultMuiPrevented&&pe.triggerSlot(r.state)==="iconContainer"&&g.handleExpansion(O)};return{getContextProviderProps:()=>({itemId:c,id:l}),getRootProps:(B={})=>{const O=D({},ze(t),ze(B)),ge=D({},O,{ref:v,role:"treeitem",tabIndex:k?0:-1,id:R,"aria-expanded":y.expandable?y.expanded:void 0,"aria-disabled":y.disabled||void 0},B,{style:D({},B.style??{},{"--TreeView-itemDepth":i}),onFocus:A(O),onBlur:z(O),onKeyDown:P(O)}),Mt=b.root?.(D({},S,{externalEventHandlers:O}))??{};return D({},ge,Mt)},getContentProps:(B={})=>{const O=ze(B),ge=D({},O,B,{ref:I,onClick:N(O),onMouseDown:Y(O),status:y});["expanded","selected","focused","disabled","editing","editable"].forEach(_n=>{y[_n]&&(ge[`data-${_n}`]="")});const Mt=b.content?.(D({},S,{externalEventHandlers:O}))??{};return D({},ge,Mt)},getGroupTransitionProps:(B={})=>{const O=ze(B);return D({},O,{unmountOnExit:!0,component:"ul",role:"group",in:y.expanded,children:d},B)},getIconContainerProps:(B={})=>{const O=ze(B);return D({},O,B,{onClick:te(O)})},getCheckboxProps:(B={})=>{const O=ze(B),ge=D({},O,{ref:E,"aria-hidden":!0},B),Mt=b.checkbox?.(D({},S,{externalEventHandlers:O}))??{};return D({},ge,Mt)},getLabelProps:(B={})=>{const O=D({},ze(B)),ge=D({},O,{children:u},B,{onDoubleClick:T(O)}),Mt=b.label?.(D({},S,{externalEventHandlers:O}))??{};return D({},Mt,ge)},getLabelInputProps:(B={})=>{const O=ze(B),ge=b.labelInput?.(D({},S,{externalEventHandlers:O}))??{};return D({},B,ge)},getDragAndDropOverlayProps:(B={})=>{const O=ze(B),ge=b.dragAndDropOverlay?.(D({},S,{externalEventHandlers:O}))??{};return D({},B,ge)},getErrorContainerProps:(B={})=>{const O=ze(B);return D({},O,B)},getLoadingContainerProps:(B={})=>{const O=ze(B);return D({size:"12px",thickness:6},O,B)},rootRef:v,status:y,publicAPI:n}};function xu(t){return Te("MuiTreeItem",t)}Ee("MuiTreeItem",["root","content","groupTransition","iconContainer","label","checkbox","labelInput","dragAndDropOverlay","errorIcon","loadingIcon","expanded","selected","focused","disabled","editable","editing"]);const bu=J(e.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})),yu=J(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"})),ju=["ownerState"];function Io(t,s,o){return t!==void 0?t:s!==void 0?s:o}function $a(t){const{slots:s,slotProps:o,status:n}=t,{slots:r,slotProps:a}=_a(),i={collapseIcon:Io(s?.collapseIcon,r.collapseIcon,yu),expandIcon:Io(s?.expandIcon,r.expandIcon,bu),endIcon:Io(s?.endIcon,r.endIcon),icon:s?.icon};let l;i?.icon?l="icon":n.expandable?n.expanded?l="collapseIcon":l="expandIcon":l="endIcon";const c=i[l],u=Ce({elementType:c,externalSlotProps:m=>D({},Cn(a[l],m),Cn(o?.[l],m)),ownerState:{}}),d=Zt(u,ju);return c?e.jsx(c,D({},d)):null}const ku=le("div",{name:"MuiTreeItemDragAndDropOverlay",slot:"Root",shouldForwardProp:t=>Ko(t)&&t!=="action"})(({theme:t})=>({position:"absolute",left:0,display:"flex",top:0,bottom:0,right:0,pointerEvents:"none",variants:[{props:{action:"make-child"},style:{marginLeft:"calc(var(--TreeView-indentMultiplier) * var(--TreeView-itemDepth))",borderRadius:t.shape.borderRadius,backgroundColor:t.vars?`rgba(${t.vars.palette.primary.darkChannel} / ${t.vars.palette.action.focusOpacity})`:ls(t.palette.primary.dark,t.palette.action.focusOpacity)}},{props:{action:"reorder-above"},style:{marginLeft:"calc(var(--TreeView-indentMultiplier) * var(--TreeView-itemDepth))",borderTop:`1px solid ${(t.vars||t).palette.action.active}`}},{props:{action:"reorder-below"},style:{marginLeft:"calc(var(--TreeView-indentMultiplier) * var(--TreeView-itemDepth))",borderBottom:`1px solid ${(t.vars||t).palette.action.active}`}},{props:{action:"move-to-parent"},style:{marginLeft:"calc(var(--TreeView-indentMultiplier) * calc(var(--TreeView-itemDepth) - 1))",borderBottom:`1px solid ${(t.vars||t).palette.action.active}`}}]}));function Na(t){return t.action==null?null:e.jsx(ku,D({},t))}function Wa(t){const{children:s,itemId:o,id:n}=t,{wrapItem:r,instance:a,store:i}=Ht(),l=ne(i,po.treeId),c=un({itemId:o,treeId:l,id:n});return e.jsx(p.Fragment,{children:r({children:s,itemId:o,instance:a,idAttribute:c})})}const wu=le("input",{name:"MuiTreeItem",slot:"LabelInput"})(({theme:t})=>D({},t.typography.body1,{width:"100%",backgroundColor:(t.vars||t).palette.background.paper,borderRadius:t.shape.borderRadius,border:"none",padding:"0 2px",boxSizing:"border-box","&:focus":{outline:`1px solid ${(t.vars||t).palette.primary.main}`}})),vu=["visible"],Su=["id","itemId","label","disabled","children","slots","slotProps","classes"],_u=ja(),Ba=le("li",{name:"MuiTreeItem",slot:"Root"})({listStyle:"none",margin:0,padding:0,outline:0}),Va=le("div",{name:"MuiTreeItem",slot:"Content",shouldForwardProp:t=>Ko(t)&&t!=="status"})(({theme:t})=>({padding:t.spacing(.5,1),paddingLeft:`calc(${t.spacing(1)} + var(--TreeView-itemChildrenIndentation) * var(--TreeView-itemDepth))`,borderRadius:t.shape.borderRadius,width:"100%",boxSizing:"border-box",position:"relative",display:"flex",alignItems:"center",gap:t.spacing(1),cursor:"pointer",WebkitTapHighlightColor:"transparent","&:hover":{backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},"&[data-disabled]":{opacity:(t.vars||t).palette.action.disabledOpacity,backgroundColor:"transparent",cursor:"auto"},"&[data-focused]":{backgroundColor:(t.vars||t).palette.action.focus},"&[data-selected]":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:ls(t.palette.primary.main,t.palette.action.selectedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:ls(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:ls(t.palette.primary.main,t.palette.action.selectedOpacity)}}},"&[data-selected][data-focused]":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:ls(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}})),Ua=le("div",{name:"MuiTreeItem",slot:"Label",shouldForwardProp:t=>Ko(t)&&t!=="editable"})(({theme:t})=>D({width:"100%",boxSizing:"border-box",minWidth:0,position:"relative",overflow:"hidden"},t.typography.body1,{variants:[{props:({editable:s})=>s,style:{paddingLeft:"2px"}}]})),Ha=le("div",{name:"MuiTreeItem",slot:"IconContainer"})({width:16,display:"flex",flexShrink:0,justifyContent:"center",position:"relative",cursor:"inherit","& svg":{fontSize:18}}),qa=le($t,{name:"MuiTreeItem",slot:"GroupTransition",overridesResolver:(t,s)=>s.groupTransition})({margin:0,padding:0}),Iu=le("div",{name:"MuiTreeItem",slot:"ErrorIcon"})({position:"absolute",right:-3,width:7,height:7,borderRadius:"50%",backgroundColor:"red"}),Cu=le(xt,{name:"MuiTreeItem",slot:"LoadingIcon"})({color:"text.primary"}),Ga=le(p.forwardRef((t,s)=>{const{visible:o}=t,n=Zt(t,vu);return o?e.jsx(ws,D({},n,{ref:s})):null}),{name:"MuiTreeItem",slot:"Checkbox"})({padding:0}),Mu=t=>{const{classes:s}=_a(),o=D({},t,{root:ue(t?.root,s.root),content:ue(t?.content,s.itemContent),iconContainer:ue(t?.iconContainer,s.itemIconContainer),checkbox:ue(t?.checkbox,s.itemCheckbox),label:ue(t?.label,s.itemLabel),groupTransition:ue(t?.groupTransition,s.itemGroupTransition),labelInput:ue(t?.labelInput,s.itemLabelInput),dragAndDropOverlay:ue(t?.dragAndDropOverlay,s.itemDragAndDropOverlay),errorIcon:ue(t?.errorIcon,s.itemErrorIcon),loadingIcon:ue(t?.loadingIcon,s.itemLoadingIcon)});return Re({root:["root"],content:["content"],iconContainer:["iconContainer"],checkbox:["checkbox"],label:["label"],groupTransition:["groupTransition"],labelInput:["labelInput"],dragAndDropOverlay:["dragAndDropOverlay"],errorIcon:["errorIcon"],loadingIcon:["loadingIcon"],expanded:["expanded"],editing:["editing"],editable:["editable"],selected:["selected"],focused:["focused"],disabled:["disabled"]},xu,o)},Tu=p.forwardRef(function(s,o){const n=_u({props:s,name:"MuiTreeItem"}),{id:r,itemId:a,label:i,disabled:l,children:c,slots:u={},slotProps:d={},classes:m}=n,h=Zt(n,Su),{getContextProviderProps:f,getRootProps:b,getContentProps:g,getIconContainerProps:y,getCheckboxProps:j,getLabelProps:w,getGroupTransitionProps:v,getLabelInputProps:I,getDragAndDropOverlayProps:E,getErrorContainerProps:L,getLoadingContainerProps:_,status:R}=Fa({id:r,itemId:a,children:c,label:i,disabled:l}),k=Mu(m),S=u.root??Ba,A=Ce({elementType:S,getSlotProps:b,externalForwardedProps:h,externalSlotProps:d.root,additionalProps:{ref:o},ownerState:{},className:k.root}),z=u.content??Va,P=Ce({elementType:z,getSlotProps:g,externalSlotProps:d.content,ownerState:{},className:ue(k.content,R.expanded&&k.expanded,R.selected&&k.selected,R.focused&&k.focused,R.disabled&&k.disabled,R.editing&&k.editing,R.editable&&k.editable)}),T=u.iconContainer??Ha,N=Ce({elementType:T,getSlotProps:y,externalSlotProps:d.iconContainer,ownerState:{},className:k.iconContainer}),Y=u.label??Ua,te=Ce({elementType:Y,getSlotProps:w,externalSlotProps:d.label,ownerState:{},className:k.label}),q=u.checkbox??Ga,V=Ce({elementType:q,getSlotProps:j,externalSlotProps:d.checkbox,ownerState:{},className:k.checkbox}),xe=u.groupTransition??void 0,at=Ce({elementType:xe,getSlotProps:v,externalSlotProps:d.groupTransition,ownerState:{},className:k.groupTransition}),qe=u.labelInput??wu,ts=Ce({elementType:qe,getSlotProps:I,externalSlotProps:d.labelInput,ownerState:{},className:k.labelInput}),bt=u.dragAndDropOverlay??Na,Q=Ce({elementType:bt,getSlotProps:E,externalSlotProps:d.dragAndDropOverlay,ownerState:{},className:k.dragAndDropOverlay}),G=u.errorIcon??Iu,fe=Ce({elementType:G,getSlotProps:L,externalSlotProps:d.errorIcon,ownerState:{},className:k.errorIcon}),Ge=u.loadingIcon??Cu,B=Ce({elementType:Ge,getSlotProps:_,externalSlotProps:d.loadingIcon,ownerState:{},className:k.loadingIcon});return e.jsx(Wa,D({},f(),{children:e.jsxs(S,D({},A,{children:[e.jsxs(z,D({},P,{children:[e.jsxs(T,D({},N,{children:[R.error&&e.jsx(G,D({},fe)),R.loading?e.jsx(Ge,D({},B)):e.jsx($a,{status:R,slots:u,slotProps:d})]})),e.jsx(q,D({},V)),R.editing?e.jsx(qe,D({},ts)):e.jsx(Y,D({},te)),e.jsx(bt,D({},Q))]})),c&&e.jsx(qa,D({as:xe},at))]}))}))}),Eu=["ownerState"],Ka=p.createContext(null),Ru=[],Pu=()=>Ru,Au=p.memo(function({itemSlot:s,itemSlotProps:o,itemId:n,skipChildren:r}){const a=p.useContext(Ka),{store:i}=Ht(),l=ne(i,$.itemMeta,n),c=ne(i,r?Pu:$.itemOrderedChildrenIds,n),u=s??Tu,d=Ce({elementType:u,externalSlotProps:o,additionalProps:{label:l?.label,id:l?.idAttribute,itemId:n},ownerState:{itemId:n,label:l?.label}}),m=Zt(d,Eu);return e.jsx(u,D({},m,{children:c?.map(a)}))},hu);function Lu(t){const{slots:s,slotProps:o}=t,{store:n}=Ht(),r=s?.item,a=o?.item,i=ne(n,$.domStructure),l=ne(n,i==="flat"?d=>pe.flatList(d):d=>$.itemOrderedChildrenIds(d,null)),c=i==="flat",u=p.useCallback(d=>e.jsx(Au,{itemSlot:r,itemSlotProps:a,itemId:d,skipChildren:c},d),[r,a,c]);return e.jsx(Ka.Provider,{value:u,children:l.map(u)})}const Du=["slots","slotProps"],Ou=ja(),zu=t=>{const{classes:s}=t;return p.useMemo(()=>Re({root:["root"],item:["item"],itemContent:["itemContent"],itemGroupTransition:["itemGroupTransition"],itemIconContainer:["itemIconContainer"],itemLabel:["itemLabel"],itemLabelInput:["itemLabelInput"],itemCheckbox:["itemCheckbox"]},Ed,s),[s])},Fu=le("ul",{name:"MuiRichTreeView",slot:"Root"})({padding:0,margin:0,listStyle:"none",outline:0,position:"relative"}),$u=p.forwardRef(function(s,o){const n=Ou({props:s,name:"MuiRichTreeView"}),{slots:r,slotProps:a}=n,i=Zt(n,Du),{getRootProps:l,contextValue:c}=Vd({plugins:mu,rootRef:o,props:i}),u=ne(c.store,Qs.isItemLoading,null),d=ne(c.store,Qs.itemError,null),m=zu(n),h=r?.root??Fu,f=Ce({elementType:h,externalSlotProps:a?.root,className:m.root,getSlotProps:l,ownerState:n});return u?e.jsx(M,{children:"Loading..."}):d?e.jsx(Yo,{severity:"error",children:d.message}):e.jsx(Ud,{contextValue:c,classes:m,slots:r,slotProps:a,children:e.jsx(h,D({},f,{children:e.jsx(Lu,{slots:r,slotProps:a})}))})}),Kn=({currentMenu:t})=>{let s=t.id,o=t.entityType,n=!1;const r=p.useCallback(a=>a.stopPropagation(),[]);if(s.includes("__reviews")){if(o="reviews",n=!0,!window.FT.isAuth("MANAGE_REVIEW_SESSION"))return null}else s.includes("__lists")&&(s="lists",o="lists",n=!0);return e.jsx(Wi,{entityId:s,entityType:o,objectTypeId:t?.objectTypeId,sx:{width:18,height:18,color:"text.primary"},tooltipPlacement:"right",contextMenuAction:"leftMenu",onClick:r,ignoreToLegacyEntityTypeConversion:n})},Vs=F({"past-due-date":{id:"ftrack-spark-components.status-progress.past-due-date",defaultMessage:"Past due date"},"due-today":{id:"ftrack-spark-components.status-progress.due-today",defaultMessage:"Due today"},"due-in":{id:"ftrack-spark-components.status-progress.due-in",defaultMessage:`Due in {value, plural,
      one {{value} day}
      other {{value} days}
    }`},"not-started":{id:"ftrack-spark-components.status-progress.not-started",defaultMessage:"Not started"},"in-progress":{id:"ftrack-spark-components.status-progress.in-progress",defaultMessage:"In progress"},blocked:{id:"ftrack-spark-components.status-progress.blocked",defaultMessage:"Blocked"},done:{id:"ftrack-spark-components.status-progress.done",defaultMessage:"Done"}}),Nu={NOT_STARTED:"not-started",IN_PROGRESS:"in-progress",BLOCKED:"blocked",DONE:"done"};function Wu(t){const s=Nu[t];return s?e.jsx(x,{...Vs[s]}):""}const Bu=p.memo(function({treeItemData:s}){const{statusProgressData:o,statusData:n}=s,r=s.childTasks?.length,a=s.children.length>0||r&&r>=8,i=p.useMemo(()=>{const f=o?.map(b=>b.status_id)||[];return n?.filter(b=>f.includes(b.id))||[]},[o,n]),l=p.useMemo(()=>{const f=Date.now(),b=Math.max(...s?.childTasks?.map(y=>y.end_date&&new Date(y.end_date).getTime()).filter(be)||[]);if(isNaN(b)||!Number.isFinite(b))return null;const g=Math.floor((b-f)/1e3/60/60/24);return g<0?e.jsx(x,{...Vs["past-due-date"]}):g===0?e.jsx(x,{...Vs["due-today"]}):e.jsx(x,{...Vs["due-in"],values:{value:g}})},[s?.childTasks]),c=p.useMemo(()=>{if(!o?.length||!i?.length)return{allStatus:{},summaryStatus:{}};const f={};i.forEach(y=>{f[y.id]=y});const b={},g={};return o.forEach(({status_id:y,count_id:j})=>{const w=f[y];w&&(b[w.id]=j,w.state?.short&&(g[w.state.short]=(g[w.state.short]||0)+j))}),{allStatus:b,summaryStatus:g}},[o,i]),u=p.useMemo(()=>Object.values(c.allStatus).reduce((f,b)=>f+b,0),[c.allStatus]),d=p.useMemo(()=>Object.entries(c.allStatus).map(([f,b])=>{const g=i.find(j=>j.id===f),y=s.isColorBasedOnStatus?g?.color:xo[g?.state?.short];return e.jsx(C,{sx:{display:"flex",height:8,bgcolor:y,width:`${b/u*100}%`}},f)}),[i,c.allStatus,u,s.isColorBasedOnStatus]),m=p.useMemo(()=>Object.entries(c.summaryStatus).map(([f,b])=>{const g=i.find(w=>w.state?.short===f),y=s.isColorBasedOnStatus?g?.color:xo[g?.state?.short],j=Math.round(b/u*100);return e.jsxs(C,{sx:{display:"flex",gap:.5,justifyContent:"space-between",pr:0},children:[e.jsx(De,{icon:e.jsx(qs,{}),label:Wu(f),iconColor:y,sx:{"& .MuiChip-label":{color:"neutral.light"}}}),e.jsxs(M,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(M,{component:"span",sx:{maxWidth:"5ch",textAlign:"left"},children:b}),e.jsxs(M,{component:"span",sx:{color:"neutral.light",fontSize:"fontSizeSmall",width:"5ch",textAlign:"end"},children:[j,"%"]})]})]},f)}),[c.summaryStatus,i,s.isColorBasedOnStatus,u]),h=p.useMemo(()=>s?.childTasks?.map(f=>{const b=s.isColorBasedOnStatus?f.status?.color:xo[f.status?.state?.short];return e.jsxs(C,{sx:{display:"flex",gap:2},children:[e.jsx(M,{component:"span",sx:{textOverflow:"ellipsis",color:"neutral.light",whiteSpace:"nowrap",overflow:"hidden",display:"inline-block",width:"100%"},children:f.name}),e.jsx(De,{icon:e.jsx(qs,{}),label:f.status?.name,iconColor:b,sx:{"& .MuiChip-label":{color:"neutral.light"}}})]},f.id)}),[s?.childTasks,s.isColorBasedOnStatus]);return d?.length?e.jsx(p.Suspense,{fallback:null,children:e.jsx(Z,{disableInteractive:!0,title:e.jsxs(C,{sx:{p:1,gap:1,display:"flex",flexDirection:"column"},children:[e.jsx(C,{sx:{display:"flex",gap:.5,p:1,flexDirection:a?"column-reverse":"column",pr:0},children:a?m:h}),l&&!a&&e.jsx(Yo,{severity:"warning",sx:{mt:-1,mb:1,p:0,pr:1,width:"min-content",alignSelf:"center",alignItems:"center",bgcolor:"background.darkOverlay",border:"1px solid",borderColor:"divider","& .MuiAlert-icon":{mr:0,p:1},"& .MuiAlert-message":{fontSize:"fontSizeRegular",fontWeight:"fontWeightMedium",whiteSpace:"nowrap",color:"neutral.light"}},children:l})]}),children:e.jsx(C,{sx:{width:"100%",display:"flex",flexDirection:"row-reverse",borderRadius:.5,overflow:"hidden"},children:d})})}):null}),Vu=F({code:{id:"ftrack-spark-components.project-outliner-tree-item.code",defaultMessage:"{project} (code: {code})"}}),Uu=p.memo(function({id:s,itemId:o,label:n,disabled:r,children:a,color:i,ref:l,ListVisibilityIcon:c,isListVisible:u,selectedItem:d,currentProjectId:m,isSidebarOpen:h,onItemDrop:f,...b}){const{getRootProps:g,getContentProps:y,getIconContainerProps:j,getCheckboxProps:w,getLabelProps:v,getGroupTransitionProps:I,getDragAndDropOverlayProps:E,getContextProviderProps:L,status:_,publicAPI:R}=Fa({id:s,itemId:o,children:a,label:n,disabled:r,rootRef:l}),k=R.getItem(o),S=p.useMemo(()=>k.entityType==="List"&&!k.icon?{display:u&&!k.is_open?"none":"list-item","& .MuiBox-root>.labelClass":{color:k.is_open?"text.primary":"text.secondary",textDecoration:k.is_open?"none":"line-through"},"&:hover .MuiBox-root>.labelClass":{textDecoration:k.is_open?"none":"line-through"}}:{color:k.entityType==="Project"&&k.status==="hidden"?"text.secondary":"inherit","& .MuiBox-root>.labelClass":{textDecoration:k.status?.state?.short==="BLOCKED"&&k.entityType==="Shot"?"line-through":"none"}},[k,u]),A=p.useMemo(()=>e.jsx(Wa,{...L(),children:e.jsxs(Ba,{...g({...b,sx:S}),children:[e.jsxs(Va,{...y(),sx:{mt:.25,"&:hover .MuiBox-root>.labelClass":{textDecoration:k.status?.state?.short==="BLOCKED"&&k.entityType==="Shot"?"line-through":k.id===d&&k.canOpenSidebar||h&&k.canOpenSidebar?"underline":"none"},"& .dragIcon":{visibility:"hidden"},"&:hover .dragIcon":{visibility:"visible"}},children:[k.entityType==="ReviewSession"?e.jsx(Bi,{className:"dragIcon",sx:{fontSize:"18px",color:"text.disabled",cursor:"grab"}}):e.jsx(Ha,{...j(),sx:{borderRadius:"10px",width:18},children:e.jsx($a,{status:_})}),k.entityType&&e.jsxs(C,{sx:{flexGrow:1,display:"flex",gap:1,overflow:"hidden",alignItems:"center","& .MuiButtonBase-root .MuiSvgIcon-root":{opacity:0},"&.MuiBox-root:hover .MuiButtonBase-root .MuiSvgIcon-root":{opacity:1},cursor:k.entityType==="ListCategory"||k.entityType==="ReviewSessionFolder"&&!k.icon?"default":"pointer"},children:[k.entityType==="Project"?e.jsx($r,{status:k.status,showTooltip:!0,sx:{width:21,height:21,color:k.color}}):e.jsx(Vi,{type:k.entityType,icon:k.icon,sx:{fontSize:"18px",color:k.disabled?"text.disabled":k.status?.color,filter:"contrast(70%)"}}),e.jsx(Ga,{...w()}),e.jsx(Z,{title:k.entityType==="Project"?e.jsx(x,{...Vu.code,values:{code:k.code,project:n}}):n??"",placement:"right",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,24]}}]}},children:e.jsx(Ua,{...v(),className:"labelClass",sx:{textWrap:"nowrap",textOverflow:"ellipsis",...S}})}),k.entityType==="TypedContext"&&k.statusProgressData?e.jsx(Bu,{treeItemData:k}):null,k.icon&&k.entityType==="List"?e.jsxs(e.Fragment,{children:[c?e.jsx(c,{}):null,e.jsx(Kn,{currentMenu:k})]}):e.jsx(Kn,{currentMenu:k})]}),e.jsx(Na,{...E()})]}),a&&e.jsx(qa,{...I()})]})}),[c,a,w,y,L,E,I,j,v,g,h,k,S,n,b,d,_]);return k.entityType==="ReviewSession"?e.jsx(Hu,{item:k,children:A}):k.entityType==="ReviewSessionFolder"&&!k.icon?e.jsx(Yn,{item:k,onItemDrop:f,children:A}):k.id.includes("_reviews")?e.jsx(Yn,{item:k,onItemDrop:f,isRootFolder:!0,children:A}):A}),Hu=p.memo(function({item:s,children:o}){const n=p.useCallback(r=>{r.dataTransfer.setData("text/plain",s.id),r.dataTransfer.effectAllowed="move"},[s.id]);return e.jsx("div",{draggable:!0,onDragStart:n,children:o})}),Yn=p.memo(function({item:s,children:o,onItemDrop:n,isRootFolder:r=!1}){const[a,i]=p.useState(!1),l=p.useCallback(d=>{d.preventDefault(),d.dataTransfer.dropEffect="move",i(d.dataTransfer.effectAllowed==="move"),d.stopPropagation()},[]),c=p.useCallback(d=>{d.preventDefault(),i(!1)},[]),u=p.useCallback(d=>{if(d.preventDefault(),i(!1),d.isHandled)return;const m=d.dataTransfer.getData("text/plain"),h=s.children?.map(f=>f.id)||[];if(m&&n&&!h.includes(m)){const f=r?null:s.id;n(m,f)}d.isHandled=!0},[s.children,s.id,n,r]);return e.jsx(C,{onDragOver:l,onDragLeave:c,onDrop:u,sx:{backgroundColor:a?"rgba(0, 0, 0, 0.3)":"transparent",transition:"background-color 0.2s ease",outline:a?"1px solid":"none",outlineOffset:0,outlineStyle:a?"dashed":"none",outlineColor:"primary.main",borderRadius:1},children:o})}),qu=()=>p.useRef(void 0),Jn={show:{entityType:"Context",projection:["project_id"]},task:{entityType:"Context",projection:["project_id"]},reviewsession:{entityType:"ReviewSession",projection:["project_id"]},list:{entityType:"List",projection:["project_id"]}};function Ya(){const t=he("entityId"),s=he("entityType"),o=H(),{data:n}=Rr({queryKey:["currentProjectId",{currentEntityType:s,currentEntityId:t}],queryFn:p.useCallback(async()=>{if(!s||!t)return null;if(s==="show"&&t)return t;const r=et({entityType:(s&&Jn[s].entityType)??"Context",filter:`id is ${t}`,projection:(s&&Jn[s].projection)??[]}),i=(await o.query(r)).data[0];if(i){if(i.__entity_type__&&o.schemas&&Nr(i.__entity_type__,o.schemas))return i.project_id;if(i?.__entity_type__==="ReviewSession")return i.project_id;if(i.__entity_type__==="AssetVersionList"||i.__entity_type__==="TypedContextList"||i.__entity_type__==="List")return i.project_id;throw console.error("Unexpected entity type",i),new Error(`Unexpected entity type: ${i.__entity_type__}`)}},[t,s,o])});return n??void 0}function hn({key:t,select:s,fallback:o}){const n=H(),r=n.serverInformation?.user_information?.id,{data:a,isLoading:i,refetch:l}=ve({projection:["value"],filter:`user_id is '${r}' and key is '${t}'`,entityType:"UserApplicationState",limit:1,enabled:!!(r&&t),name:"user-application-state",select:p.useCallback(m=>{let h=o;try{if(m&&m.length>0){const f=JSON.parse(m[0].value);h=s?s(f):f}}catch(f){console.error("Failed to parse user application state",f)}return h},[o,s])}),{mutate:c,variables:u,isPending:d}=to({mutationFn:p.useCallback(async m=>{await n.ensure("UserApplicationState",{user_id:r,key:t,value:JSON.stringify(m)},["user_id","key"])},[n,r,t]),onSettled:p.useCallback(()=>l({cancelRefetch:!1}),[l])});return{data:d?s?s(u):u:a,isLoading:i,mutate:c}}const Qn=F({"client-reviews":{id:"ftrack-spark-components.use-project-tree.client-reviews",defaultMessage:"Client reviews"},lists:{id:"ftrack-spark-components.use-project-tree.lists",defaultMessage:"Lists"}}),Gu=(t,s,o,n=[],r)=>{const a=i=>{if(i.id.includes("-loading"))return{...i,children:i.children.map(a)};const l=[...new Set(s)].indexOf(i.id),u=o[l]?.data?.sort((d,m)=>{const h=n.find(b=>b.id===d.status_id);return(n.find(b=>b.id===m.status_id)?.sort??1/0)-(h?.sort??1/0)})??[];return{...i,statusData:n??[],statusProgressData:u,children:i.children.map(a),isColorBasedOnStatus:r}};return t.map(a)},Ja=(t,s)=>t.map(o=>({id:o.id,label:o.name,entityType:"ReviewSession",parentId:s,children:[]})).sort((o,n)=>o.label.localeCompare(n.label)),Ku=(t,s)=>t.map(o=>({id:o.id,label:o.name,entityType:"ReviewSessionFolder",parentId:ks(s),children:Ja(o.review_sessions??[],o.id)})),Yu=(t,s)=>[...new Set(t.map(o=>o.category.id))].map(o=>{const n=t.filter(i=>i.category.id===o)?.sort((i,l)=>i.name.localeCompare(l.name)),r=n[0].category,a=r.id;return{id:a,label:r.name,entityType:"ListCategory",parentId:s,children:n.map(i=>({id:i.id,label:i.name,canOpenSidebar:!0,entityType:"List",parentId:a,is_open:i.is_open,view:i.system_type==="task"?"tasks":"versions_v1",children:[]}))}}),Ju=(t,s,o)=>{const n={};t.forEach(a=>{const i=!!o?.find(l=>l.parent_id===a.id)?.count_id;n[a.id]={id:a.id,label:a.name,canOpenSidebar:!0,entityType:"TypedContext",icon:a.object_type?.icon,objectTypeId:a.object_type_id,parentId:a.parent_id,status:a.status,children:s.includes(a.id)||!i?[]:[{id:`${a.id}-loading`,label:"Loading...",parentId:a.id,children:[],entityType:"Context"}]}});const r=[];return t.forEach(a=>{if(!a.parent_id||!(a.parent_id in n)&&a.parent_id===a.project_id)r.push(n[a.id]);else{const i=n[a.parent_id];i&&(i.children.length===1&&i.children[0].id.endsWith("-loading")&&(i.children=[]),i.children.push(n[a.id]))}}),r},Xs={show:{entityType:"Context",projection:["project_id","link"]},task:{entityType:"Context",projection:["project_id","link"]},reviewsession:{entityType:"ReviewSession",projection:["project_id","review_session_folder_id","review_session_folder.name","name"]},list:{entityType:"List",projection:["project_id","name","category.id","category.name"]}},ks=t=>`${t}__reviews`,gn=t=>`${t}__lists`,Ts=t=>{const s=localStorage.getItem("ftrack-spreadsheet-last-dashboard"),o=s?JSON.parse(s):t;return o.startsWith("dashboard-")?o.replace("dashboard-",""):o},Xn=t=>t==="Project"||t==="ReviewSession"||t==="ReviewSessionFolder"||t==="Task"?t:t==="AssetVersionList"||t==="TypedContextList"?"List":"TypedContext",Qu=({currentEntityType:t,currentEntityId:s})=>{const o=H();return Vt({name:"project-tree-entity",entityType:(t&&Xs[t].entityType)??"Context",entityId:s,projection:(t&&Xs[t].projection)??[],staleTime:1e3*5*60,select:p.useCallback(n=>{if(n)if(n.__entity_type__&&o.schemas&&Nr(n.__entity_type__,o.schemas)){let r=(n.link??[]).map(a=>a.id);return r?.length>1&&(r=r.slice(0,-1)),{initialExpandedItems:r}}else if(n.__entity_type__==="ReviewSession"){const r=n.review_session_folder_id??n.project_id;return{initialExpandedItems:[n.id,r,ks(n.project_id),n.project_id]}}else if(n.__entity_type__==="AssetVersionList"||n.__entity_type__==="TypedContextList"||n.__entity_type__==="List"){const r=n.category_id??n.project_id;return{initialExpandedItems:[n.id,r,gn(n.project_id),n.project_id]}}else throw console.error("Unexpected entity type",n),new Error(`Unexpected entity type: ${n.__entity_type__}`)},[o.schemas]),enabled:!!(t&&s)})},Xu=({currentProjectId:t,remoteLoadIds:s,handleQueryInvalidation:o,statusData:n})=>{const r=H(),a=r.serverInformation?.user_information?.id,i=r?.serverInformation?.status_progress;let l;try{const j=p.useMemo(()=>Object.keys(localStorage).filter(v=>v.startsWith(`ft-${a}`)).map(v=>localStorage[v])?.find(v=>v.includes("projectsisManualSort2")),[a]);l=j?JSON.parse(j)?.value:void 0}catch(j){_e.error("Error when fetching manual sort",j)}const{data:c,mutate:u,isLoading:d}=hn({key:"project-spreadsheet-manual-sort",fallback:l??!1});p.useEffect(()=>{c===void 0&&!d&&l&&u(l)},[d,c,l,u]);const{data:m=[]}=ve({keepPreviousData:!0,name:"project-outliner-typed-contexts-count",entityType:"TypedContext",orderBy:c?"sort, name":"name",limit:500,projection:["count(id)"],filter:`parent.parent_id in ('${[t,...s].join("','")}') and object_type.is_leaf is False`,groupBy:"parent_id",staleTime:1/0,enabled:!!t,invalidateOnUpdatesFn:o}),h=ve({name:"project-outliner-typed-contexts",entityType:"TypedContext",orderBy:c?"sort, name":"name",limit:500,projection:["name","object_type_id","link","parent_id","project_id","status.state.short","status.color","status.name","object_type.icon","sort"],filter:`parent_id in ('${[t,...s].join("','")}') and object_type.is_leaf is False`,select:p.useCallback(j=>({typedContextTreeItems:Ju(j,s,m),parentTypedContextIds:j.map(v=>v.id)}),[s,m]),invalidateOnUpdatesFn:o,staleTime:1/0,keepPreviousData:!0,enabled:!!t}),{data:{typedContextTreeItems:f=[],parentTypedContextIds:b=[]}={}}=h,{data:g=f,refetch:y}=Zs({queryKey:["status-progress",{currentProjectId:t,parentTypedContextIds:b,typedContextTreeItems:f,statusData:n}],staleTime:1/0,queryFn:p.useCallback(async()=>{try{const j=[...new Set(b)].map(v=>X.query(et({entityType:"Task",filter:`ancestors.id is ${v} and project_id is ${t}`,groupBy:"status_id",projection:["count(id)"]})));if(!j.length)return f;const w=await r.call(j,{additionalHeaders:{"ftrack-strict-api":!0}});return Gu(f,b,w,n??[],i)}catch(j){return _e.error("Failed to fetch",j),f}},[b,r,f,n,i,t])});return Qo({entityType:"Task",onEvent:p.useCallback(()=>{y({cancelRefetch:!1})},[y]),matchFn:p.useCallback(({entity:j})=>!!(j?.changes?.statusid&&j.parents?.find(w=>w.entity_type==="Project")?.entityId===t),[t])}),{typedContextTreeItems:g}},Zu=({isSearchActive:t,filterValue:s,projectSearchValue:o,recentProjectIds:n,currentProjectId:r,reviewSessionTreeItems:a,typedContextTreeItems:i})=>{const l=p.useCallback(c=>c.map(u=>({id:u.id,label:u.full_name,status:u.status,canOpenSidebar:!0,color:u.color,code:u.name,entityType:"Project",parentId:void 0,children:u.id===r&&a?[...a,...i]:[{id:`${u.id}-loading`,label:"",parentId:u.id,children:[],entityType:"ReviewSession"}]})),[r,a,i]);return no({name:"project-outliner-recent-projects",entityType:"Project",projection:["full_name","color","status","name"],keepPreviousData:!0,...t?{limit:100,orderBy:"full_name",filter:Hi([o&&`full_name like '%${o.trim()}%'`,s&&`status is '${s}'`])}:{entityIds:n,limit:5},select:p.useCallback(c=>l(t?c:n.map(u=>c.find(d=>d.id===u)).filter(be)),[n,l,t])})},ep=({typedContextTreeItems:t,handleQueryInvalidation:s})=>{const o=H()?.serverInformation?.status_progress,n=p.useMemo(()=>{const i=l=>{const c=[];return l.forEach(u=>{u.children.length===0&&!u.id.includes("-loading")?c.push(u.id):c.push(...i(u.children))}),c};return i(t)},[t]),{data:r}=ve({name:"summary-status-progress",projection:["name","status.color","status.name","status.state.short","end_date","parent_id"],entityType:"Task",filter:`parent_id in (${n.join(",")})`,enabled:!!n?.length,orderBy:"status.sort asc",invalidateOnUpdatesFn:s});return p.useMemo(()=>{const i=l=>l.map(c=>{const u=r?.filter(d=>d.parent_id===c.id)||[];return{...c,childTasks:u,children:i(c.children),isColorBasedOnStatus:o}});return i(t)},[t,r,o])},tp=({currentProjectId:t})=>{const s=H(),o=oe(),n=eo(),{mutate:r}=to({mutationFn:u=>{const{id:d,...m}=u;return s.update("ReviewSession",d,{...m,project_id:t})},onSuccess:()=>{n.invalidateQueries({queryKey:["project-outliner","review-session",t]})},onError:u=>{console.error("Error updating entity:",u)}}),a=p.useCallback(async(u,d)=>{await r({id:u,review_session_folder_id:d})},[r]),i=p.useMemo(()=>["project-outliner","review-session",t],[t]),{data:l}=Zs(Pr({queryKey:i,enabled:!!(t&&window.FT.isAuth("VIEW_REVIEW_SESSION")),staleTime:1/0,placeholderData:Ui,queryFn:async()=>{const u=et({entityType:"ReviewSession",projection:["name","review_session_folder.name"],filter:`project_id is '${t}' and review_session_folder_id is None`,orderBy:"name"}),d=et({entityType:"ReviewSessionFolder",projection:["name","review_sessions.name"],filter:`project_id is '${t}'`,orderBy:"name"}),m=et({entityType:"List",projection:["name","category.name","is_open","system_type"],filter:`project_id is '${t}' `,orderBy:"name"}),[h,f,b]=await s.call([X.query(u),X.query(d),X.query(m)]),g=Ja(h.data,ks(t)),y=Ku(f.data,t),j=Yu(b.data,t);return[{id:ks(t),label:o.formatMessage(Qn["client-reviews"]),entityType:"ReviewSessionFolder",icon:"ondemand-video",parentId:t,children:[...y,...g]},{id:gn(t),label:o.formatMessage(Qn.lists),entityType:"List",icon:"list",parentId:t,children:[...j??[]]}]}})),c=p.useCallback(()=>{n.invalidateQueries({queryKey:i})},[n,i]);return Qo({entityTypes:["ReviewSession","ReviewSessionFolder","List","AssetVersionList","TypedContextList"],onEvent:p.useCallback(()=>{c()},[c]),matchFn:p.useCallback(({entity:u})=>!!((u?.changes?.review_session_folder_id||u?.changes?.name||u.changes?.isopen||u.changes?.entity)&&t),[t])}),{data:l,handleItemDrop:a}};function sp(t,s,o){const[n,r]=p.useState([]),{FT:a}=de(),i=qu(),l=he("entityId"),c=he("view"),u=he("entityType"),d=c??"tasks",m=he("itemId"),h=he("slideEntityId"),f=Ya(),{recentProjectIds:b,updateRecentProjects:g}=$c();p.useEffect(()=>{m==="projects"&&f&&g(f)},[m,g,f]);const y=p.useCallback(({entity:P,context:T})=>{const N=P.parents?.find(Y=>Y.entity_type==="Project")?.entityId;return N===f&&P?.changes?.review_session_folder_id&&(T.entityType==="ReviewSessionFolder"||T.entityType===Xn(P.entity_type))?!0:!!((P.changes?.name||P.changes?.isopen||P.changes?.typeid||P.changes?.statusid||P.changes?.enddate)&&N===f&&T.entityType===Xn(P.entity_type))},[f]),{data:{initialExpandedItems:j}={initialExpandedItems:void 0}}=Qu({currentEntityType:u,currentEntityId:l}),[w,v]=p.useState(j??[]);p.useEffect(()=>{v(P=>P.length===0?j??[]:P)},[j]);const{data:I=[]}=Jo({enabled:!!f}),{typedContextTreeItems:E}=Xu({currentProjectId:f,remoteLoadIds:n,handleQueryInvalidation:y,statusData:I}),L=ep({typedContextTreeItems:E,handleQueryInvalidation:y}),{data:_=[],handleItemDrop:R}=tp({currentProjectId:f}),{data:k=[]}=Zu({isSearchActive:t,filterValue:o,projectSearchValue:s,recentProjectIds:b,currentProjectId:f,reviewSessionTreeItems:_,typedContextTreeItems:L});p.useEffect(()=>{function P(T,N){T.forEach(Y=>{N(Y),P(Y.children,N)})}r(T=>{const N=new Set(T);return P(E,Y=>{w.includes(Y.id)&&Y.children.length===1&&Y.children[0].id.endsWith("-loading")&&N.add(Y.id)}),N.size!==T.length?[...N]:T})},[w,E]);const S=p.useCallback((P,T,N)=>{const Y=V=>{v(xe=>[...new Set([...xe,V])])},te=V=>{v(xe=>xe.filter(at=>at!==V))},q=i.current?.getItem(T);N?(q.entityType==="Project"&&(b?.filter(V=>V!==T).forEach(V=>{te(V)}),Ne({entityId:T,entityType:"show",itemId:"projects",view:Ts("tasks"),dashboardId:""})),Y(T)):te(T),P?.stopPropagation()},[i,b]),A=p.useCallback((P,T)=>{const N=i.current?.getItem(T);let Y="show",te=d,q=T;switch(N.entityType){case"List":q=N.icon&&N.parentId?N.parentId:T,te=N.icon&&N.parentId?"lists":te==="tasks"||te==="versions_v1"?N.view:Ts(te==="reviews"?"tasks":te),Y=N.icon&&N.parentId?"show":"list";break;case"ReviewSession":q=N.id,Y="reviewsession",te="tasks";break;case"ReviewSessionFolder":if(N.parentId===f)q=f??T,Y="show",te="reviews";else return;break;case"Project":q=N.id,te=Ts("tasks"),f!==T&&v([T]);break;case"ListCategory":return;default:Y="task",te=Ts(te==="reviews"||te==="lists"?"tasks":te);break}const V={slideEntityId:N.id,slideEntityType:a.toLegacyEntityType(N.entityType)},xe=N.canOpenSidebar&&h?V:{slideEntityId:"",slideEntityType:""};l===q&&u===Y&&N.canOpenSidebar&&d!=="reviews"&&d!=="lists"&&!h?Ne({entityType:Y,entityId:q,itemId:"projects",view:te,dashboardId:"",...V}):Ne({entityType:Y,entityId:q,itemId:"projects",view:te,dashboardId:"",...xe})},[i,l,u,f,h,d,a]),z=p.useMemo(()=>c==="reviews"&&f&&u!=="reviewsession"?ks(f):c==="lists"&&f?gn(f):l??"",[l,f,c,u]);return p.useEffect(()=>{z?z&&f&&!b.includes(f??"")&&v([z]):v([])},[f,b,z]),{selectedItem:z,apiRef:i,expandedItems:w,projectTree:k,onItemClick:A,onItemExpansionToggle:S,onItemDrop:R,currentProjectId:f,isSidebarOpen:h}}const op=J(e.jsx("path",{d:"M9 4c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6m8-13.74v2.09c2.33.82 4 3.04 4 5.65s-1.67 4.83-4 5.65v2.09c3.45-.89 6-4.01 6-7.74s-2.55-6.85-6-7.74"})),os=F({"no-matching-text":{id:"ftrack-spark-components.project-outliner-tree.no-matching-text",defaultMessage:"No matching projects found."},"no-projects-text":{id:"ftrack-spark-components.project-outliner-tree.no-matching-text",defaultMessage:"No recently visited projects."},"no-projects-tooltip":{id:"ftrack-spark-components.project-outliner-tree.no-matching-tooltip",defaultMessage:"Search above for projects to add them to the list."},"show-list-tooltip":{id:"ftrack-spark-components.project-outliner-tree.show-list-tooltip",defaultMessage:"Show closed lists"},"hide-list-tooltip":{id:"ftrack-spark-components.project-outliner-tree.hide-list-tooltip",defaultMessage:"Hide closed lists"}});function np({isSearchActive:t,searchValue:s,filterValue:o}){const{selectedItem:n,currentProjectId:r,apiRef:a,expandedItems:i,projectTree:l,onItemExpansionToggle:c,onItemClick:u,isSidebarOpen:d,onItemDrop:m}=sp(t,s,o),{data:h,mutate:f}=hn({key:"display-closed-lists",fallback:!1});if(l.length===0)return e.jsxs(C,{sx:{textAlign:"left",pl:2,display:"flex",alignItems:"center",gap:"4px",color:"text.secondary","& .MuiSvgIcon-root":{fontSize:"fontSizeSmall"},pt:1},component:"span",children:[e.jsx(op,{}),e.jsx(Z,{title:t?"":e.jsx(x,{...os["no-projects-tooltip"]}),children:e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeSmall",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:t?e.jsx(x,{...os["no-matching-text"]}):e.jsx(x,{...os["no-projects-text"]})})})]});const b=p.memo(function(){return e.jsx(Z,{title:h?e.jsx(x,{...os["show-list-tooltip"]}):e.jsx(x,{...os["hide-list-tooltip"]}),children:e.jsx(ie,{onClick:y=>{y.stopPropagation(),f(!h)},sx:{width:22,height:22,"&.MuiButtonBase-root .MuiSvgIcon-root":{width:18,height:18}},children:h?e.jsx(qi,{}):e.jsx(Gi,{})})})});return e.jsx(Xt,{children:e.jsx($u,{sx:{minHeight:200,mx:.25},items:l,slots:{item:Uu},slotProps:{item:{isListVisible:h,ListVisibilityIcon:b,selectedItem:n,currentProjectId:r,isSidebarOpen:d,onItemDrop:m}},expansionTrigger:"iconContainer",onItemClick:u,onItemExpansionToggle:c,apiRef:a,expandedItems:i,selectedItems:n})})}const rp=p.memo(np),Tt=F({"search-placeholder":{id:"ftrack-spark-components.accordion-nav-menu.search-placeholder",defaultMessage:"Find project"},"search-projects":{id:"ftrack-spark-components.accordion-nav-menu.search-projects",defaultMessage:"Search projects"},"search-in-projects":{id:"ftrack-spark-components.accordion-nav-menu.search-in-projects",defaultMessage:"Search in"},"create-project":{id:"ftrack-spark-components.accordion-nav-menu.create-project",defaultMessage:"Create project"},"all-project":{id:"ftrack-spark-components.accordion-nav-menu.all-project",defaultMessage:"All projects"},"active-project":{id:"ftrack-spark-components.accordion-nav-menu.active-project",defaultMessage:"Active projects"},"hidden-project":{id:"ftrack-spark-components.accordion-nav-menu.hidden-project",defaultMessage:"Hidden projects"}}),ap=({title:t,onClose:s,isInsideNav:o})=>{const n=oe(),{FT:r}=de();return e.jsx(ya,{title:t,id:"recent-projects",onClose:s,placeholder:n.formatMessage(Tt["search-placeholder"]),searchTooltip:n.formatMessage(Tt["search-projects"]),actionTooltip:n.formatMessage(Tt["create-project"]),isActionVisible:r.isAuth("CREATE_PROJECT"),NavAccordionContent:rp,onActionClick:()=>r.action.fn.createProject(null),sx:{flexGrow:1},isInsideNav:o,filterItems:[{title:n.formatMessage(Tt["search-in-projects"]),disabled:!0,filter:""},{title:n.formatMessage(Tt["all-project"]),disabled:!1,filter:""},{title:n.formatMessage(Tt["active-project"]),disabled:!1,filter:"active"},{title:n.formatMessage(Tt["hidden-project"]),disabled:!1,filter:"hidden"}]})},ip=J(e.jsx("path",{d:"M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),Zn=2083,er=255,Ke=F({"url-label":{id:"ftrack-spark-components.url-dialog.url-label",defaultMessage:"URL"},"display-name":{id:"ftrack-spark-components.url-dialog.display-name",defaultMessage:"Display name"},"url-dialog-title":{id:"ftrack-spark-components.webhooks-form.url-dialog-title",defaultMessage:"Add URL"},cancel:{id:"ftrack-spark-components.url-dialog.cancel",defaultMessage:"Cancel"},"remove-url":{id:"ftrack-spark-components.url-dialog.remove-url",defaultMessage:"Remove URL"},"save-changes":{id:"ftrack-spark-components.url-dialog.save-changes",defaultMessage:"Save changes"},"max-character-limit":{id:"ftrack-spark-components.webhooks-form.max-character-limit",defaultMessage:"{fieldName} can only be up to {limit} characters."}}),lp=t=>t?t.match(/[^:]+:/):!1,cp=t=>`http://${t}`,xn=({defaultValues:t=[{url:"",name:""}],onCancel:s,onSubmit:o,title:n,isRemovable:r,urlPrefix:a,description:i})=>e.jsx(ro,{open:!0,onCancel:s,PaperProps:{sx:{minWidth:"480px"}},children:e.jsx(dp,{defaultValues:t,onSubmit:o,title:n,isRemovable:r,urlPrefix:a,description:i})}),dp=({onSubmit:t,defaultValues:s,title:o,isRemovable:n=!0,urlPrefix:r,description:a})=>{const{setConfirmClose:i,handleCancel:l}=ao(),c=oe(),{control:u,handleSubmit:d,formState:{isDirty:m},setValue:h}=Ut({defaultValues:{url:s[0]?.url??"",name:s[0]?.name??""}});i(m);const f=b=>{lp(b.url)||(b.url=cp(b.url)),t([{url:b.url,name:b.name}])};return e.jsxs("form",{onSubmit:d(f),children:[e.jsx(Oe,{children:o??e.jsx(x,{...Ke["url-dialog-title"]})}),e.jsxs(Be,{sx:{mb:1},children:[a&&e.jsx(Ct,{sx:{my:1},children:a}),e.jsxs(ae,{spacing:2,sx:{py:1},children:[e.jsx(Xe,{name:"url",control:u,rules:{required:!0,maxLength:{value:Zn,message:c.formatMessage(Ke["max-character-limit"],{fieldName:c.formatMessage(Ke["url-label"]),limit:Zn})}},render:({field:{onChange:b,value:g},fieldState:{error:y}})=>{const j=w=>{try{const v=new globalThis.URL(w.target.value);h("url",(v.pathname??"")+(v.search??"")+(v.hash??""))}catch{h("url",w.target.value)}};return e.jsx(gs,{autoComplete:"off",required:!0,variant:"outlined",label:e.jsx(x,{...Ke["url-label"]}),value:g,onChange:r?w=>j(w):w=>b(w),error:!!y,helperText:y?.message,slotProps:{input:{startAdornment:r?e.jsx(Wr,{position:"start",sx:{mr:0},children:r}):null}}})}}),e.jsx(Xe,{name:"name",control:u,rules:{maxLength:{value:er,message:c.formatMessage(Ke["max-character-limit"],{fieldName:c.formatMessage(Ke["display-name"]),limit:er})}},render:({field:{onChange:b,value:g},fieldState:{error:y}})=>e.jsx(gs,{variant:"outlined",label:e.jsx(x,{...Ke["display-name"]}),value:g,onChange:b,error:!!y,helperText:y?.message??""})})]})]}),e.jsxs(Ve,{sx:{display:"flex",justifyContent:"space-between",pl:2},children:[n&&e.jsx(U,{color:"error",disabled:!s[0].url,onClick:()=>t([]),children:e.jsx(x,{...Ke["remove-url"]})}),e.jsxs(C,{sx:{display:"flex",width:n?"auto":"100%",justifyContent:n?"start":"end"},children:[e.jsx(U,{color:"neutral",onClick:()=>{l()},children:e.jsx(x,{...Ke.cancel})}),e.jsx(U,{type:"submit",children:e.jsx(x,{...Ke["save-changes"]})})]})]})]})},it=F({"no-matching-text":{id:"ftrack-spark-components.bookmarks.no-matching-text",defaultMessage:"No matching bookmarks found"},"edit-bookmark":{id:"ftrack-spark-components.bookmarks.edit-bookmark",defaultMessage:"Edit bookmark"},"delete-bookmark":{id:"ftrack-spark-components.bookmarks.delete-bookmark",defaultMessage:"Delete bookmark"},"delete-bookmark-success":{id:"ftrack-spark-components.bookmarks.delete-bookmark-success",defaultMessage:"Successfully deleted bookmark."},"update-bookmark-success":{id:"ftrack-spark-components.bookmarks.update-bookmark-success",defaultMessage:"Successfully updated bookmark."},"delete-bookmark-error":{id:"ftrack-spark-components.bookmarks.delete-bookmark-error",defaultMessage:"Failed to delete bookmark."},"update-bookmark-error":{id:"ftrack-spark-components.bookmarks.update-bookmark-error",defaultMessage:"Failed to update bookmark."},"empty-bookmark":{id:"ftrack-spark-components.bookmarks.empty-bookmark",defaultMessage:"No bookmarks added."}}),up=window.location.origin;function pp({isSearchActive:t,bookmarks:s,searchValue:o}){const[n,r]=p.useState(!1),[a,i]=p.useState(void 0),{FT:l}=de(),c=H(),u=oe(),d=c.serverInformation?.user_information?.id,m=p.useMemo(()=>s?.filter(I=>I.name?.toLowerCase().includes(o?.toLowerCase()??"")),[s,o]),h=t?m:s,{mutate:f}=st({entityId:a?.id??"",entityType:"Bookmark",name:"delete-bookmark",projection:["id"],optimisticallyMutate:!0,onError:()=>l.notifyError(u.formatMessage(it["delete-bookmark-error"])),action:"delete",onSuccess:()=>l.notifySuccess(u.formatMessage(it["delete-bookmark-success"]))}),{mutate:b}=st({entityId:a?.id??"",entityType:"Bookmark",name:"update-bookmark",projection:["id"],optimisticallyMutate:!0,onError:()=>l.notifyError(u.formatMessage(it["update-bookmark-error"])),onSuccess:()=>l.notifySuccess(u.formatMessage(it["update-bookmark-success"]))}),g=p.useCallback(I=>{i(I),r(!0)},[i]),y=p.useCallback(()=>{r(!1)},[]),j=I=>{window.location.assign(up+I)},w=p.useCallback(I=>{i(I),setTimeout(()=>{f({id:I.id})})},[f,i]),v=p.useCallback(I=>{const{url:E,name:L}=I[0];b({id:a?.id,path:E.replace("http://",""),name:L,user_id:d}),y()},[b,a,d,y]);return t&&h?.length===0?e.jsx(C,{sx:{textAlign:"center",py:1},children:e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeSmall"},children:e.jsx(x,{...it["no-matching-text"]})})}):!t&&s?.length===0?e.jsxs(C,{sx:{textAlign:"left",pl:2,display:"flex",alignItems:"center",gap:"4px",color:"text.secondary","& .MuiSvgIcon-root":{fontSize:"fontSizeSmall"},pt:1},component:"span",children:[e.jsx(ba,{}),e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeSmall",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.jsx(x,{...it["empty-bookmark"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(St,{sx:{pt:0},children:h?.map((I,E)=>{const L=(window.location.pathname??"")+(window.location.search??"")+(window.location.hash??"")===I.path;return e.jsxs(Go,{onClick:()=>j(I.path),sx:{py:0,borderRadius:"8px",pr:0,"& span.MuiBox-root":{display:"none"},"&:hover span.MuiBox-root":{display:"block"}},children:[e.jsx(Le,{sx:{"& .MuiSvgIcon-root":{fontSize:"20px"},minWidth:"28px"},children:L?e.jsx(Ki,{}):e.jsx(ip,{})}),e.jsx(we,{sx:{"& .MuiTypography-root":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:I.name??""}),e.jsxs(C,{component:"span",sx:{"& .MuiSvgIcon-root":{fontSize:"14px"},whiteSpace:"nowrap"},children:[e.jsx(Z,{title:e.jsx(x,{...it["edit-bookmark"]}),placement:"bottom",disableInteractive:!0,children:e.jsx(ie,{size:"small",onClick:_=>{_.stopPropagation(),g(I)},children:e.jsx(Br,{})})}),e.jsx(Z,{title:e.jsx(x,{...it["delete-bookmark"]}),placement:"right",disableInteractive:!0,children:e.jsx(ie,{size:"small",onClick:_=>{_.stopPropagation(),w(I)},children:e.jsx(Xo,{})})})]})]},E)})}),n&&e.jsx(xn,{defaultValues:[{url:a?.path??"",name:a?.name??""}],onCancel:y,onSubmit:v,title:u.formatMessage(it["edit-bookmark"]),isRemovable:!1,urlPrefix:window.location.origin})]})}const Et=F({"search-placeholder":{id:"ftrack-spark-components.bookmarks-section.find-bookmarks",defaultMessage:"Find bookmark"},"search-bookmarks":{id:"ftrack-spark-components.bookmarks-section.search-bookmarks",defaultMessage:"Search bookmarks"},"add-to-bookmarks":{id:"ftrack-spark-components.bookmarks-section.add-to-bookmarks",defaultMessage:"Add to bookmarks"},"create-bookmark-success":{id:"ftrack-spark-components.bookmarks-section.create-bookmark-success",defaultMessage:"Successfully created bookmark."},"create-bookmark-error":{id:"ftrack-spark-components.bookmarks-section.create-bookmark-error",defaultMessage:"Failed to create bookmark."},"bookmark-description":{id:"ftrack-spark-components.bookmarks-section.bookmark-description",defaultMessage:"Bookmarking to external pages are not supported."}}),mp=({title:t,onClose:s,isInsideNav:o})=>{const[n,r]=p.useState(!1),{FT:a}=de(),i=oe(),l=H(),c=l.serverInformation?.user_information?.id,{data:u,refetch:d}=no({name:"get-bookmarks",entityType:"Bookmark",projection:["id","name","path"],filter:`user_id is "${c}"`,staleTime:1/0,limit:100,orderBy:"name"}),m=p.useCallback(()=>{r(!0)},[r]),h=p.useCallback(()=>{r(!1)},[r]),f=p.useCallback(async b=>{const{url:g,name:y}=b[0];try{(await l.create("Bookmark",{path:g.replace("http://",""),name:y,user_id:c})).data&&(a.notifySuccess(i.formatMessage(Et["create-bookmark-success"])),d())}catch{a.notifyError(i.formatMessage(Et["create-bookmark-error"]))}h()},[l,c,a,i,h,d]);return e.jsxs(e.Fragment,{children:[e.jsx(ya,{title:t,onClose:s,placeholder:i.formatMessage(Et["search-placeholder"]),searchTooltip:i.formatMessage(Et["search-bookmarks"]),actionTooltip:i.formatMessage(Et["add-to-bookmarks"]),isActionVisible:!0,NavAccordionContent:({...b})=>e.jsx(pp,{bookmarks:u,...b}),onActionClick:m,isInsideNav:o,id:"bookmarks",listSx:{maxHeight:193}}),n&&e.jsx(xn,{defaultValues:[{url:(window.location.pathname??"")+(window.location.search??"")+(window.location.hash??""),name:window.document.title.replace(" - ftrack","")}],onCancel:h,onSubmit:f,title:i.formatMessage(Et["add-to-bookmarks"]),isRemovable:!1,description:i.formatMessage(Et["bookmark-description"]),urlPrefix:window.location.origin})]})},tr=({title:t,isDrawerCollapsed:s,id:o})=>{const[n,r]=p.useState(!1),a=p.useRef(null),l=H().getSchema("Bookmark"),c=()=>{r(!0)},u=()=>{r(!1)};if(!l&&o==="bookmarks")return null;const d=o==="recent-projects"?ap:mp;return s?e.jsxs("ul",{children:[e.jsx(Bt,{sx:{pl:1},children:e.jsx(Z,{title:t,placement:"right",children:e.jsx(ie,{onClick:c,ref:a,children:o==="recent-projects"?e.jsx(Yi,{sx:{fontSize:"2rem"}}):e.jsx(ba,{sx:{fontSize:"2rem"}})})})}),e.jsx(oo,{anchorEl:a.current,open:n,onClose:u,sx:{maxHeight:550,"&.MuiPopover-root":{zIndex:19e3},"& .MuiMenu-paper":{minWidth:231}},children:e.jsx(p.Suspense,{fallback:e.jsx(C,{sx:{mt:2,minHeight:36},children:e.jsx(xt,{sx:{display:"flex",m:"auto"},size:25})}),children:e.jsx(d,{title:t,onClose:u,isInsideNav:!1})})})]}):e.jsx(d,{title:t})},sr=F({collapse:{id:"ftrack-spark-components.navigation-dock-button.collapse",defaultMessage:"Collapse"},expand:{id:"ftrack-spark-components.navigation-dock-button.expand",defaultMessage:"Expand"}}),fp=({isDrawerCollapsed:t,className:s,onClick:o})=>{const n=Ue(),r=n.palette.text.primary,a=n.palette.mode;return e.jsx(Z,{title:t?e.jsx(x,{...sr.expand}):e.jsx(x,{...sr.collapse}),placement:"right",children:e.jsx(ie,{className:s,sx:{alignSelf:t?"center":"flex-end",px:0,mt:"auto"},onClick:o,children:e.jsx(Ji,{sx:{width:20,height:20},children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("g",{id:"dock_to_right_24dp_E8EAED_FILL0_wght400_GRAD0_opsz24 1",children:e.jsx("path",{id:"Vector",d:"M4.16667 17.5C3.70833 17.5 3.31597 17.3368 2.98958 17.0104C2.66319 16.684 2.5 16.2917 2.5 15.8333V4.16667C2.5 3.70833 2.66319 3.31597 2.98958 2.98958C3.31597 2.66319 3.70833 2.5 4.16667 2.5H15.8333C16.2917 2.5 16.684 2.66319 17.0104 2.98958C17.3368 3.31597 17.5 3.70833 17.5 4.16667V15.8333C17.5 16.2917 17.3368 16.684 17.0104 17.0104C16.684 17.3368 16.2917 17.5 15.8333 17.5H4.16667ZM6.66667 15.8333V4.16667H4.16667V15.8333H6.66667ZM8.33333 15.8333H15.8333V4.16667H8.33333V15.8333Z",fill:r,fillOpacity:a==="dark"?.6:1})})})})})})},hp=500,Co=52,gp=40,xp=231,or=t=>Math.min(hp,t*gp/100);function bp({width:t,onResize:s}){const[o,n]=p.useState(0),[r,a]=p.useState(!1),[i,l]=p.useState(0),[c,u]=p.useState(!1),[d,m]=p.useState(window.innerWidth),h=Ue(),f=xs(h.breakpoints.down("sm")),b=xs(h.breakpoints.down("md")),g=p.useRef(null),{x:y}=Qi(),j=p.useMemo(()=>!(i+t<Co||i+t>or(d)),[d,i,t]),w=()=>{const I=g.current?.getBoundingClientRect()?.right??0;n(I),l(0),a(!0)},v=p.useCallback(()=>{a(!1);const I=or(d),E=t+i;E>130?E>=I?(Kt("navbar-width",I),s(I)):(Kt("navbar-width",E),s(E)):s(Co),l(0)},[i,s,t,d]);return p.useEffect(()=>{if(r&&g.current){const I=y-o;l(I)}},[r,y,o,t,i]),p.useEffect(()=>{const I=Xi(()=>{const E=Nt("navbar-width",xp);return Nt("is-drawer-collapsed",!1)&&b&&!f?s(E):f&&s(Co),m(window.innerWidth)},100);return window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[b,f,s,t,d]),e.jsx(C,{ref:g,sx:[{boxSizing:"border-box",position:"absolute",top:0,right:-i,bottom:0,height:1},c?{zIndex:5,borderRight:"1px solid",borderColor:"text.secondary"}:{},r?{zIndex:5,borderRight:"1px dashed",borderColor:"primary.main","&:hover":{borderRight:"1px dashed",borderColor:"primary.main"}}:{}],children:e.jsx(qo,{mouseEvent:r?"onMouseUp":!1,onClickAway:v,children:e.jsx(C,{onMouseDown:w,onMouseUp:v,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),sx:{position:r?"fixed":"absolute",width:r?"100vw":10,top:0,bottom:0,right:0,zIndex:2,"&:hover":{cursor:j?"ew-resize":"not-allowed"}}})})})}const nr=F({"recent-projects":{id:"ftrack-spark-components.navigation-drawer.recent-projects",defaultMessage:"Recent projects"},bookmarks:{id:"ftrack-spark-components.navigation-drawer.bookmarks",defaultMessage:"Bookmarks"}}),Vo=231,yp=Nt("navbar-width")||Vo,Mo=52,jp=()=>{const t=Ue(),s=xs(t.breakpoints.down("sm")),o=he("itemId"),[n,r]=p.useState(Nt("is-drawer-collapsed")),[a,i]=p.useState(n?Mo:yp);p.useEffect(()=>{window.dispatchEvent(new CustomEvent("navbar-width-change",{detail:a}))},[a]);const l=p.useCallback(u=>{u<=130||s?(i(Mo),r(!0),Kt("is-drawer-collapsed",!0)):(i(u),r(!1),Kt("is-drawer-collapsed",!1))},[s]),c=p.useCallback(()=>{const u=Nt("navbar-width",Vo),d=u<=130?Vo:u;r(m=>(i(m?d:Mo),Kt("is-drawer-collapsed",!m),!m)),Kt("navbar-width",d)},[]);return o==="me"||o==="newconfigure"?null:e.jsx(Zi,{role:"navigation",sx:[{gridArea:"navbar",width:a,userSelect:"none",transition:"width 0.5s ease","& .MuiDrawer-paper":{height:"calc(100% - var(--topmenu-height))",mt:"var(--topmenu-height)",display:"flex",width:a,boxSizing:"border-box",border:"none",bgcolor:"background.paper",borderRight:"1px solid",borderRightColor:"other.sidebarBorder",overflowX:"hidden",overflow:"visible",transition:"width 0.5s ease"},".dockButton":{opacity:0},"&:hover":{".dockButton":{opacity:1}}}],variant:"permanent",anchor:"left",children:e.jsxs(Xt,{children:[e.jsx(md,{isDrawerCollapsed:n}),e.jsx(gd,{isDrawerCollapsed:n}),e.jsx(C,{sx:{maxHeight:"71%",overflow:"hidden",display:"grid"},children:e.jsxs(p.Suspense,{fallback:e.jsx(C,{sx:{mt:2,minHeight:36},children:e.jsx(rt,{sx:{display:"flex",m:"auto"},size:25})}),children:[e.jsx(tr,{title:e.jsx(x,{...nr.bookmarks}),isDrawerCollapsed:n,id:"bookmarks"}),e.jsx(tr,{title:e.jsx(x,{...nr["recent-projects"]}),isDrawerCollapsed:n,id:"recent-projects"})]})}),e.jsx(fp,{isDrawerCollapsed:n,className:"dockButton",onClick:c}),e.jsx(dd,{isDrawerCollapsed:n}),e.jsx(bp,{width:a,onResize:l})]})})},kp=J(e.jsx("path",{d:"M3 10h11v2H3zm0-4h11v2H3zm0 8h7v2H3zm17.59-2.07-4.25 4.24-2.12-2.12-1.41 1.41L16.34 19 22 13.34z"})),wp=F({jobs:{id:"ftrack-spark-components.jobs-icon.jobs",defaultMessage:"Jobs"}}),vp=()=>{const t=H(),{FT:s,isReady:o}=de(),n=t.serverInformation?.user_information?.id,r=p.useMemo(()=>K.tz().startOf("day").subtract(30,"day").toISOString(),[]),{data:a}=no({name:"page-header-jobs",entityType:"Job",filter:`user_id is "${n}" and status in ('queued', 'running') and created_at > "${r}"`,projection:["id"],limit:1,staleTime:1/0,invalidateOnUpdatesFn:p.useCallback(({entity:i})=>i.action==="job_updated"&&Object.prototype.hasOwnProperty.call(i.changes??{},"status")||i.action==="job_updated"&&i.entityId===n,[n])});return e.jsx(Z,{title:e.jsx(x,{...wp.jobs}),children:e.jsx(ie,{onClick:p.useCallback(()=>o&&s.action?.fn?.showJobsPanel(),[o,s.action?.fn]),children:e.jsx(Vr,{invisible:!a?.length,color:"error",variant:"dot",sx:{"& .MuiBadge-badge":{top:4,right:4}},children:e.jsx(kp,{sx:{"&.MuiSvgIcon-root":{fontSize:"2.8rem",color:a?.length?"primary.main":"text.secondary"}}})})})})},Sp=J(e.jsx("path",{d:"M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2m0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19z"})),_p=F({inbox:{id:"ftrack-spark-components.inbox-icon.inbox",defaultMessage:"Inbox"}}),Ip=()=>{const t=H(),{FT:s,isReady:o}=de(),n=t.serverInformation?.user_information?.id,r=p.useMemo(()=>K.tz().startOf("day").subtract(30,"day").toISOString(),[]),{data:a}=no({name:"inbox",entityType:"SocialNotification",filter:`owner_id is "${n}" and read is "false" and created_at > "${r}"`,projection:["count(id)"],groupBy:"owner_id",keepPreviousData:!1,invalidateOnUpdates:!1});return e.jsx(Z,{title:e.jsx(x,{..._p.inbox}),children:e.jsx(ie,{onClick:p.useCallback(()=>o&&s.action?.fn?.showInbox(),[o,s.action?.fn]),children:e.jsx(Vr,{variant:"dot",invisible:a?.length===0,color:"error",children:e.jsx(Sp,{})})})})},Cp=F({"track-time":{id:"ftrack-spark-components.page-top-header.track-time",defaultMessage:"Track time"}}),rr=({value:t,unit:s,locale:o=navigator.language})=>new Intl.NumberFormat(o,{style:"unit",unit:s,unitDisplay:"short"}).format(t);function Mp({seconds:t,locale:s}){const o=[{unit:"year",secs:31536e3},{unit:"month",secs:2592e3},{unit:"week",secs:604800},{unit:"day",secs:86400},{unit:"hour",secs:3600},{unit:"minute",secs:60},{unit:"second",secs:1}];for(let n=0;n<o.length;n++){const{unit:r,secs:a}=o[n];if(t>=a||r==="second"){const i=Math.floor(t/a),l=t%a;let c=rr({value:i,unit:r,locale:s});if(n+1<o.length&&l>0){const u=o[n+1],d=Math.floor(l/u.secs);d>0&&(c+=" "+rr({value:d,unit:u.unit,locale:s}))}return c}}}const Tp=t=>Hr({name:"timer",entityType:"Timer",filter:`user_id is "${t}"`,projection:["id","start"],keepPreviousData:!1}),Ep=()=>{const{FT:t,isReady:s}=de(),o=H(),[n,r]=p.useState(0),a=o.serverInformation?.user_information?.id,i=o.serverInformation?.preferred_language,l=Zo(i),{data:c,refetch:u}=Ur(Tp(a));Qo({entityType:"Timer",onEvent:p.useCallback(()=>{u({cancelRefetch:!1})},[u]),matchFn:p.useCallback(({entity:h})=>{if(h.entity_type=="Timer"){const f=h.parents?.[1];if(f&&f.entity_type=="User"&&f.entityId==a)return h.action=="remove"?r(0):(h.action=="update"||h.action=="add")&&u({cancelRefetch:!1}),!0}return!1},[a,u])}),p.useEffect(()=>{if(c?.length){r(K().diff(K(c?.[0]?.start),"seconds"));const h=setInterval(()=>{r(K().diff(K(c?.[0]?.start),"seconds"))},1e3);return()=>clearInterval(h)}},[c]);const d=p.useCallback(()=>s&&t.action?.fn?.showTimeLogs(),[s,t.action?.fn]),m=p.useMemo(()=>n?Mp({seconds:n,locale:l}):null,[n,l]);return e.jsx(Z,{title:e.jsx(x,{...Cp["track-time"]}),children:m?e.jsx(U,{startIcon:n?e.jsx(Mn,{}):null,variant:"text",onClick:d,sx:{height:32,whiteSpace:"nowrap",textTransform:"lowercase",borderBottom:n?"2px solid":"none",borderColor:"primary.main",borderRadius:0,"& .MuiSvgIcon-root":{color:c?.length?"primary.main":"text.secondary"}},children:m}):e.jsx(ie,{onClick:d,children:e.jsx(Mn,{})})})},Rp=()=>e.jsx(el,{sx:{gap:"16px",position:"relative",right:8,"& .MuiSvgIcon-root":{fontSize:"2rem",color:"text.secondary"}},children:e.jsxs(p.Suspense,{fallback:e.jsx(rt,{size:18}),children:[e.jsx(Ep,{}),e.jsx(vp,{}),e.jsx(Ip,{})]})}),ns=F({"free-period-expired":{id:"ftrack-spark-components.trial-expiry-button.free-period-expired",defaultMessage:"Free period expired"},"free-period-ends-in":{id:"ftrack-spark-components.trial-expiry-button.free-period-ends-in",defaultMessage:"Free period ends in {numberOfDays} days"},"free-period-ends-today":{id:"ftrack-spark-components.trial-expiry-button.free-period-ends-today",defaultMessage:"Free period ends today"},"free-period-ends-tomorrow":{id:"ftrack-spark-components.trial-expiry-button.free-period-ends-tomorrow",defaultMessage:"Free period ends tomorrow"},"upgrade-now":{id:"ftrack-spark-components.trial-expiry-button.upgrade-now",defaultMessage:"Upgrade now"}}),Qa=({expiresAt:t,style:s,onClick:o})=>{let n=null;const r=K(t).tz().diff(K.tz()),a=K(t).tz(),i=Math.round(K(t).tz().diff(K.tz(),"hours")/24),l=a.startOf("day").isSame(K().tz().startOf("day")),c=a.startOf("day").isSame(K().tz().startOf("day").add(1,"days"));let u="warning";return r>=0?l?(n=e.jsx(x,{...ns["free-period-ends-today"]}),u="error"):c?n=e.jsx(x,{...ns["free-period-ends-tomorrow"]}):(n=e.jsx(x,{...ns["free-period-ends-in"],values:{numberOfDays:i}}),u="info"):(n=e.jsx(x,{...ns["free-period-expired"]}),u="error"),e.jsx(Yo,{severity:u,sx:{py:0,"& .MuiAlert-message":{textTransform:"uppercase",fontSize:"fontSizeRegular",fontWeight:"fontWeightMedium",whiteSpace:"nowrap"},"& .MuiAlert-action":{p:0},"&.MuiAlert-root":{zIndex:1},...s},action:e.jsx(Z,{title:e.jsx(x,{...ns["upgrade-now"]}),children:e.jsx(ie,{sx:{width:37,height:37,"& .MuiSvgIcon-root ":{fontSize:"fontSizeLarge",color:"primary.main"}},onClick:o,children:e.jsx(fa,{})})}),children:n})},rs=F({team:{id:"ftrack-spark-components.page-top-header-container.team",defaultMessage:"Team"},"client-reviews":{id:"ftrack-spark-components.page-top-header-container.client-reviews",defaultMessage:"Client reviews"},lists:{id:"ftrack-spark-components.page-top-header-container.lists",defaultMessage:"Lists"}}),Pp=()=>{const t=he("itemId"),s=he("entityId"),o=he("view"),n=he("entityType"),r=!!(t==="projects"&&s),{data:a,isLoading:i}=Vt({entityType:(n&&Xs[n].entityType)??"Context",entityId:s,projection:(n&&Xs[n].projection)??[],name:"page-top-typecontext-heading",enabled:r,staleTime:1/0,keepPreviousData:!0}),l=oe(),c=p.useMemo(()=>{if(r)return o==="team"?[{id:"team",name:l.formatMessage(rs.team),type:"Context",disabled:!0}]:n==="reviewsession"?[{id:"reviews",name:l.formatMessage(rs["client-reviews"]),type:"ReviewSession",disabled:!0},a?.review_session_folder?.id?{id:a?.review_session_folder?.id,name:a?.review_session_folder?.name,type:"ReviewSessionFolder",disabled:!0}:{},{id:a?.id,name:a?.name,type:"ReviewSession",disabled:!0}]:o==="reviews"?[{id:"reviews",name:l.formatMessage(rs["client-reviews"]),type:"ReviewSession",disabled:!0}]:o==="lists"?[{id:"lists",name:l.formatMessage(rs.lists),type:"List",disabled:!0}]:n==="list"?[{id:"lists",name:l.formatMessage(rs.lists),type:"List",disabled:!0},{id:a?.category?.id,name:a?.category?.name,type:"ListCategory",disabled:!0},{id:a?.id,name:a?.name,type:"List"}]:a?.link?.slice(1)},[o,n,a,r,l]),u=Ya();return{isLoading:i,breadcrumbs:c,entityId:s,entityType:n,projectId:u}},Ap=F({actions:{defaultMessage:"Actions",description:"Tooltip for actions button.",id:"ftrack-spark-components.action-launch-button.action"}}),Lp=({selectedItems:t,sx:s,onActionIconClick:o})=>{const n=p.useCallback(()=>{o?o(t):qr(t)},[o,t]);return e.jsx(Z,{title:e.jsx(x,{...Ap.actions}),children:e.jsx(ie,{onClick:n,sx:s,children:e.jsx(tl,{sx:{fontSize:"fontSizeLarge"}})})})},as=F({report:{id:"ftrack-spark-components.page-header.report",defaultMessage:"Reports"},home:{id:"ftrack-spark-components.page-header.home",defaultMessage:"My Tasks"},overview:{id:"ftrack-spark-components.page-header.overview",defaultMessage:"Overview"},me:{id:"ftrack-spark-components.page-header.me",defaultMessage:"Account settings"},newconfigure:{id:"ftrack-spark-components.page-header.newconfigure",defaultMessage:"System settings"}}),ar={home:e.jsx(x,{...as.home}),overview:e.jsx(x,{...as.overview}),report:e.jsx(x,{...as.report}),me:e.jsx(x,{...as.me}),newconfigure:e.jsx(x,{...as.newconfigure})},Dp={home:e.jsx(xa,{}),overview:e.jsx(ga,{}),report:e.jsx(ln,{}),me:e.jsx(ua,{}),newconfigure:e.jsx(Lr,{})},Op=async t=>{const s=Qt(),o=et({entityType:"TypedContext",projection:["object_type_id"],filter:`id is '${t?.[0]?.id}' `,orderBy:"name"});await s.call([X.query(o)]).then(([n])=>{if(n.data?.[0]?.object_type_id)return qr([{...t[0],objectTypeId:n.data[0].object_type_id}])})},zp=({entityType:t,view:s,entityId:o})=>{if(!t||!o)return null;if(s==="team")return{id:"team",type:"team",isLegacyType:!0};if(t==="task")return{id:o,type:t,isLegacyType:!0,onClick:Op};if(t==="list"||t==="reviewsession"||t==="show"&&s!=="reviews")return{id:o,type:t,isLegacyType:!0};if(t==="show"&&s==="lists")return{id:"lists",type:"lists",isLegacyType:!0}},Fp=()=>{const{projectId:t,breadcrumbs:s}=Pp(),o=he("itemId"),n=he("entityId"),r=he("entityType"),a=he("view"),i=zp({entityType:r,view:a,entityId:n}),l=o==="projects",{open:c}=Gr(),{data:u,isLoading:d}=Vt({entityType:"Project",entityId:t,projection:["link","color","status"],name:"page-top-project-heading",enabled:!!(l&&n&&t),staleTime:1/0,keepPreviousData:!0}),m=u?.color?{color:u?.color}:{color:"transparent"},h=y=>{y.id&&y.type&&c({entityType:y.type,entityId:y.id})},b=[...u?.link??[],...s??[]]?.map(y=>({id:y.id,title:y.name,onClick:()=>h(y),disabled:y.disabled})),g=l&&!d;return e.jsx(e.Fragment,{children:e.jsx(ae,{direction:"row",justifyContent:"space-between",sx:{width:"87%",overflow:"hidden","& .MuiTypography-root.MuiLink-root":{color:"text.secondary",fontSize:"fontSizeSmall",fontWeight:"fontWeightRegular"}},children:e.jsxs(C,{sx:{display:"flex",mb:1,gap:1,pt:.5,alignItems:"center",width:"inherit","& .MuiTypography-root:first-of-type":{textWrap:"nowrap",overflow:"hidden",textOverflow:"ellipsis",alignSelf:"self-start",fontSize:"1.8rem",color:u?.status==="hidden"?"text.secondary":"text.primary"},"& .MuiTypography-root:not(:first-of-type)":{mt:.25},"& .MuiSvgIcon-root":{mt:.25}},children:[g&&!d&&e.jsx($r,{status:u?.status,sx:{...m,height:25,width:25}}),o&&ar[o]&&e.jsxs(M,{variant:"h5",sx:{display:"flex",gap:"4px","& .MuiSvgIcon-root ":{fontSize:"2rem"}},children:[Dp[o],ar[o]]}),b?.length&&g?e.jsx(sl,{items:b,sx:{color:"text.secondary"},sxBreadcrumb:{fontSize:"fontSizeSmall",fontWeight:"fontWeightMedium",display:"flex",alignItems:"center","& .MuiTypography-root":{display:"block"},"& .MuiTypography-root:hover":{textDecoration:"underline"}},truncation:"simple",separator:({sx:y})=>e.jsx(ol,{sx:{fontSize:"fontSizeLarge",color:"text.disabled",opacity:y?.opacity}})}):null,i&&n&&g?e.jsx(Lp,{selectedItems:[i],sx:{width:25,height:25},onActionIconClick:i?.onClick}):null]})})})};function $p({children:t,primaryOpen:s,mode:o,width:n}){return e.jsx(C,{sx:[r=>({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto 1fr",gridTemplateAreas:`
            "navbar header"
            "navbar main"
          `,height:"calc(100% - var(--topmenu-height))",mt:"var(--topmenu-height)",marginRight:0,transition:r.transitions.create("width",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.enteringScreen}),width:s&&o==="docked"?`calc(100% - ${n}px)`:"100%"})],children:t})}function Hg({children:t}){return e.jsx(C,{component:"main",sx:{gridArea:"main",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"baseline"},children:t})}const qg=({sx:t,children:s})=>{const o=H(),{FT:n}=de(),r=o.serverInformation?.subscriptionBillingUrl,a=o?.serverInformation?.require_billing_info_before;return e.jsx(Xt,{children:e.jsxs(C,{sx:{zIndex:10,minWidth:"76%"},children:[e.jsxs(C,{sx:[{display:"flex",justifyContent:"space-between",px:2,pt:2,pb:0,gridArea:"header",gap:"12px"},...Array.isArray(t)?t:[t]],children:[e.jsx(Fp,{}),n?.isAuth("CONFIGURE")&&a?e.jsx(Qa,{expiresAt:a,onClick:()=>r?window.open(r,"_blank"):Ne({itemId:"newconfigure",view:"account"})}):null,e.jsx(Rp,{})]}),s]})})},Np=p.memo(function({primaryOpen:s,mode:o,Element:n,width:r}){return e.jsx(C,{sx:[a=>({display:"flex",alignItems:"center",justifyContent:"center",height:"100%",marginRight:0,transition:a.transitions.create("width",{easing:a.transitions.easing.easeOut,duration:a.transitions.duration.enteringScreen}),width:s&&o==="docked"?`calc(100% - ${r}px)`:"100%"})],children:e.jsx(p.Suspense,{fallback:e.jsx(rt,{}),children:e.jsx(n,{})})})}),Wp=()=>e.jsx(hs,{header:"404"}),Bp=[{path:"itemId=overview",Element:p.lazy(()=>$e(()=>import("../overview-LRLOcrzk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url)),permission:"ACCESS_OVERVIEW"},{path:"itemId=home",Element:p.lazy(()=>$e(()=>import("../mytasks-BpzRvNnR.js"),__vite__mapDeps([22,1,2,5]),import.meta.url)),permission:"HOME"},{path:"itemId=report",Element:p.lazy(()=>$e(()=>import("../report-nQUyZb76.js"),__vite__mapDeps([23,1,2,5]),import.meta.url)),permission:"REPORTS"},{path:"itemId=projects",Element:p.lazy(()=>$e(()=>import("../projects-C5SlQwtp.js"),__vite__mapDeps([24,1,2,4,5,6,3]),import.meta.url)),permission:"PROJECTS"},{path:"itemId=newconfigure",Element:p.lazy(()=>$e(()=>import("../systemsettings-D8I5dogA.js"),__vite__mapDeps([25,1,2,26,5]),import.meta.url)),permission:"CONFIGURE"},{path:"itemId=me",Element:p.lazy(()=>$e(()=>import("../account-xYLw6vZI.js"),__vite__mapDeps([27,1,2,26,5]),import.meta.url)),permission:"EVERYONE"}];function Vp(){const{isReady:t}=de();p.useEffect(()=>{const s=window.document.querySelector(".topmenu")?.parentElement?.parentElement;if(!t||!s)return;document.documentElement.style.setProperty("--topmenu-height",`${s?.clientHeight}px`),new ResizeObserver(n=>{for(const r of n){const a=r.target;document.documentElement.style.setProperty("--topmenu-height",`${a.clientHeight}px`)}}).observe(s)},[t])}const Up=p.memo(function(){const s=nl(),o=s.pathname,n=H(),r=Bp.find(y=>{const j=y.permission==="EVERYONE"||n.serverInformation?.user_information?.permissions?.includes(y.permission);return o.includes(y.path)&&j})?.Element??Wp,a=he("slideEntityId"),i=he("slideEntityType");Vp(),p.useEffect(()=>{rl()},[s]);const l=n.serverInformation?.enable_new_navigation,{open:c,close:u,primary:{width:d,open:m,mode:h}}=Gr(),{FT:f,isReady:b}=de(),g=i&&b?f?.fromLegacyEntityType?.(i):void 0;return p.useEffect(()=>{const y=Nt("sidebar-mode");a&&g?c({entityType:g,entityId:a,mode:y,onClose:()=>{Ne({slideEntityId:"",slideEntityType:""})},onWidthChange:j=>{window.dispatchEvent(new CustomEvent("sidebar-width-change",{detail:j}))},onModeChange:j=>{window.dispatchEvent(new CustomEvent("sidebar-mode-change",{detail:j}))}}):u()},[u,c,a,g]),b?l?e.jsxs($p,{primaryOpen:m,mode:h,width:d,children:[e.jsx(jp,{}),e.jsx(p.Suspense,{fallback:e.jsx(C,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"99vh",overflow:"hidden"},children:e.jsx(rt,{})}),children:e.jsx(Xt,{children:e.jsx(r,{})})})]}):e.jsx(Np,{primaryOpen:m,mode:h,Element:r,width:d}):null});function Hp(t,s,o={}){const n=p.useRef(null),r=p.useCallback(()=>{n.current&&(n.current.disconnect(),n.current=null)},[]);return p.useEffect(()=>{const a="current"in t?t.current:t;if(a)return n.current=new window.MutationObserver(s),n.current?.observe(a,o),r},[s,r,o,t]),{stop:r}}function qp(){const t=H(),{FT:s}=de(),[o,n]=p.useState(),r=t.serverInformation?.is_new_actions_ui_enabled,a=p.useCallback(l=>{r?n(l):s.action.fn.openActions(l.map(c=>({entityType:c.isLegacyType?c.entityType:s?.toLegacyEntityType(c.entityType),entityId:c.entityId})))},[r,s]),i=p.useCallback(()=>{r&&n(void 0)},[r]);return{entities:o,openActions:a,closeActions:i}}function Gp(){const{FT:t}=de();return p.useCallback((o,n)=>{n?t.notifySuccess(o):t.notifyError(o)},[t])}function Kp({children:t}){const{entities:s,openActions:o,closeActions:n}=qp(),r=Gp(),a=p.useMemo(()=>({open({selection:i}){o(i)}}),[o]);return e.jsxs(al.Provider,{value:a,children:[t,Array.isArray(s)&&e.jsx(il,{selection:s,onClose:n,showNotification:r})]})}function Yp(){const{FT:t,isReady:s}=de(),{open:o}=ll();return p.useEffect(()=>{if(!s)return;const n=t.spark;return n.openActions=({selection:r})=>{o({selection:r.map(a=>({...a,isLegacyType:a.isLegacyType??!0}))})},()=>{n.openActions=null}},[t,s,o]),null}const Jp=Nt("scheduler-layout","pack"),Qp=({children:t,onUpdatesAvailable:s})=>{const[o,n]=p.useState(null),[r,a]=p.useState(Jp),[i,l]=p.useState({startDate:null,endDate:null}),c=p.useMemo(()=>({primaryScheduler:o,setPrimaryScheduler:n,onUpdatesAvailable:s,eventLayout:r,setEventLayout:a,visibleDateRange:i,setVisibleDateRange:l}),[r,s,o,n,a,i,l]);return e.jsx(cl.Provider,{value:c,children:t})};var Xp=function(){for(var t=0,s=0,o=arguments.length;s<o;s++)t+=arguments[s].length;for(var n=Array(t),r=0,s=0;s<o;s++)for(var a=arguments[s],i=0,l=a.length;i<l;i++,r++)n[r]=a[i];return n};function Zp(t){return JSON.stringify(t.map(function(s){return s&&typeof s=="object"?em(s):s}))}function em(t){return Object.keys(t).sort().map(function(s){var o;return o={},o[s]=t[s],o})}var fo=function(t,s){return s===void 0&&(s={}),function(){for(var o,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var a=Zp(n),i=a&&s[a];return i||(i=new((o=t).bind.apply(o,Xp([void 0],n))),a&&(s[a]=i)),i}};const tm=[Zo()],sm=fo(Intl.NumberFormat),om=fo(Intl.DateTimeFormat),nm=fo(dl),rm=fo(Intl.RelativeTimeFormat);async function am(t){return ul(t)?(await pl(Object.assign({}),`./messages/${t}.json`,3)).default:{}}const im=Object.freeze(Object.defineProperty({__proto__:null,LOCALES:tm,getDateTimeFormat:om,getMessageFormat:nm,getNumberFormat:sm,getRelativeTimeFormat:rm,loadMessages:am},Symbol.toStringTag,{value:"Module"})),Xa=p.createContext({});function lm(t){return Te("MuiAccordion",t)}const Es=Ee("MuiAccordion",["root","heading","rounded","expanded","disabled","gutters","region"]),cm=t=>{const{classes:s,square:o,expanded:n,disabled:r,disableGutters:a}=t;return Re({root:["root",!o&&"rounded",n&&"expanded",r&&"disabled",!a&&"gutters"],heading:["heading"],region:["region"]},lm,s)},dm=le(Kr,{name:"MuiAccordion",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[{[`& .${Es.region}`]:s.region},s.root,!o.square&&s.rounded,!o.disableGutters&&s.gutters]}})(ht(({theme:t})=>{const s={duration:t.transitions.duration.shortest};return{position:"relative",transition:t.transitions.create(["margin"],s),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(t.vars||t).palette.divider,transition:t.transitions.create(["opacity","background-color"],s)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${Es.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${Es.disabled}`]:{backgroundColor:(t.vars||t).palette.action.disabledBackground}}}),ht(({theme:t})=>({variants:[{props:s=>!s.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(t.vars||t).shape.borderRadius,borderBottomRightRadius:(t.vars||t).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:s=>!s.disableGutters,style:{[`&.${Es.expanded}`]:{margin:"16px 0"}}}]}))),um=le("h3",{name:"MuiAccordion",slot:"Heading"})({all:"unset"}),pm=le("div",{name:"MuiAccordion",slot:"Region"})({}),mm=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiAccordion"}),{children:r,className:a,defaultExpanded:i=!1,disabled:l=!1,disableGutters:c=!1,expanded:u,onChange:d,square:m=!1,slots:h={},slotProps:f={},TransitionComponent:b,TransitionProps:g,...y}=n,[j,w]=ml({controlled:u,default:i,name:"Accordion",state:"expanded"}),v=p.useCallback(xe=>{w(!j),d&&d(xe,!j)},[j,d,w]),[I,...E]=p.Children.toArray(r),L=p.useMemo(()=>({expanded:j,disabled:l,disableGutters:c,toggle:v}),[j,l,c,v]),_={...n,square:m,disabled:l,disableGutters:c,expanded:j},R=cm(_),k={transition:b,...h},S={transition:g,...f},A={slots:k,slotProps:S},[z,P]=Ft("root",{elementType:dm,externalForwardedProps:{...A,...y},className:ue(R.root,a),shouldForwardComponentProp:!0,ownerState:_,ref:o,additionalProps:{square:m}}),[T,N]=Ft("heading",{elementType:um,externalForwardedProps:A,className:R.heading,ownerState:_}),[Y,te]=Ft("transition",{elementType:$t,externalForwardedProps:A,ownerState:_}),[q,V]=Ft("region",{elementType:pm,externalForwardedProps:A,ownerState:_,className:R.region,additionalProps:{"aria-labelledby":I.props.id,id:I.props["aria-controls"],role:"region"}});return e.jsxs(z,{...P,children:[e.jsx(T,{...N,children:e.jsx(Xa.Provider,{value:L,children:I})}),e.jsx(Y,{in:j,timeout:"auto",...te,children:e.jsx(q,{...V,children:E})})]})});function fm(t){return Te("MuiAccordionSummary",t)}const Yt=Ee("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),hm=t=>{const{classes:s,expanded:o,disabled:n,disableGutters:r}=t;return Re({root:["root",o&&"expanded",n&&"disabled",!r&&"gutters"],focusVisible:["focusVisible"],content:["content",o&&"expanded",!r&&"contentGutters"],expandIconWrapper:["expandIconWrapper",o&&"expanded"]},fm,s)},gm=le(fl,{name:"MuiAccordionSummary",slot:"Root"})(ht(({theme:t})=>{const s={duration:t.transitions.duration.shortest};return{display:"flex",width:"100%",minHeight:48,padding:t.spacing(0,2),transition:t.transitions.create(["min-height","background-color"],s),[`&.${Yt.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${Yt.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`&:hover:not(.${Yt.disabled})`]:{cursor:"pointer"},variants:[{props:o=>!o.disableGutters,style:{[`&.${Yt.expanded}`]:{minHeight:64}}}]}})),xm=le("span",{name:"MuiAccordionSummary",slot:"Content"})(ht(({theme:t})=>({display:"flex",textAlign:"start",flexGrow:1,margin:"12px 0",variants:[{props:s=>!s.disableGutters,style:{transition:t.transitions.create(["margin"],{duration:t.transitions.duration.shortest}),[`&.${Yt.expanded}`]:{margin:"20px 0"}}}]}))),bm=le("span",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper"})(ht(({theme:t})=>({display:"flex",color:(t.vars||t).palette.action.active,transform:"rotate(0deg)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),[`&.${Yt.expanded}`]:{transform:"rotate(180deg)"}}))),ym=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiAccordionSummary"}),{children:r,className:a,expandIcon:i,focusVisibleClassName:l,onClick:c,slots:u,slotProps:d,...m}=n,{disabled:h=!1,disableGutters:f,expanded:b,toggle:g}=p.useContext(Xa),y=S=>{g&&g(S),c&&c(S)},j={...n,expanded:b,disabled:h,disableGutters:f},w=hm(j),v={slots:u,slotProps:d},[I,E]=Ft("root",{ref:o,shouldForwardComponentProp:!0,className:ue(w.root,a),elementType:gm,externalForwardedProps:{...v,...m},ownerState:j,additionalProps:{focusRipple:!1,disableRipple:!0,disabled:h,"aria-expanded":b,focusVisibleClassName:ue(w.focusVisible,l)},getSlotProps:S=>({...S,onClick:A=>{S.onClick?.(A),y(A)}})}),[L,_]=Ft("content",{className:w.content,elementType:xm,externalForwardedProps:v,ownerState:j}),[R,k]=Ft("expandIconWrapper",{className:w.expandIconWrapper,elementType:bm,externalForwardedProps:v,ownerState:j});return e.jsxs(I,{...E,children:[e.jsx(L,{..._,children:r}),i&&e.jsx(R,{...k,children:i})]})});function jm(t){return Te("MuiAccordionDetails",t)}Ee("MuiAccordionDetails",["root"]);const km=t=>{const{classes:s}=t;return Re({root:["root"]},jm,s)},wm=le("div",{name:"MuiAccordionDetails",slot:"Root"})(ht(({theme:t})=>({padding:t.spacing(1,2,2)}))),vm=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiAccordionDetails"}),{className:r,...a}=n,i=n,l=km(i);return e.jsx(wm,{className:ue(l.root,r),ref:o,ownerState:i,...a})}),ho=({title:t,expanded:s,disabled:o=!1,children:n,onChange:r,StartIcon:a,infoText:i,size:l,sx:c,...u})=>{const d={"&.MuiAccordion-root":{borderRadius:l==="small"?1:2},"&.MuiAccordion-root:before":{display:"none"},"&.Mui-disabled":{cursor:"not-allowed"},"& .MuiAccordionSummary-content":{overflow:"hidden"},"& .MuiAccordionSummary-root":{height:l==="small"?34:64,minHeight:l==="small"?20:48,fontSize:l==="small"?"fontSizeRegular":"h4.fontSize"},"& .MuiAccordionDetails-root":{pt:l==="small"?1:2,fontSize:l==="small"?"fontSizeSmall":"fontSizeRegular"},"& .MuiAccordionSummary-root.Mui-expanded":{minHeight:l==="small"?20:48},...c};return e.jsx(Z,{title:o?i:null,children:e.jsxs(mm,{onChange:r,expanded:s,disabled:o,square:!0,sx:d,...u,children:[e.jsxs(ym,{expandIcon:e.jsx(hl,{}),children:[a,t]}),e.jsx(je,{variant:"middle"}),e.jsx(vm,{children:n})]})})},Sm=t=>(t||"").trim().toLowerCase().replace(/ /g,"_").replace(/([^a-zA-Z0-9._]+)/g,""),_m=p.lazy(()=>$e(()=>Promise.resolve().then(()=>Sf),void 0,import.meta.url)),Za=t=>e.jsx(p.Suspense,{fallback:e.jsx(C,{sx:{mt:2,minHeight:36},children:e.jsx(rt,{sx:{display:"flex",m:"auto"},size:25})}),children:e.jsx(_m,{...t})}),Ie=F({"project-name-label":{id:"components.project-setup-settings.project-name-label",description:"Label for project name",defaultMessage:"Name"},"project-code-label":{id:"components.project-setup-settings.project-code-label",description:"Label for project code",defaultMessage:"Project code"},"start-date-label":{id:"components.project-setup-settings.start-date-label",description:"Label for start date",defaultMessage:"Start date"},"end-date-label":{id:"components.project-setup-settings.end-date-label",description:"Label for project code",defaultMessage:"End date"},"project-code-description":{id:"components.project-setup-settings.project-code-description",description:"Text describes project code",defaultMessage:"The unique project code {projectCode} ({change}) is used by APIs and integrations to identify the project."},change:{id:"components.project-setup-settings.change",description:"Clickable text to change project code",defaultMessage:"Change"},"whitespace-error":{id:"components.project-setup-settings.whitespace-error",description:"Info message when fields consists of only whitespaces",defaultMessage:"Cannot consist of only whitespaces"},"project-code-not-unique":{id:"components.project-setup-settings.project-code-not-unique",description:"Info message when project code is not unique",defaultMessage:"Project code must be unique"},"error-start-date":{id:"components.project-setup-settings.error-start-date",description:"Info message when start date is greater than end date",defaultMessage:"Start date must be before end date"},"error-end-date":{id:"components.project-setup-settings.error-end-date",description:"Info message when end date is greater than start date",defaultMessage:"End date must be after start date"},"project-character-limit":{id:"components.project-setup-settings.project-character-limit",description:"Info message when character limit exceeds",defaultMessage:"Entered value must be 255 characters or less"},"invalid-date-format":{id:"components.project-setup-settings.invalid-date-format",description:"Info message when date format is invalid",defaultMessage:"Invalid date format"}}),ir=t=>t?K(t).tz().format():"",Im=()=>{const{control:t,setValue:s,watch:o,trigger:n,clearErrors:r,formState:a}=me(),[i,l]=p.useState(!1),c=p.useCallback(()=>l(!0),[]);p.useEffect(()=>{a.errors.project?.name&&c()},[a.errors.project?.name,c]);const u=oe(),d=H(),m=async b=>{if((await d.query(`select id from Project where name is "${b}" limit 1`)).data.length>0)return c(),u.formatMessage(Ie["project-code-not-unique"])},h=b=>{if(!K(b).isValid())return u.formatMessage(Ie["invalid-date-format"])},f=b=>{if(!b.trim())return u.formatMessage(Ie["whitespace-error"])};return e.jsxs(e.Fragment,{children:[e.jsxs(ae,{direction:"row",spacing:2,sx:{alignItems:"flex-start",mb:1.5},children:[e.jsx(Xe,{name:"project.full_name",control:t,rules:{required:!0,maxLength:{value:255,message:u.formatMessage(Ie["project-character-limit"])},validate:f},render:({field:{onChange:b,value:g},fieldState:{error:y}})=>e.jsx(gs,{required:!0,autoFocus:!0,variant:"outlined",label:e.jsx(x,{...Ie["project-name-label"]}),value:g??"",onChange:j=>{b(j.target.value),a.touchedFields.project?.name||s("project.name",Sm(j.target.value))},onBlur:()=>{n("project.full_name"),n("project.name")},error:!!y,helperText:y?.message??""})}),e.jsx(Xe,{name:"project.color",control:t,render:({field:{onChange:b,value:g,ref:y}})=>e.jsx(Za,{border:!0,value:g,onChange:j=>{b(j),ye("project-setup-changed-project-color",{color:g})},ref:y,sx:{height:53,width:53}})})]}),e.jsxs(C,{sx:{mb:4.5},children:[e.jsx(M,{component:"span",sx:{fontSize:"fontSizeSmall",color:"text.secondary",display:i?"none":"block",overflow:"hidden",textOverflow:"ellipsis"},children:e.jsx(x,{...Ie["project-code-description"],values:{projectCode:e.jsx(M,{sx:{color:"text.primary",display:"inline",fontSize:"fontSizeSmall",fontWeight:"fontWeightMedium"},children:o("project.name")}),change:e.jsx(M,{component:"span",onClick:c,sx:{color:"primary.main",display:"inline",fontSize:"fontSizeSmall",cursor:"pointer",textTransform:"uppercase"},children:e.jsx(x,{...Ie.change})})}})}),e.jsx(Xe,{name:"project.name",control:t,rules:{required:!0,maxLength:{value:255,message:u.formatMessage(Ie["project-character-limit"])},validate:{isProjectCodeUnique:m,isWhitespaceOnly:f}},render:({field:{onChange:b,onBlur:g,value:y,ref:j},fieldState:{error:w}})=>e.jsx(gs,{required:!0,onBlur:g,ref:j,label:e.jsx(x,{...Ie["project-code-label"]}),variant:"outlined",value:y??"",onChange:b,error:!!w,helperText:w?.message??"",sx:{display:i||w?"block":"none"},slotProps:{htmlInput:{hidden:!i}}})})]}),e.jsxs(ae,{direction:"row",spacing:2,sx:{mb:4},children:[e.jsx(Xe,{name:"project.start_date",control:t,rules:{required:!0,validate:{validFormat:h,startDateBeforeEndDate:(b,g)=>{const y=g.project.end_date;if(b>y)return u.formatMessage(Ie["error-start-date"]);r("project.end_date")}}},render:({field:{onChange:b,value:g,onBlur:y},fieldState:{error:j}})=>e.jsx(Oo,{label:e.jsx(x,{...Ie["start-date-label"]}),slotProps:{textField:{variant:"outlined",required:!0,error:!!j,helperText:j?.message??"",onBlur:y}},value:g?K(g).tz():null,onChange:w=>{const v=ir(w);b(v)}})}),e.jsx(Xe,{name:"project.end_date",control:t,rules:{required:!0,validate:{validFormat:h,endDateAfterStartDate:(b,g)=>{if(g.project.start_date>b)return u.formatMessage(Ie["error-end-date"]);r("project.start_date")}}},render:({field:{onChange:b,value:g,onBlur:y},fieldState:{error:j}})=>e.jsx(Oo,{label:e.jsx(x,{...Ie["end-date-label"]}),slotProps:{textField:{variant:"outlined",required:!0,error:!!j,helperText:j?.message??"",onBlur:y}},value:g?K(g).tz():null,onChange:w=>{const v=ir(w);b(v)},minDate:K(o("project.start_date")).tz()})})]}),e.jsx(Xe,{name:"project.is_private",control:t,render:({field:{onChange:b,value:g}})=>e.jsx(Yr,{value:g,onChange:b,sx:{mb:1},product:"studio"})})]})},lr=F({"project-settings":{id:"components.project-setup-left-container.project-settings",description:"Text for project settings label",defaultMessage:"Project settings"},"private-project":{id:"components.project-setup-left-container.private-project",description:"Tooltip message when project is private",defaultMessage:"Private project"}}),Cm=({isActive:t,hasFormValidationErrors:s,onChange:o})=>{const n=oe(),r=j=>j?n.formatDate(j,{year:"numeric",month:"short",day:"numeric"}):"",a={height:20,width:20,margin:"0 2px"},i=j=>{if(j){const w=K(j).tz().format("YYYY-MM-DD");if(K(w).tz().isValid())return!0}return!1},{watch:l}=me(),c=l("project.full_name"),u=l("project.color"),d=l("project.start_date"),m=l("project.end_date"),h=l("project.is_private");let f="";i(d)&&i(m)&&(f=`- ${r(d)} - ${r(m)}`);const b=c?`${c} ${f}`:"",g=h?e.jsx(Jr,{sx:a}):e.jsx(Qr,{sx:a}),y=h?e.jsxs(e.Fragment,{children:[b," -",e.jsx(x,{...lr["private-project"]})]}):b;return e.jsx(ho,{title:c&&!t?e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:y,children:e.jsx(C,{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:b})}),"-",g]}):e.jsx(x,{...lr["project-settings"]}),StartIcon:c&&!t?e.jsx(qs,{sx:{color:u,mr:1}}):null,expanded:t||s,onChange:o,children:e.jsx(Im,{})})},nt=F({"new-workflow":{id:"components.create-workflow-card.new-workflow",description:"Label for new workflow.",defaultMessage:"New workflow"},"workflow-name":{id:"components.create-workflow-card.workflow-name",description:"Label for new workflow textbox.",defaultMessage:"Workflow name"},"clone-workflow-message":{id:"components.create-workflow-card.clone-workflow-message",description:"Description for clone workflow.",defaultMessage:"Select which workflow you want to clone."},cancel:{id:"components.create-workflow-card.cancel",description:'Text on "cancel" button',defaultMessage:"Cancel"},"create-workflow":{id:"components.create-workflow-card.create-workflow",description:'Text on "create workflow" button',defaultMessage:"Create workflow"},"save-as-new-workflow-message":{id:"components.create-workflow-card.save-as-new-workflow-message",description:"Description for save as new workflow.",defaultMessage:"Do you want to apply the changes and save it as a new workflow based on the {selectedSchemaName} workflow?"},"save-as-new-workflow":{id:"components.create-workflow-card.save-as-new-workflow",description:'Text on "Save as new" button',defaultMessage:"Save as new"},workflow:{id:"components.create-workflow-card.workflow",description:"Label for workflow dropdown",defaultMessage:"Workflow"},"workflow-name-not-unique":{id:"components.create-workflow-card.workflow-name-not-unique",description:"Error message when workflow name is not unique",defaultMessage:"Workflow name must be unique."},"workflow-name-character-limit":{id:"components.create-workflow-card.workflow-name-character-limit",description:"Error message when number of characters exceeds 32",defaultMessage:"Workflow name can only be up to 32 characters."}}),Mm=({initialValue:t,onCancel:s,onCreate:o,visibleFormType:n,onInitialStateChange:r})=>{const{getValues:a}=me(),i=Ut({mode:"onTouched",defaultValues:{workflow_name:`Copy of ${t.name}`}}),[l,c]=p.useState({id:a("project.project_schema_id"),name:a("workflow.name")}),u=i.trigger,d=i.setValue,m=p.useCallback(f=>{c({id:f.id,name:f.name}),d("workflow_name",`Copy of ${f.name}`),u("workflow_name")},[u,d]),h=async f=>{f.key==="Enter"&&(f.metaKey||f.ctrlKey)&&await u("workflow_name")?(o({id:"new-schema-id",name:i.getValues("workflow_name"),baseSchemaName:l.name,baseSchemaId:l.id}),ye("project-setup-created-new-workflow",{baseWorkflow:t.name})):f.key==="Enter"&&(f.preventDefault(),f.stopPropagation())};return e.jsxs(gl,{sx:{border:"none"},children:[e.jsx(xl,{sx:{"& .MuiTypography-root":{fontWeight:"fontWeightMedium"}},title:e.jsx(x,{...nt["new-workflow"]})}),e.jsxs("div",{children:[e.jsx(bl,{sx:{pt:0},children:n==="clone-new-workflow"?e.jsx(Em,{onWorkflowDropdownChange:m,control:i.control,onHandleKeyDown:h}):e.jsx(Tm,{selectedSchemaName:t.name,control:i.control,onHandleKeyDown:h})}),e.jsxs(yl,{sx:{p:2,justifyContent:"space-between"},children:[e.jsx(U,{type:"button",color:"neutral",variant:"outlined",onMouseDown:f=>f.preventDefault(),onClick:()=>{s()},children:e.jsx(x,{...nt.cancel})}),e.jsx(U,{variant:"outlined",onClick:()=>{o({id:"new-schema-id",name:i.getValues("workflow_name"),baseSchemaName:l.name,baseSchemaId:l.id}),r(!1),ye("project-setup-created-new-workflow",{baseWorkflow:t.name})},disabled:!i.formState.isValid,children:e.jsx(x,{...nt[n==="save-as-new-workflow"?"save-as-new-workflow":"create-workflow"]})})]})]})]})};async function ei(t,s,o){if(s===void 0)return!0;const n=await s;if(n.data.length>0&&n.data.find(r=>r.name?.trim().toLowerCase()===t.trim().toLowerCase()))return o.formatMessage(nt["workflow-name-not-unique"])}function ti(t,s){if(t.length>32)return s.formatMessage(nt["workflow-name-character-limit"])}const Tm=({selectedSchemaName:t="",control:s,onHandleKeyDown:o})=>{const n=H(),r=oe(),[a,i]=p.useState();return p.useEffect(()=>{const l=n.query("select name from ProjectSchema");i(l)},[n]),e.jsxs(e.Fragment,{children:[e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeRegular",pb:3},children:e.jsx(x,{...nt["save-as-new-workflow-message"],values:{selectedSchemaName:t}})}),e.jsx(Me,{name:"workflow_name",required:!0,control:s,variant:"outlined",validate:{maxLength:l=>ti(l,r),isUnique:l=>ei(l,a,r)},autoFocus:!0,shrink:!0,label:e.jsx(x,{...nt["workflow-name"]}),sx:{display:"block"},onKeyDown:o})]})},Em=({onWorkflowDropdownChange:t,control:s,onHandleKeyDown:o})=>{const n=H(),[r,a]=p.useState(),i=oe();p.useEffect(()=>{const c=n.query("select name from ProjectSchema");a(c)},[n]);const{getValues:l}=me();return e.jsxs(C,{sx:{pt:2},children:[e.jsx(Me,{name:"workflow_name",required:!0,control:s,variant:"outlined",validate:{maxLength:c=>ti(c,i),isUnique:c=>ei(c,r,i)},autoFocus:!0,shrink:!0,label:e.jsx(x,{...nt["workflow-name"]}),sx:{display:"block"},onKeyDown:o}),e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeRegular",pt:2,pb:3},children:e.jsx(x,{...nt["clone-workflow-message"]})}),e.jsx(It,{entityType:"ProjectSchema",label:e.jsx(x,{...nt.workflow}),variant:"outlined",isRequired:!0,onChange:t,initialValue:l("project.project_schema_id")})]})},Rm=F({"default-label":{id:"components.project-setup.add-menu-dropdown.default-label",defaultMessage:"Add {type}"}});function si({menuItems:t,onClick:s,type:o,icon:n="lens"}){return e.jsx(en,{dense:!0,disabled:!t.length,button:e.jsx(U,{endIcon:e.jsx(Or,{}),variant:"outlined",sx:{borderRadius:"16px"},disabled:!t.length,children:e.jsx(x,{...Rm["default-label"],values:{type:o}})}),children:t.map(r=>e.jsxs(tt,{onClick:()=>s(r),children:[(r?.icon||n)&&e.jsx(Le,{sx:{color:r?.color??"text.primary"},children:e.jsx(_t,{icon:r?.icon||n})}),e.jsx(we,{children:r.name})]},r.id))})}const Uo=[cs.id,ds.id];function Pm({selectedObjectTypes:t,onRemoveObjectType:s,onObjectTypeClick:o,onAddObjectType:n,availableObjectTypes:r,isLoading:a,error:i,scrollRef:l,mandatoryObjectMessage:c,isAuthorized:u,selectedObjectId:d}){return u?e.jsxs(e.Fragment,{children:[e.jsxs(C,{component:"ul",sx:{px:0,"& .MuiButton-root":{height:"3.2rem"}},children:[t?.map(m=>e.jsx(De,{label:m.name,onDelete:()=>s(m),icon:e.jsx(_t,{icon:m.icon}),size:"large",onClick:()=>o(m),sx:{"& .MuiChip-deleteIcon":{color:"text.primary",fontSize:"fontSizeRegular"},bgcolor:d===m.id?"divider":"transparent"}},m.name)),e.jsx(si,{menuItems:r.filter(m=>!t?.find(h=>h.id===m.id)&&!Uo.includes(m.id)),onClick:n,type:"object"})]}),a&&e.jsx(C,{sx:{display:"flex",justifyContent:"center",alignItems:"center",my:1},children:e.jsx(xt,{size:30})}),i&&!a?e.jsx(M,{component:"span",sx:{color:"error.main",width:"100%"},children:i?.message}):null,e.jsx(je,{sx:{my:2,width:"100%"}}),e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeRegular",pb:2},children:c}),e.jsx(C,{component:"ul",sx:{px:0},children:e.jsx(cr,{selectedObjectId:d,onObjectTypeClick:o})}),e.jsx(C,{id:"scroll-ref",sx:{height:"1px"},ref:l})]}):e.jsxs(C,{component:"ul",sx:{px:0,"& .MuiButton-root":{height:"3.2rem"}},children:[t?.map(m=>{const h=m.name;return e.jsx(De,{label:h,icon:e.jsx(_t,{icon:m.icon}),size:"large",onClick:()=>{o(m)},sx:{"& .MuiChip-deleteIcon":{color:"text.primary",fontSize:"fontSizeRegular"},bgcolor:d===m.id?"divider":"transparent"}},h)}),e.jsx(cr,{selectedObjectId:d,onObjectTypeClick:o})]})}const cr=({selectedObjectId:t,onObjectTypeClick:s})=>e.jsxs(e.Fragment,{children:[e.jsx(De,{label:cs.name,size:"large",icon:e.jsx(_t,{icon:cs.icon}),sx:{bgcolor:t===cs.id?"divider":"transparent"},onClick:()=>s(cs)}),e.jsx(De,{label:ds.name,size:"large",icon:e.jsx(_t,{icon:ds.icon}),onClick:()=>s(ds),sx:{bgcolor:t===ds.id?"divider":"transparent"}}),e.jsx(De,{label:us.name,size:"large",icon:e.jsx(_t,{icon:us.icon}),onClick:()=>s(us),sx:{bgcolor:t===us.id?"divider":"transparent"}})]}),Cs=({label:t,href:s="#"})=>e.jsx(es,{sx:{color:"blue.main",textDecoration:"none",fontWeight:"fontWeightMedium",fontSize:"fontSizeRegular"},rel:"noopener noreferrer",target:"_blank",href:s,onClick:()=>ye("project-setup-clicked-link",{link_to:t}),children:t}),Am=F({workflow:{id:"components.workflow-dropdown.workflow",description:"Label of workflow dropdown",defaultMessage:"Workflow"}}),Lm=({initialValue:t,onChange:s,schema:o,additionalOptions:n})=>{const{control:r}=me();return t?e.jsx(Xe,{defaultValue:t,name:"project.project_schema_id",control:r,rules:{required:!0},render:function({field:{value:i,onChange:l}}){const c=p.useCallback(u=>{s&&s(u),l(u.id)},[l]);return e.jsx(It,{entityType:"ProjectSchema",label:e.jsx(x,{...Am.workflow}),variant:"outlined",isRequired:!0,onChange:c,initialValue:i,value:o,additionalOptions:n})}}):null};function Dm(t){const s=t.object_types?.sort((m,h)=>(m.sort??0)-(h.sort??0))?.map(m=>m.id).filter(be)??[],n=t?.task_workflow_schema?.statuses?.map(m=>m.id).filter(be)??[],a=t?.task_type_schema?.types?.map(m=>m.id).filter(be)??[],l=t?.asset_version_workflow_schema?.statuses?.map(m=>m.id).filter(be)??[],c=t?.task_templates?.map(m=>{const h=m.items?.map(f=>f.task_type_id).filter(be)??[];return{name:m.name,type_ids:h??[]}})??[],u=t?.object_type_schemas?.map(m=>{if(!m.object_type_id)return null;const h=m.statuses?.map(b=>b.status_id).filter(be)??[],f=m.types?.map(b=>b.type_id).filter(be)??[];return{object_type_id:m.object_type_id,status_ids:h,type_ids:f}}).filter(be)??[],d=t?.task_workflow_schema_overrides?.map(m=>m.type_id?{status_ids:m.workflow_schema?.statuses?.map(f=>f.id).filter(be)??[]??[],type_id:m.type_id}:null).filter(be)??[];return{name:t.name??"",object_type_ids:s,task_status_ids:n,task_type_ids:a,asset_version_status_ids:l,task_templates:c,object_type_schemas:u,overrides:d}}const Om=()=>{const t=Math.floor(Math.random()*bs.length);return bs[t]},Ho=async t=>{const s=Qt();let o=t;o||(o=(await s.query("select value from Setting where group is 'DEFAULT' and name is 'workflowid'")).data?.[0]?.value,o||(o=(await s.query("select id from ProjectSchema limit 1")).data?.[0]?.id));const n=[];n.push(X.query(`select name, object_types.id, object_types.sort from ProjectSchema where id is ${o}`)),n.push(X.query(`select task_workflow_schema.statuses, task_type_schema.types from ProjectSchema where id is "${o}"`)),n.push(X.query(`select asset_version_workflow_schema.statuses,
      task_templates.items.task_type_id,
      task_templates.name from ProjectSchema where id is "${o}"`)),n.push(X.query(`select object_type_schemas.object_type_id,
      object_type_schemas.statuses.status_id,
      object_type_schemas.types.type_id from ProjectSchema where id is "${o}"`)),n.push(X.query(`select task_workflow_schema_overrides.type_id,
      task_workflow_schema_overrides.workflow_schema.statuses from ProjectSchema where id is "${o}"`));const r=await s.call(n),a=Dm(r.reduce((i,l)=>({...i,...l.data[0]}),{}));return{project:{full_name:"",name:"",color:Om(),start_date:K().tz().format(),end_date:K().tz().add(1,"month").format(),is_private:!1,project_schema_id:o},workflow:a}},ut=F({"workflow-accordion-title":{id:"components.project-setup-left-container.workflow-accordion-title",description:"Title of project workflow accordion panel.",defaultMessage:"Project structure - Choose workflow"},description:{id:"components.project-setup-left-container.description",description:"Description of project workflow accordion panel.",defaultMessage:"Choose a workflow to get started with your new project."},"description-clone-mode":{id:"components.project-setup-left-container.description-clone-mode",description:"Description of project workflow accordion panel.",defaultMessage:"Create a new workflow based on an existing one. The new workflow name has to be unique."},"edit-objects":{id:"components.project-setup-left-container.edit-objects",description:"Edit object for project schema description.",defaultMessage:"Press the objects below to view and edit their properties. To create new objects, go to {systemSettingsLink}."},"read-objects":{id:"components.project-setup-left-container.read-objects",description:"Edit object for project schema description.",defaultMessage:"Press the objects below to view their properties."},"mandatory-objects":{id:"components.project-setup-left-container.mandatory-objects",description:"Mandatory object for project schema description.",defaultMessage:"The objects below are mandatory in a project in ftrack Studio. Press any object to view and edit their properties."},"system-settings":{id:"components.project-setup-left-container.system-settings",description:"Label for link to system settings.",defaultMessage:"System settings"},"new-workflow":{id:"components.project-setup-left-container.new-workflow",description:"Label for new workflow.",defaultMessage:"New workflow"},"disabled-message":{id:"components.project-setup-left-container.disabled-message",description:"Tooltip message when workflow accordion is disabled",defaultMessage:"You have to add the project settings before you can continue on to setting a workflow"}}),zm=({isActive:t,hasFormValidationErrors:s,onChange:o,onObjectTypeSelect:n,isAuthorized:r,visibleFormType:a,onFormTypeChange:i,activeObjectType:l,onInitialStateChange:c})=>{const{getValues:u,formState:d}=me(),m=!u("project.full_name")||s;return e.jsx(ho,{title:e.jsx(x,{...ut["workflow-accordion-title"]}),expanded:t&&!s,onChange:o,infoText:e.jsx(x,{...ut["disabled-message"]}),disabled:m,children:d.isLoading?e.jsx(rt,{sx:{display:"flex",margin:"auto"}}):e.jsx(Fm,{onObjectTypeSelect:n,isAuthorized:r,visibleFormType:a,onFormTypeChange:i,activeObjectType:l,onInitialStateChange:c})})},Fm=({onObjectTypeSelect:t,isAuthorized:s,visibleFormType:o,onFormTypeChange:n,activeObjectType:r,onInitialStateChange:a})=>{const{watch:i,setValue:l,getValues:c}=me(),u=p.useRef(null),d=H(),[m,h]=p.useState(),f=i("project.project_schema_id"),b=i("workflow.name"),g=i("workflow.object_type_ids"),{isLoading:y,data:j,error:w,isFetchingNextPage:v,fetchNextPage:I,hasNextPage:E,isFetching:L}=ve({entityType:"ObjectType",name:"project-setup-object-type",projection:["id","name","icon","project_schemas.id","project_schemas.name","is_prioritizable","is_statusable","is_typeable","sort"],filter:"",limit:1e3,orderBy:"sort asc",enabled:!!f}),_=j,R=p.useMemo(()=>g?.filter(q=>!Uo.includes(q)).map(q=>_?.find(V=>V.id===q)).filter(be),[g,_]),k=p.useMemo(()=>R?.some(q=>q.id===r?.id)||Uo.includes(r?.id??"")||us.id===r?.id,[r,R]),S=p.useMemo(()=>_?.filter(q=>!R?.some(V=>q.id===V.id))??[],[_,R]),A=p.useCallback(q=>{if(c("project.project_schema_id")==="new-schema-id"){if(q.id){const V=so([...c("workflow.object_type_ids")??[],q.id]),at=_?.filter(qe=>V.includes(qe.id))?.map(qe=>qe.id);at&&l("workflow.object_type_ids",at),h(void 0)}}else h({action:"add",value:q}),n("save-as-new-workflow");ye("project-setup-user-made-edits",{changes:"Added new object type",objectType:q})},[_,c,n,l]),z=p.useCallback(q=>{c("project.project_schema_id")==="new-schema-id"?(l("workflow.object_type_ids",c("workflow.object_type_ids")?.filter(V=>V!==q.id)??[]),r?.id===q.id&&t(void 0),h(void 0)):(h({action:"remove",value:q}),n("save-as-new-workflow")),ye("project-setup-user-made-edits",{changes:"Removed object types",objectType:q})},[c,n,l,r,t]),P=p.useCallback(()=>{m&&(m.action==="add"?A(m.value):m.action==="remove"&&z(m.value))},[m,A,z]),T=p.useRef(void 0),N=p.useCallback(async q=>{if(!q.id||!q.name)return;let V=T.current;c("project.project_schema_id")==="new-schema-id"&&q.id!=="new-schema-id"&&(T.current=V),q.baseSchemaId?V=(await Ho(q.baseSchemaId)).workflow:q.id!=="new-schema-id"&&(V=(await Ho(q.id)).workflow),l("workflow",V),l("project.project_schema_id",q.id),q.id==="new-schema-id"&&V&&(l("workflow.name",q.name),P(),T.current=c("workflow")),n("workflow-settings"),ye("project-setup-changed-selected-workflow")},[l,P,n,c]);k||t(void 0),Xr(u,I,!E||L);const Y=T.current?.name,te=p.useMemo(()=>Y?[{id:"new-schema-id",name:Y}]:void 0,[Y]);return e.jsxs(C,{sx:{"& ul.MuiBox-root":{display:"flex",flexWrap:"wrap",gap:1},"& section.MuiBox-root":{display:"flex",justifyContent:"space-between","& .MuiAutocomplete-root":{flexGrow:2}}},children:[e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeRegular",pb:2},children:o==="clone-new-workflow"?e.jsx(x,{...ut["description-clone-mode"]}):e.jsx(x,{...ut.description})}),o==="workflow-settings"&&e.jsxs(ae,{children:[e.jsxs(C,{component:"section",children:[e.jsx(Lm,{onChange:N,initialValue:f,schema:{id:f,name:b},additionalOptions:te}),s&&e.jsx(U,{startIcon:e.jsx(tn,{}),variant:"outlined",sx:{ml:1},onClick:()=>{n("clone-new-workflow"),ye("project-setup-clicked-new-workflow-button")},disabled:i("project.project_schema_id")==="new-schema-id",children:e.jsx(x,{...ut["new-workflow"]})})]}),e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeRegular",py:2},children:s?e.jsx(x,{...ut["edit-objects"],values:{systemSettingsLink:e.jsx(Cs,{label:e.jsx(x,{...ut["system-settings"]}),href:`${d.serverUrl}/#view=object_type&itemId=newconfigure&objectType=`})}}):e.jsx(x,{...ut["read-objects"]})}),e.jsx(Pm,{selectedObjectId:r?.id,mandatoryObjectMessage:e.jsx(x,{...ut["mandatory-objects"]}),selectedObjectTypes:R,onRemoveObjectType:z,onObjectTypeClick:t,onAddObjectType:A,availableObjectTypes:S,isLoading:v||y,error:w,scrollRef:u,isAuthorized:s})]}),(o==="clone-new-workflow"||o==="save-as-new-workflow")&&e.jsx(Mm,{initialValue:{id:f,name:b??""},onCancel:()=>n("workflow-settings"),onCreate:N,visibleFormType:o,onInitialStateChange:a})]})},$m=t=>!!(t.project?.full_name||t.project?.name||t.project?.start_date||t.project?.end_date),Nm=t=>{const{getValues:s,formState:{errors:o}}=me(),n=$m(o),r=p.useCallback(()=>{s("project.full_name")?.length>0&&!n&&(t.visibleFormType==="project-settings"?t.onFormTypeChange("workflow-settings"):t.onFormTypeChange("project-settings"))},[s,n,t]);return e.jsxs(e.Fragment,{children:[e.jsx(Cm,{isActive:t.visibleFormType==="project-settings",onChange:r,hasFormValidationErrors:n}),e.jsx(zm,{isActive:t.visibleFormType!=="project-settings",hasFormValidationErrors:n,onChange:r,...t})]})},ps=F({"edit-link":{id:"components.section.edit-link",description:"Label for edit link",defaultMessage:"Edit {title} for workflow"},"edit-workspace-link":{id:"components.section.edit-link",description:"Label for edit link",defaultMessage:"Edit {title} for workspace"},"settings-not-applied":{id:"components.section.settings-not-applied",description:"Description for unapplied settings",defaultMessage:"{capitalizedTitle} are not applied on {name}. Enable {title} for {name} in {systemSettingsLink}."},"settings-not-applied-custom-attributes":{id:"components.section.settings-not-applied-custom-attributes",description:"Description for unapplied settings for custom attributes",defaultMessage:"{capitalizedTitle} are not applied on {name}. Add new {title} for {name} in {systemSettingsLink}."},"settings-not-applied-read-only":{id:"components.section.settings-not-applied-read-only",description:"Description for unapplied settings",defaultMessage:"{capitalizedTitle} are not applied on {name}."},"system-settings":{id:"components.section.system-settings",description:"Label for link to system settings.",defaultMessage:"System settings"}});function Wm({isAuthorized:t,name:s,title:o,session:n,path:r}){const a=e.jsx(Cs,{label:e.jsx(x,{...ps["system-settings"]}),href:`${n.serverUrl}/#view=object_type&itemId=newconfigure&objectType=}`}),i=e.jsx("strong",{style:{textTransform:"capitalize"},children:o});let l=r==="custom_attributes"?e.jsx(x,{...ps["settings-not-applied-custom-attributes"],values:{name:s,title:o,capitalizedTitle:i,systemSettingsLink:a}}):e.jsx(x,{...ps["settings-not-applied"],values:{name:s,title:o,capitalizedTitle:i,systemSettingsLink:a}});return t||(l=e.jsx(x,{...ps["settings-not-applied-read-only"],values:{name:s,title:o,capitalizedTitle:i}})),l}function To({title:t,description:s,content:o=null,isSettingsApplied:n,name:r="",isAuthorized:a,path:i}){const l=H();return e.jsxs("div",{children:[e.jsxs(C,{sx:{height:30,display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:[e.jsx(M,{id:"section-title",sx:{fontWeight:"medium",color:"text.primary",textTransform:"capitalize"},children:t}),a&&e.jsx(Cs,{label:e.jsx(x,{...ps[i==="priority_type"?"edit-workspace-link":"edit-link"],values:{title:t}}),href:`${l.serverUrl}/#view=${i}&itemId=newconfigure&objectType=}`})]}),e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeRegular",pb:2},children:n?s:Wm({isAuthorized:a,name:r,title:t,session:l,path:i})}),n&&o]})}const Eo=({chips:t,icon:s,isLoading:o,type:n,filterIdArray:r,isAuthorized:a,sx:i,onFormTypeChange:l=()=>null,objectTypeId:c,name:u})=>{const d=p.useRef({action:"",value:{},type:n}),{watch:m,getValues:h,setValue:f}=me(),b=m("project.project_schema_id"),g=p.useMemo(()=>s==="priority-high"?t:[],[t,s]),y=p.useMemo(()=>r?t?.filter(k=>r?.includes(k.id)):g,[t,g,r]),j=t?.filter(k=>!y?.find(S=>k.id===S.id))??[],w=p.useCallback((k,S)=>{d.current={action:k,value:S,type:n},l("save-as-new-workflow")},[l,n]),v=p.useCallback(()=>u==="Task"&&n==="status"?"task_status_ids":u==="Task"&&n==="type"?"task_type_ids":u==="Asset version"?"asset_version_status_ids":"object_type_schemas",[u,n]),I=p.useCallback((k,S)=>{const A=h(`workflow.${k}`);if(k==="object_type_schemas"){let z=!0;const P=n==="status"?"status_ids":"type_ids";let T=A?.map(N=>(N.object_type_id===c&&(z=!1,N[`${P}`]?.push(S)),N));return z&&(T=[...T,{object_type_id:c??void 0,status_ids:n==="status"?[S]:[],type_ids:n==="type"?[S]:[]}]),T}else return Array.isArray(A)?A.concat([S]):[S]},[h,c,n]),E=p.useCallback(k=>{const S=k.id;if(b==="new-schema-id"&&S){const A=v(),z=I(A,S);f(`workflow.${A}`,z)}else w("add",k);ye("project-setup-user-made-edits",{changes:`Added ${n} to object`,value:k})},[b,n,v,I,f,w]),L=p.useCallback((k,S)=>{const A=h(`workflow.${k}`);if(k==="object_type_schemas"){const z=n==="status"?"status_ids":"type_ids";return A?.map(T=>T?.object_type_id===c?{...T,[z]:T[`${z}`]?.filter(N=>N!==S)}:T)}else return A.filter(z=>z!==S)},[h,c,n]),_=p.useCallback(k=>{if(b==="new-schema-id"&&k){const S=v(),A=L(S,k?.id);f(`workflow.${S}`,A)}else w("remove",k);ye("project-setup-user-made-edits",{changes:`Removed ${n} from object`,value:k})},[b,n,v,L,f,w]),R=p.useCallback(()=>{d.current.action==="add"?E(d.current.value):d.current.action==="remove"&&_(d.current.value)},[E,_]);return p.useEffect(()=>{b==="new-schema-id"&&d.current.action&&(R(),d.current={action:"",value:"",type:n})},[y,R,b,n]),e.jsx(C,{component:"ul",sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:1,rowGap:2,minHeight:24,px:0,"& .MuiCircularProgress-root":{display:"block",m:"3.2rem auto"},"& .MuiChip-root .MuiChip-deleteIcon":{color:"text.primary",fontSize:"fontSizeRegular"},"& .MuiButton-root":{height:"3.2rem"},...i},children:o?e.jsx(xt,{size:24}):e.jsxs(e.Fragment,{children:[y?.map(k=>e.jsx(De,{label:k.name,iconColor:k.color,onDelete:a?()=>_(k):void 0,icon:s?e.jsx(_t,{icon:s}):void 0,size:"large"},k.name)),n&&a&&e.jsx(si,{menuItems:j??[],onClick:E,type:n,icon:s})]})})};function Bm({objectTypeId:t,name:s}){const{watch:o}=me(),n=o("workflow.task_status_ids"),r=o("workflow.asset_version_status_ids"),a=o("workflow.task_type_ids");if(s==="Task")return{statusIds:n,typeIds:a};if(s==="Asset version")return{statusIds:r,typeIds:[]};{const l=o("workflow.object_type_schemas")?.filter(c=>c.object_type_id===t)?.[0];return{statusIds:l?.status_ids,typeIds:l?.type_ids}}}const qt=F({"info-title":{id:"components.project-setup-info-panel.info-title",description:"Title of info panel.",defaultMessage:"{projectState} your project"},"get-started":{id:"components.project-setup-info-panel.get-started",description:"Title suffix when it is initial state.",defaultMessage:"Get started with"},"continue-editing":{id:"components.project-setup-info-panel.continue-editing",description:"Title suffix when some edits have been made.",defaultMessage:"Continue editing"},"info-panel-description":{id:"components.project-setup-info-panel.info-panel-description",description:"Summary of what can be done in project setup dialog",defaultMessage:"Start by giving your project a name and set some details. Continue by selecting a workflow that matches how you work or modify it to suit your needs."},"info-panel-workflow-details":{id:"components.project-setup-info-panel.info-panel-workflow-details",description:"Description of info panel workflow details.",defaultMessage:"Learn more about projects and workflows {documentationLink}"},"documentation-link":{id:"components.project-setup-info-panel.documentation-link",description:"Link for document description.",defaultMessage:"in the documentation."}}),Vm=({isInitialState:t})=>e.jsxs(C,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",height:"100%"},children:[e.jsx(M,{variant:"h4",sx:{color:"text.secondary",fontWeight:"medium",mb:2},children:e.jsx(x,{...qt["info-title"],values:{projectState:t?e.jsx(x,{...qt["get-started"]}):e.jsx(x,{...qt["continue-editing"]})}})}),e.jsx(M,{sx:{mb:4,color:"text.secondary",fontSize:"fontSizeRegular"},children:e.jsx(x,{...qt["info-panel-description"]})}),e.jsx(M,{sx:{color:"text.secondary"},children:e.jsx(x,{...qt["info-panel-workflow-details"],values:{documentationLink:e.jsx(Cs,{label:e.jsx(x,{...qt["documentation-link"]}),href:"https://www.ftrack.com/help-studio-create-project"})}})})]}),Se=F({description:{id:"components.project-setup-right-container.description",description:"Title of object configuration panel.",defaultMessage:"{name} is an object created on a workspace level and could be included in other projects and workflows. {isAuthorized, plural, =1 {To change the properties that are not specific for this workflow, go to {systemSettingsLink}.} other {}}"},"mandatory-object-description":{id:"components.project-setup-right-container.mandatory-object-description",description:"Title of object configuration panel for mandatory objects.",defaultMessage:"{name} is an object created on a workspace level and is always included in projects and workflows."},"system-settings-link":{id:"components.project-setup-right-container.system-settings-link",description:"Link to system settings",defaultMessage:"System Settings"},priorities:{id:"components.project-setup-right-container.priorities",description:"Label for priorities",defaultMessage:"priorities"},statuses:{id:"components.project-setup-right-container.statuses",description:"Label for statuses",defaultMessage:"statuses"},types:{id:"components.project-setup-right-container.types",description:"Label for types",defaultMessage:"types"},"priorities-description":{id:"components.project-setup-right-container.priorities-description",description:"Description for priorities",defaultMessage:"For your workspace, priorities for {name}s are set up in the following order."},"sub-section-description":{id:"components.project-setup-right-container.sub-section-description",description:"Description for statuses and types",defaultMessage:"For this workflow, {name} has the following {sectionType} (order implied)."},"empty-status-description":{id:"components.section.empty-description",description:"Description for unapplied settings",defaultMessage:"You have to add at least 1 status to include {name} object in your workflow."},"empty-type-description":{id:"components.section.empty-description",description:"Description for unapplied settings",defaultMessage:"You have to add at least 1 type to include {name} object in your workflow."}}),Um=({objectType:t,isAuthorized:s,onFormTypeChange:o,isInitialState:n})=>{const r=!t,a=H(),{formState:{errors:i}}=me(),l=Object.keys(i).length>0,{name:c,icon:u,is_prioritizable:d,is_statusable:m,is_typeable:h,id:f}=t??{},b=["Task","Milestone","Asset version"].includes(c??""),{data:g,isLoading:y}=ve({entityType:"Priority",name:"project-setup-priority",projection:["id","name","color","sort"],filter:"",limit:100,orderBy:"sort desc",enabled:!!d&&!r}),{statusIds:j,typeIds:w}=Bm({objectTypeId:f,name:c}),{data:v=[],isLoading:I}=Jo({enabled:!!m&&!r}),{data:E=[],isLoading:L}=jl({enabled:!!h&&!r});return r?e.jsx(Vm,{isInitialState:n}):c&&!l?e.jsxs(e.Fragment,{children:[e.jsxs(C,{sx:{display:"flex",height:64,alignItems:"center"},children:[e.jsx(kl,{color:"primary",sx:{mr:1.2},children:e.jsx(_t,{icon:u})}),e.jsx(M,{variant:"h4",sx:{fontWeight:"medium",color:"text.primary"},children:c})]}),e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeRegular"},children:e.jsx(x,{...Se[b?"mandatory-object-description":"description"],values:{name:c,isAuthorized:Number(s),systemSettingsLink:e.jsx(Cs,{label:e.jsx(x,{...Se["system-settings-link"]}),href:`${a.serverUrl}/#view=workflow_schemas&itemId=newconfigure&objectType=`})}})}),e.jsxs(C,{sx:{display:"flex",flexDirection:"column",rowGap:4,pt:4},children:[c!=="Asset version"&&e.jsx(To,{title:e.jsx(x,{...Se.priorities}),name:c,description:e.jsx(x,{...Se["priorities-description"],values:{name:c}}),path:"priority_type",isSettingsApplied:d,isAuthorized:s,content:e.jsx(Eo,{isLoading:y,chips:g,isAuthorized:s,icon:"priority-high",sx:{"& .MuiChip-deleteIcon":{display:"none"}}})}),e.jsx(To,{title:e.jsx(x,{...Se.statuses}),name:c,path:"task_status",description:j?.length?e.jsx(x,{...Se["sub-section-description"],values:{name:c,sectionType:e.jsx(x,{...Se.statuses})}}):e.jsx(x,{...Se["empty-status-description"],values:{name:c,title:e.jsx(x,{...Se.statuses})}}),isSettingsApplied:m&&!!v,isAuthorized:s,content:e.jsx(Eo,{chips:v,isAuthorized:s,icon:"lens",type:"status",filterIdArray:j,isLoading:I,onFormTypeChange:o,objectTypeId:f,name:c})}),c!=="Asset version"&&e.jsx(To,{title:e.jsx(x,{...Se.types}),name:c,description:w?.length?e.jsx(x,{...Se["sub-section-description"],values:{name:c,sectionType:e.jsx(x,{...Se.types})}}):e.jsx(x,{...Se["empty-type-description"],values:{name:c,title:e.jsx(x,{...Se.types})}}),path:"task_types",isSettingsApplied:h&&!!E,isAuthorized:s,content:e.jsx(Eo,{chips:E,isAuthorized:s,icon:"lens",type:"type",filterIdArray:w,isLoading:L,onFormTypeChange:o,objectTypeId:f,name:c})})]})]}):null},Hm=F({"choose-workflow-message":{id:"components.project-setup-dialog.choose-workflow-message",description:"Message warning to choose a schema name.",defaultMessage:"Please enter a name for your workflow before proceeding with edits."}}),qm=({error:t,visibleFormType:s})=>{let o="";return s==="save-as-new-workflow"&&!t?o=e.jsx(x,{...Hm["choose-workflow-message"]}):t&&(o=t),e.jsx(Z,{title:o,children:e.jsx(M,{sx:{maxWidth:"500px",color:t?"error.main":"warning.dark",fontSize:"fontSizeSmall",mr:4,overflow:"hidden",textOverflow:"ellipsis",display:"flex",alignItems:"center","& .MuiSvgIcon-root":{mr:1}},children:o&&e.jsxs(e.Fragment,{children:[e.jsx(sn,{}),o]})})})},Gm=t=>{const s=[],o=Qe();t?.object_type_ids.forEach(i=>{s.push(X.create("ProjectSchemaObjectType",{project_schema_id:o,object_type_id:i}))});const n=Qe();s.push(X.create("WorkflowSchema",{id:n})),t?.task_status_ids.forEach(i=>{s.push(X.create("WorkflowSchemaStatus",{workflow_schema_id:n,status_id:i}))});const r=Qe();s.push(X.create("TaskTypeSchema",{id:r})),t?.task_type_ids.forEach(i=>{s.push(X.create("TaskTypeSchemaType",{task_type_schema_id:r,type_id:i}))});const a=Qe();return s.push(X.create("WorkflowSchema",{id:a})),t?.asset_version_status_ids.forEach(i=>{s.push(X.create("WorkflowSchemaStatus",{workflow_schema_id:a,status_id:i}))}),t?.object_type_schemas.forEach(i=>{const l=Qe();s.push(X.create("Schema",{id:l,project_schema_id:o,object_type_id:i.object_type_id})),i.type_ids?.forEach(c=>{s.push(X.create("SchemaType",{schema_id:l,type_id:c}))}),i.status_ids?.forEach(c=>{s.push(X.create("SchemaStatus",{schema_id:l,status_id:c}))})}),t?.task_templates.forEach(i=>{const l=Qe();s.push(X.create("TaskTemplate",{id:l,name:i.name,project_schema_id:o})),i.type_ids.filter(c=>t.task_type_ids.includes(c)).forEach(c=>{s.push(X.create("TaskTemplateItem",{template_id:l,task_type_id:c}))})}),t?.overrides.forEach(i=>{const l=Qe(),c=Qe();s.push(X.create("WorkflowSchema",{id:c})),s.push(X.create("ProjectSchemaOverride",{id:l,workflow_schema_id:c,type_id:i.type_id,project_schema_id:o})),i.status_ids.forEach(u=>{s.push(X.create("WorkflowSchemaStatus",{workflow_schema_id:c,status_id:u}))})}),s.push(X.create("ProjectSchema",{id:o,name:t?.name,task_workflow_schema_id:n,task_type_schema_id:r,asset_version_workflow_schema_id:a})),s},Km=async(t,s)=>{const o=s.object_type_ids,n=s.object_type_schemas,r=s.task_status_ids,a=s.task_type_ids;if(s.asset_version_status_ids.length===0)return{errorType:"status",name:"Asset version"};for(const l of o){const c=await t.query(`select is_statusable, is_typeable, name from ObjectType where id is ${l}`),{is_statusable:u,is_typeable:d,name:m}=c.data[0];if(m==="Task"){const h=Ym(r,a);if(h==="bothInvalid")return{errorType:"bothInvalid",name:m};if(h==="status")return{errorType:"status",name:m};if(h==="type")return{errorType:"type",name:m}}else{const h=n?.find(f=>f.object_type_id===l);if(u&&d&&(!h||h.status_ids?.length===0&&h.type_ids?.length===0))return{errorType:"bothInvalid",name:m};if(u&&(!h||h?.status_ids?.length===0))return{errorType:"status",name:m};if(d&&(!h||h?.type_ids?.length===0))return{errorType:"type",name:m}}}return{errorType:"",name:""}},Ym=(t,s)=>{const o=t.length===0,n=s.length===0;return o&&n?"bothInvalid":o?"status":n?"type":""},Ot=F({cancel:{id:"components.project-setup-dialog.save",description:'Text on "cancel" button',defaultMessage:"Cancel"},"create-project":{id:"components.project-setup-dialog.create-project",description:'Text on "create project" button',defaultMessage:"Create Project"},"create-new-project":{id:"components.project-setup-dialog.create-new-project",description:"Dialog title",defaultMessage:"Create new project"},"create-project-success":{id:"components.project-setup-dialog.create-project-success",description:"Message on when project successfully created",defaultMessage:"New project created successfully!"},"object-status-error":{id:"components.project-setup-dialog.object-status-error",description:"Message on when object does not have at least one status",defaultMessage:'"{objectType}" has to have at least one status set.'},"object-type-error":{id:"components.project-setup-dialog.object-type-error",description:"Message on when object does not have at least one type",defaultMessage:'"{objectType}" has to have at least one type set.'},"object-both-invalid-error":{id:"components.project-setup-dialog.object-both-invalid-error",description:"Message on when object does not have at least both one status and one type",defaultMessage:'"{objectType}" has to have at least one status and one type set.'}}),Jm=t=>{const s=t.getValues("project.project_schema_id")==="new-schema-id",o=Object.keys(t.formState.dirtyFields).length>0;return s||o},Qm=({onProjectCreatedGoto:t})=>{const[s,o]=p.useState(),[n,r]=p.useState("project-settings"),[a,i]=p.useState(),[l,c]=p.useState(!0),u=p.useCallback(S=>{o(S)},[]),d=S=>{r(S)},m=da({entityType:"ProjectSchema"}),h=H(),{FT:f}=de(),b=oe(),g=Ue(),y=xs(g.breakpoints.down("md")),j=Ut({mode:"onTouched",defaultValues:p.useCallback(()=>Ho(),[])}),{setConfirmClose:w,handleCancel:v}=ao(),I=Jm(j);w(I);const E=j.formState.isSubmitting,L=p.useCallback(async(S,A)=>{const z=await h.create("Project",{status:"active",full_name:S.project.full_name,name:S.project.name,color:S.project.color,start_date:S.project.start_date,end_date:S.project.end_date,is_private:S.project.is_private,project_schema_id:A});try{const P=z.data?.id;if(!P)throw new Error("Project id not found. Did you try to create a private project as the acted user?");v(),t(P,"tasks"),f.notifySuccess(b.formatMessage(Ot["create-project-success"])),ye("project-setup-created-new-project",{workflow:A,color:S.project.color,start_date:S.project.start_date,end_date:S.project.end_date,is_private:S.project.is_private})}catch(P){i(`Something went wrong when creating the project: ${P.message}`)}},[f,b,v,t,h]),_=p.useCallback(async S=>{const A=Gm(S.workflow),z=await h.call(A);return z[z.length-1]?.data?.id},[h]),R=p.useCallback(async S=>{try{let A=S.project.project_schema_id;if(S.workflow){const{errorType:z,name:P}=await Km(h,S.workflow);if(z==="bothInvalid")throw new Error(b.formatMessage(Ot["object-both-invalid-error"],{objectType:P}));if(z==="status")throw new Error(b.formatMessage(Ot["object-status-error"],{objectType:P}));if(z==="type")throw new Error(b.formatMessage(Ot["object-type-error"],{objectType:P}));A==="new-schema-id"&&(A=await _(S))}await L(S,A)}catch(A){i(A.message)}},[L,_,b,h]),k=S=>{if(S.key==="Enter"){if(!(S.metaKey||S.ctrlKey)){S.preventDefault();return}n==="project-settings"?d("workflow-settings"):n==="save-as-new-workflow"||n==="clone-new-workflow"?S.preventDefault():j.handleSubmit(R)()}};return e.jsx(on,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(R),autoComplete:"off",style:{display:"flex",flexDirection:"column",height:"100%",marginBottom:0},onKeyDown:k,"data-is-loading":j.formState.isLoading,"data-testid":"project-setup-dialog-form",children:[e.jsxs(Be,{sx:{py:2,display:"flex",minHeight:"590px",overflowY:"unset",[g.breakpoints.down("md")]:{flexDirection:"column"}},children:[e.jsx(C,{sx:{width:"50%",[g.breakpoints.down("md")]:{width:"100%"},minWidth:0},children:e.jsx(Nm,{onObjectTypeSelect:u,isAuthorized:m,visibleFormType:n,onFormTypeChange:d,activeObjectType:s,onInitialStateChange:c})}),e.jsx(je,{orientation:y?"horizontal":"vertical",sx:{mx:2,height:"initial",my:0,[g.breakpoints.down("md")]:{my:2}}}),e.jsx(C,{sx:{width:"50%",[g.breakpoints.down("md")]:{width:"100%"},display:"flex",flexDirection:"column"},children:e.jsx(Um,{objectType:s,isAuthorized:m,onFormTypeChange:d,isInitialState:l})})]}),e.jsxs(Ve,{sx:{justifyContent:"space-between",px:3,py:2,position:"sticky",backgroundColor:"background.paper",bottom:0},children:[e.jsx(U,{onClick:()=>{v()},color:"neutral",children:e.jsx(x,{...Ot.cancel})}),e.jsxs(C,{sx:{display:"flex",alignItems:"center",maxHeight:"36px"},children:[e.jsx(qm,{error:a,visibleFormType:n}),e.jsx(U,{type:"submit",disabled:E,children:e.jsx(x,{...Ot["create-project"]})})]})]})]})})},Xm=({onCancel:t,onProjectCreatedGoto:s})=>e.jsxs(ro,{open:!0,onClose:()=>ye("project-setup-closed-dialog"),onCancel:t,PaperProps:{sx:{maxWidth:"96vw",minWidth:"600px",width:"1250px"}},children:[e.jsx(Oe,{sx:{position:"sticky",backgroundColor:"background.paper",top:0,zIndex:100},children:e.jsx(x,{...Ot["create-new-project"]})}),e.jsx(Qm,{onProjectCreatedGoto:s})]}),Zm=F({add:{id:"ftrack-spark-components.add-header.add",defaultMessage:"Add",description:"Button label for adding new item to list"}});function dr({children:t,renderSelector:s,disabled:o,addItem:n}){const[r,a]=p.useState(null),i=()=>{a(null),n(r)};return e.jsxs(C,{component:"header",sx:[{p:"1.6rem 2.4rem 0",borderBottom:"1px solid",borderBottomColor:"divider"},o&&{opacity:0,pointerEvents:"none"}],children:[e.jsx(M,{variant:"subtitle2",sx:{color:"text.secondary"},children:t}),e.jsxs(C,{sx:{display:"flex",flexDirection:"row"},children:[s({value:r,onChange:a}),e.jsx(U,{onClick:i,disabled:!r,children:e.jsx(x,{...Zm.add})})]})]})}const Rs=F({"all-open-projects":{id:"ftrack-spark-components.user-role-editor.all-open-projects",defaultMessage:"All open projects on"},"all-open-projects-description":{id:"ftrack-spark-components.user-role-editor.all-open-projects-description",defaultMessage:"Grants permissions to all projects with open access"},"listed-projects":{id:"ftrack-spark-components.user-role-editor.listed-projects",defaultMessage:"All open projects off"},"listed-projects-description":{id:"ftrack-spark-components.user-role-editor.listed-projects-description",defaultMessage:"Only grants permissions on listed projects"}});function oi({value:t,onChange:s}){const o={common:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},description:{color:"text.secondary",fontSize:"fontSizeSmall"}};return e.jsxs(e.Fragment,{children:[e.jsxs(Bt,{disablePadding:!0,children:[e.jsx(we,{sx:{maxWidth:"82%",display:"grid",pl:3,pb:"0.5rem",mt:"1.3rem"},primary:t?e.jsx(M,{sx:{...o.common},children:e.jsx(x,{...Rs["all-open-projects"]})}):e.jsx(M,{sx:{...o.common},children:e.jsx(x,{...Rs["listed-projects"]})}),secondary:t?e.jsx(M,{component:"span",sx:{...o.description,...o.common},children:e.jsx(x,{...Rs["all-open-projects-description"]})}):e.jsx(M,{component:"span",sx:{...o.description,...o.common},children:e.jsx(x,{...Rs["listed-projects-description"]})})}),e.jsx(io,{children:e.jsx(lo,{checked:t,onChange:s},"switch")})]}),e.jsx(je,{})]})}oi.propTypes={value:W.bool.isRequired,onChange:W.func.isRequired};const ur=F({"private-access":{id:"ftrack-spark-components.user-role-editor.private-access",defaultMessage:"Private access"},"open-access":{id:"ftrack-spark-components.user-role-editor.open-access",defaultMessage:"Open access"}});function ni({project:t,onDelete:s}){const[o,n]=p.useState(!1),r=p.useCallback(()=>{n(!1)},[]),a=p.useCallback(()=>{n(!0)},[]),i={captionWithIcon:{lineHeight:"1.6rem",pt:"0.3rem",fontSize:"fontSizeSmall",color:"text.secondary"},captionIcon:{fontSize:"fontSizeLarge",verticalAlign:"middle",mr:1}};return e.jsxs(Bt,{disablePadding:!0,sx:{pr:0,minHeight:"6.4rem"},onMouseLeave:r,onMouseEnter:a,children:[e.jsx(we,{primary:t.full_name,sx:{pl:3},secondary:t.is_private?e.jsxs(M,{component:"span",sx:{...i.captionWithIcon},children:[e.jsx(Jr,{sx:{...i.captionIcon}}),e.jsx(x,{...ur["private-access"]})]}):e.jsxs(M,{component:"span",sx:{...i.captionWithIcon},children:[e.jsx(Qr,{sx:{...i.captionIcon}}),e.jsx(x,{...ur["open-access"]})]})}),e.jsx(io,{onMouseEnter:a,sx:{mr:1},children:o?e.jsx(ie,{"aria-label":"delete",onClick:s,children:e.jsx(Xo,{sx:{fontSize:"h4.fontSize"}})}):null})]},t.id)}ni.propTypes={project:W.shape({id:W.string.isRequired,full_name:W.string.isRequired,is_private:W.bool.isRequired}).isRequired,onDelete:W.func.isRequired};const ef=J(e.jsx("path",{d:"M16.5 12c1.38 0 2.49-1.12 2.49-2.5S17.88 7 16.5 7 14 8.12 14 9.5s1.12 2.5 2.5 2.5M9 11c1.66 0 2.99-1.34 2.99-3S10.66 5 9 5 6 6.34 6 8s1.34 3 3 3m7.5 3c-1.83 0-5.5.92-5.5 2.75V19h11v-2.25c0-1.83-3.67-2.75-5.5-2.75M9 13c-2.33 0-7 1.17-7 3.5V19h7v-2.25c0-.85.33-2.34 2.37-3.47C10.5 13.1 9.66 13 9 13"})),pr=F({"role-all-open-projects":{id:"ftrack-spark-components.user-role-editor.role-all-open-projects",defaultMessage:"All open projects"},"assigned-projects":{id:"ftrack-spark-components.user-role-editor.assigned-projects",defaultMessage:"Open projects with assigned tasks"}});function ri({selectedRoleId:t,userRole:s,onSelect:o,onDelete:n}){const[r,a]=p.useState(!1),i=oe(),l=t===s.security_role.id,c={textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},u=s.user_security_role_projects.map(h=>h.project.full_name);s.is_all_projects&&u.unshift(i.formatMessage(pr["role-all-open-projects"])),s.security_role.type==="ASSIGNED"&&u.unshift(i.formatMessage(pr["assigned-projects"]));const d=p.useCallback(()=>{a(!1)},[]),m=p.useCallback(()=>{a(!0)},[]);return e.jsxs(Bt,{disablePadding:!0,onClick:o,onMouseLeave:d,sx:[{pr:0},l?{backgroundColor:"other.appbarAlternativeColor"}:{}],children:[e.jsxs(Go,{sx:{pl:3,width:"inherit",minHeight:"6.4rem"},onMouseEnter:m,children:[e.jsx(Le,{sx:{" .MuiSvgIcon-root":{fontSize:"h3.fontSize"}},children:e.jsx(ef,{sx:{color:"text.secondary"}})}),e.jsx(we,{sx:{ml:-2,maxWidth:"60%",display:"grid"},primary:e.jsx(M,{sx:{lineHeight:1,...c},children:s.security_role.name}),secondary:e.jsx(M,{component:"span",sx:{fontSize:"fontSizeSmall",color:"text.secondary",...c},children:u.join(", ")})})]}),e.jsx(io,{sx:{right:"3.2rem"},onMouseEnter:m,children:r?e.jsx(ie,{"aria-label":"delete",onClick:n,children:e.jsx(Xo,{sx:{pt:0,fontSize:"h4.fontSize"}})}):null})]},s.security_role.id)}ri.propTypes={selectedRoleId:W.string,userRole:W.shape({id:W.string.isRequired,security_role:W.PropTypes.shape({name:W.string.isRequired,id:W.string.isRequired}).isRequired,user_security_role_projects:W.PropTypes.arrayOf(W.PropTypes.shape({project:W.PropTypes.shape({full_name:W.string.isRequired}).isRequired}))}).isRequired,onSelect:W.func.isRequired,onDelete:W.func.isRequired};const lt=F({title:{id:"ftrack-spark-components.user-role-editor.title",defaultMessage:"Manage roles for {userName}"},"security-roles-header":{id:"ftrack-spark-components.user-role-editor.security-roles-header",defaultMessage:"Roles"},"projects-header":{id:"ftrack-spark-components.user-role-editor.projects-header",defaultMessage:"Projects"},"action-cancel":{id:"ftrack-spark-components.user-role-editor.action-cancel",defaultMessage:"Cancel"},"action-save":{id:"ftrack-spark-components.user-role-editor.save-changes",defaultMessage:"Save changes"},"no-role-selected":{id:"ftrack-spark-components.user-role-editor.no-role-selected",defaultMessage:"Select a role to view associated projects"},"no-roles":{id:"ftrack-spark-components.user-role-editor.no-roles",defaultMessage:"{userName} has no roles, add one above."},"assigned-role":{id:"ftrack-spark-components.user-role-editor.assigned-role",defaultMessage:'The "{roleName}" role is automatically granted on any project with open access where {userName} is assigned to a task.'},"error-message":{id:"ftrack-spark-components.user-role-editor.error-message",defaultMessage:"An error occurred"},"no-matching-projects":{id:"ftrack-spark-components.user-role-editor.no-matching-projects",defaultMessage:"No matching projects found"},"no-matching-private-projects":{id:"ftrack-spark-components.user-role-editor.no-matching-private-projects",defaultMessage:"No matching private projects found"},"no-matching-roles":{id:"ftrack-spark-components.user-role-editor.no-matching-roles",defaultMessage:"No roles found"}});function tf(t,s){let o=[...t];return s.forEach(n=>{n.action==="add_user_security_role"?o.push(n.data):n.action==="remove_user_security_role"&&(o=o.filter(r=>r.security_role.id!==n.role_id))}),o=o.map(n=>{const r={...n};return s.forEach(a=>{if(a.role_id===r.security_role.id){if(a.action==="grant_user_security_role_project")a.all_open_projects===!0?r.is_all_projects=!0:r.user_security_role_projects=[...r.user_security_role_projects,{project:a.data}];else if(a.action==="revoke_user_security_role_project")if(a.all_open_projects===!0)r.is_all_projects=!1;else{const i=r.user_security_role_projects.findIndex(l=>l.project.id===a.project_id);i!==-1&&(r.user_security_role_projects=[...r.user_security_role_projects.slice(0,i),...r.user_security_role_projects.slice(i+1)])}}}),r.user_security_role_projects=r.user_security_role_projects.sort((a,i)=>a.project.full_name.localeCompare(i.project.full_name)),r}),o=o.sort((n,r)=>n.security_role.name.localeCompare(r.security_role.name)),o}function sf(t,s,o){const n=t.find(l=>l.security_role.id===o);let r=!1,a=!1,i=[];return n&&(r=n.is_all_projects,a=n.security_role.type==="ASSIGNED",i=n.user_security_role_projects.map(l=>l.project)),{projects:i,isAllProjects:r,isRoleAssigned:a}}const of={add_user_security_role:"remove_user_security_role",remove_user_security_role:"add_user_security_role",grant_user_security_role_project:"revoke_user_security_role_project",revoke_user_security_role_project:"grant_user_security_role_project"},nf={add_user_security_role:["user_id","role_id"],remove_user_security_role:["user_id","role_id"],grant_user_security_role_project:["user_id","role_id","is_all_projects","project_id"],revoke_user_security_role_project:["user_id","role_id","is_all_projects","project_id"]};function rf(t,s){let o=[...t];const n=s.action,r=of[n],a=nf[n],i=(u,d,m)=>d.action===u&&a.every(h=>d[h]===m[h]),l=o.findIndex(u=>i(s.action,u,s)),c=o.findIndex(u=>i(r,u,s));return l!==-1||(c!==-1?o.splice(c,1):(o.push(s),s.action==="remove_user_security_role"&&(o=o.filter(u=>{const d=u.action==="grant_user_security_role_project"||u.action==="revoke_user_security_role_project";return!(u.role_id===s.role_id&&d)})))),o}function ai(t){const[s,o]=p.useState(!0),[n,r]=p.useState([]),[a,i]=p.useState([]),[l,c]=p.useState([]),[u,d]=p.useState([]),[m,h]=p.useState(null),[f,b]=p.useState(null),[g,y]=p.useState(""),[j,w]=p.useState(null),[v,I]=p.useState(null),E=H(),L=oe(),{userId:_,className:R,onSave:k,onClose:S}=t,A=Q=>{const G=Q.security_role.id;P(n,u,G)},z=(Q,G)=>{const fe=typeof G>"u"?f:G,Ge=rf(u,Q);P(n,Ge,fe)},P=p.useCallback((Q,G,fe)=>{const Ge=tf(Q,G),{projects:B,isAllProjects:O,isRoleAssigned:ge}=sf(Ge,G,fe);o(!1),r(Q),d(G),b(fe),i(Ge),c(B),w(O),I(ge),h(null)},[]),T=Q=>{const G=Q.id;z({action:"add_user_security_role",role_id:G,user_id:_,data:{id:G,is_all_projects:!1,user_security_role_projects:[],security_role:Q}},G)},N=Q=>{const G=Q.security_role.id;let fe=f;f===G&&(fe=null),z({action:"remove_user_security_role",role_id:G,user_id:_},fe)},Y=(Q,G)=>{z(G?{action:"grant_user_security_role_project",role_id:Q,user_id:_,project_id:null,all_open_projects:!0}:{action:"revoke_user_security_role_project",role_id:Q,user_id:_,project_id:null,all_open_projects:!0})},te=(Q,G)=>{z({action:"revoke_user_security_role_project",role_id:Q,user_id:_,project_id:G})},q=(Q,G)=>{z({action:"grant_user_security_role_project",role_id:Q,user_id:_,project_id:G.id,data:{...G}})},V=()=>{o(!0);const Q=u.map(({action:G,role_id:fe,user_id:Ge,project_id:B,all_open_projects:O})=>({action:G,role_id:fe,user_id:Ge,project_id:B,all_open_projects:O}));E.call(Q).then(G=>k(u,G)).catch(G=>{o(!1),h(G)})},xe=()=>{const Q=a.find(G=>G.security_role.id===f);return f?v?e.jsx(hs,{label:e.jsx(x,{...lt["assigned-role"],values:{userName:g,roleName:Q.security_role.name}})}):e.jsx(St,{sx:{p:0},children:e.jsxs(Tn,{component:null,children:[e.jsx(oi,{value:j,onChange:G=>Y(f,G.target.checked)},"all_open_projects"),l.map(G=>e.jsx($t,{timeout:En,children:e.jsx(ni,{project:G,onDelete:()=>te(f,G.id)})},G.id))]})},f):e.jsx(hs,{label:e.jsx(x,{...lt["no-role-selected"]})})},at=()=>!a||!a.length?e.jsx(St,{children:e.jsx(hs,{label:e.jsx(x,{...lt["no-roles"],values:{userName:g}})})}):e.jsx(St,{sx:{p:0},children:e.jsx(Tn,{component:null,children:a.map(Q=>e.jsx($t,{timeout:En,children:e.jsx(ri,{userRole:Q,selectedRoleId:f,onSelect:()=>A(Q),onDelete:()=>N(Q)})},Q.id))})});p.useEffect(()=>{(()=>{const G=["is_all_projects","security_role.name","security_role.type","user_security_role_projects.project.id","user_security_role_projects.project.full_name","user_security_role_projects.project.is_private"].join(",");E.query(`select ${G} from UserSecurityRole where user_id is "${_}" order by security_role.name`).then(fe=>{P(fe.data,[],null)}).catch(fe=>{r([]),i([]),c([]),d([]),b(null),h(fe),o(!1)}),E.query(`select first_name, last_name from User where id is "${_}"`).then(fe=>y(`${fe.data[0].first_name} ${fe.data[0].last_name}`))})()},[P,_,E]);let qe='type != "API"';const ts={flex:1,minWidth:0,position:"relative",display:"flex",flexDirection:"column"};if(a.length){const Q=a.map(G=>`"${G.security_role.id}"`);qe+=` and id not_in (${Q.join(",")})`}let bt=j?"is_private is True and status is active":"status is active";return l.length&&(bt&&(bt+=" and "),bt+=`id not_in (${l.map(Q=>`"${Q.id}"`).join(",")})`),e.jsxs(We,{open:!0,onClose:S,PaperProps:{sx:{width:"850px",height:"600px",maxWidth:"96vw",maxHeight:"96vh"}},className:R,children:[e.jsx(Oe,{children:e.jsx(x,{...lt.title,values:{userName:g}})}),e.jsxs(Be,{sx:{display:"flex",p:0},children:[s?e.jsx(xt,{sx:{m:"auto"}}):null,m?e.jsx(wl,{active:!0,icon:e.jsx(vl,{}),message:L.formatMessage(lt["error-message"]),details:m.message,dismissable:!0,onDismiss:()=>h(null)}):null,!s&&!m?e.jsxs(e.Fragment,{children:[e.jsxs(C,{component:"section",sx:ts,children:[e.jsx(dr,{renderSelector:({onChange:Q,value:G})=>e.jsx(C,{sx:{flexGrow:1,mt:1},children:e.jsx(It,{entityType:"SecurityRole",additionalProjections:["type"],optionsFilter:qe,onChange:Q,value:G})}),addItem:T,children:e.jsx(x,{...lt["security-roles-header"]})}),at()]}),e.jsx(je,{orientation:"vertical",flexItem:!0}),e.jsxs(C,{component:"section",sx:ts,children:[e.jsx(dr,{disabled:!f,renderSelector:({onChange:Q,value:G})=>e.jsx(C,{sx:{flexGrow:1,mt:1},children:e.jsx(It,{entityType:"Project",additionalProjections:["color","is_private"],optionsFilter:bt,onChange:Q,value:G})}),addItem:Q=>q(f,Q),children:e.jsx(x,{...lt["projects-header"]})}),xe()]})]}):null]}),e.jsxs(Ve,{children:[e.jsx(U,{onClick:S,color:"neutral",children:e.jsx(x,{...lt["action-cancel"]})}),e.jsx(U,{disabled:!u.length||!a?.length,onClick:V,children:e.jsx(x,{...lt["action-save"]})})]})]})}ai.propTypes={userId:W.string.isRequired,className:W.string,onSave:W.func.isRequired,onClose:W.func};function af(t){return Te("MuiListItemAvatar",t)}Ee("MuiListItemAvatar",["root","alignItemsFlexStart"]);const lf=t=>{const{alignItems:s,classes:o}=t;return Re({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},af,o)},cf=le("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,o.alignItems==="flex-start"&&s.alignItemsFlexStart]}})({minWidth:56,flexShrink:0,variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}),df=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiListItemAvatar"}),{className:r,...a}=n,i=p.useContext(Sl),l={...n,alignItems:i.alignItems},c=lf(l);return e.jsx(cf,{className:ue(c.root,r),ownerState:l,ref:o,...a})}),ct=F({save:{id:"ftrack-spark-components.add-access-dialog.save",description:'Text on "save"-button',defaultMessage:"Save"},cancel:{id:"ftrack-spark-components.add-access-dialog.cancel",description:'Text on "cancel"-button',defaultMessage:"Cancel"},title:{id:"ftrack-spark-components.add-access-dialog.title",description:"Title text for dialog",defaultMessage:"Add user access to project"},"button-add":{id:"ftrack-spark-components.add-access-dialog.button-add",description:'Text on "add"-button',defaultMessage:"Add"},"search-user-description":{id:"ftrack-spark-components.add-access-dialog.search-user-description",description:"Description for usage of dialog.",defaultMessage:"Select a user and role to add access to this project"},"search-user-hint":{id:"ftrack-spark-components.add-access-dialog.search-user-hint",description:"Information on how to use the selectors.",defaultMessage:"Search for a person by name or email address"},"user-label":{id:"ftrack-spark-components.add-access-dialog.user-label",description:'Text for "user"-label',defaultMessage:"User"},"roles-label":{id:"ftrack-spark-components.add-access-dialog.roles-label",description:'Text for "role"-label',defaultMessage:"Role"},"first-select-user":{id:"ftrack-spark-components.user-role-selector.first-select-user",description:"Placeholder for selecting role when no user is selected",defaultMessage:"First select user"}});function ii({users:t,onUserRemove:s,enableRemove:o,userId:n}){const r=H();return e.jsx(St,{sx:{height:"68%",overflow:"auto",pt:3,pb:0},children:t?.map(a=>e.jsxs(Bt,{sx:{pb:3,cursor:"default"},disablePadding:!0,children:[e.jsx(df,{children:e.jsx(Zr,{session:r,entity:a,sx:{verticalAlign:"top",width:"4rem",height:"4rem"}})}),e.jsx(we,{primary:a.name||`${a.first_name} ${a.last_name}`,secondary:a.role.name}),e.jsx(io,{sx:{top:"40%",right:0},children:o&&a.id!==n?[e.jsx(ie,{onClick:()=>s(a.id),"aria-label":"clear",children:e.jsx(Il,{sx:{fontSize:"h4.fontSize"}})},`remove-user-${a.id}`)]:[]})]},`user-item-${a.id}`))})}ii.propTypes={users:W.array.isRequired,enableRemove:W.bool.isRequired,userId:W.string.isRequired,onUserRemove:W.func.isRequired};function li({onClose:t,onSave:s,onError:o,projectId:n,userId:r}){const[a,i]=p.useState(!1),[l,c]=p.useState(),[u,d]=p.useState([]),[m,h]=p.useState(),f=H(),b=p.useCallback(()=>{const _=[{thumbnail_id:l.thumbnailId,name:_l(l),id:l.id,type:"user",role:{id:m.id,name:m.name}},...u];h(null),c(null),d(_)},[l,m,u]),g=p.useCallback(_=>{let R=u;u.some(k=>k.id===_)&&(R=u.filter(k=>k.id!==_)),d(R)},[u]),y=p.useCallback(_=>{c(_)},[]),j=p.useCallback(_=>{h(_)},[]),w=p.useCallback(()=>{i(!0);const _=u.map(R=>({action:"grant_user_security_role_project",role_id:R.role.id,user_id:R.id,project_id:n}));f.call(_).then(()=>{i(!1),s()}).catch(R=>{i(!1),o&&o(R)})},[u,n,f,o,s]),v={fontSize:"fontSizeSmall",fontWeight:"fontWeightMedium",color:"text.secondary",mb:"-0.1rem"},I=u.length>0;let E=`id is_not "${r}" and is_active is true and
          id not_in (select id from User where user_security_roles.user_id is "${n}")`;if(u.length){const _=u.map(R=>`"${R.id}"`).join(", ");E=`${E} and id not_in (${_})`}const L=oe();return e.jsxs(We,{open:!0,onClose:t,PaperProps:{sx:{maxWidth:"96vw",maxHeight:"96vh",width:"650px",height:"500px"}},children:[e.jsx(Oe,{children:e.jsx(x,{...ct.title})}),e.jsxs(Be,{sx:{overflow:"hidden"},children:[e.jsx(Ct,{children:e.jsx(x,{...ct["search-user-description"]})}),e.jsxs(C,{sx:{display:"flex",pt:4},children:[e.jsxs(C,{sx:{flex:1,mr:4},children:[e.jsx(M,{component:"label",htmlFor:"user",sx:{...v},children:e.jsx(x,{...ct["user-label"]})}),e.jsx(It,{entityType:"User",onChange:y,value:l,optionsFilter:E})]}),e.jsxs(C,{sx:{flex:1},children:[e.jsx(M,{component:"label",htmlFor:"role",sx:{...v},children:e.jsx(x,{...ct["roles-label"]})}),e.jsx(It,{entityType:"SecurityRole",additionalProjections:["name","type"],optionsFilter:`type is "PROJECT" and user_security_roles any (user_id is "${l?.id}")`,onChange:j,value:m,placeholder:l?.id?void 0:L.formatMessage(ct["first-select-user"])})]}),e.jsx(U,{variant:"text",disabled:!l||!m,onClick:b,sx:{mt:"auto",mr:"-2rem",ml:"1rem"},children:e.jsx(x,{...ct["button-add"]})})]}),e.jsx(M,{sx:{fontSize:"fontSizeSmall",color:"text.secondary",mt:"0.1rem"},children:e.jsx(x,{...ct["search-user-hint"]})}),a?e.jsx(xt,{sx:{display:"block",m:"3.2rem auto"}}):e.jsx(ii,{enableRemove:!0,users:u,onUserRemove:g})]}),e.jsxs(Ve,{children:[e.jsx(U,{onClick:t,color:"neutral",children:e.jsx(x,{...ct.cancel})}),e.jsx(U,{disabled:!I||a,onClick:w,children:e.jsx(x,{...ct.save})})]})]})}li.propTypes={onClose:W.func,onSave:W.func,onError:W.func,projectId:W.string,userId:W.string};const wt=F({"title-user":{id:"ftrack-spark-components.change-access-dialog.title-user",description:"Title for dialog",defaultMessage:"Roles for {selectedUser}"},description:{id:"ftrack-spark-components.change-access-dialog.description",description:"Descriptive text for dialog",defaultMessage:"Select which role {selectedUser} should have in this project."},save:{id:"ftrack-spark-components.change-access-dialog.save",description:"Descriptive text for dialog",defaultMessage:"Save"},cancel:{id:"ftrack-spark-components.change-access-dialog.cancel",description:"Descriptive text for dialog",defaultMessage:"Cancel"},"user-has-no-access":{id:"ftrack-spark-components.change-access-dialog.user-has-no-access",description:"Info text when user do not have access",defaultMessage:"{selectedUser} does not have any roles that can be applied. New roles can be added from system settings."},"user-has-single-role":{id:"ftrack-spark-components.change-access-dialog.user-has-single-role",description:"Info text when user has singe role.",defaultMessage:"{selectedUser} only has the {roleName} role. Additional roles can be given from system settings."},"assignee-role":{id:"ftrack-spark-components.change-access-dialog.assignee-role",defaultMessage:"Added on projects with open access and assigned tasks"},"role-open-access":{id:"ftrack-spark-components.change-access-dialog.role-open-access",defaultMessage:"Added on projects with open access"}});function ci({type:t,isAllProjects:s,name:o}){let n=null;const r={fontSize:"fontSizeSmall",color:"text.secondary"};return t==="ASSIGNED"?n=e.jsx(x,{...wt["assignee-role"]}):s&&(n=e.jsx(x,{...wt["role-open-access"]})),e.jsxs(C,{sx:{position:"relative",top:n?"10px":0},children:[e.jsx(M,{sx:{...r},children:o}),n?e.jsx(M,{sx:{...r},children:n}):null]})}ci.propTypes={name:W.string,type:W.string,isAllProjects:W.bool};function di({onClose:t,userId:s,projectId:o,onSave:n,onError:r}){const[a,i]=p.useState(!0),[l,c]=p.useState(!1),[u,d]=p.useState(null),[m,h]=p.useState([]),[f,b]=p.useState([]),[g,y]=p.useState(null),[j,w]=p.useState(null),v=H();p.useEffect(()=>{o&&v.call([X.query(`select security_role.name, security_role.type, security_role_id, is_all_open_projects from UserSecurityRole where user_id is "${s}"`),X.query(`select first_name from User where id is "${s}"`),X.query(`select is_private from Project where id is "${o}"`),X.query(`select user_security_role.security_role_id from UserSecurityRoleProject where project_id is "${o}" and user_security_role.user_id is "${s}"`),X.query(`select id from Appointment where resource_id is "${s}" and context[TypedContext].project_id is "${o}" limit 1`)]).then(([_,R,k,S,A])=>{const{first_name:z}=R.data[0],{is_private:P}=k.data[0],T=A.data.length>0,N=S.data.map(V=>V.user_security_role.security_role_id),Y=_.data.map(V=>({id:V.security_role_id,isAllProjects:!P&&V.is_all_open_projects,name:V.security_role.name,type:V.security_role.type})).sort((V,xe)=>V.name.localeCompare(xe.name)),te=Y.filter(V=>V.type==="ASSIGNED"?!P&&T:N.includes(V.id)||V.isAllProjects).map(V=>V.id),q=Y.filter(V=>V.type==="ASSIGNED"||V.isAllProjects).map(V=>V.id);i(!1),d(z),b(N),y(te),w(q),h(Y),c(te.length>0)})},[o,v,s]);const I=(_,R)=>{let k=g;R?g.includes(_)||(k=[...g,_]):k=g.filter(S=>S!==_),y(k),c(k.length>0)},E=()=>{i(!0);const _=f.filter(k=>g.includes(k)===!1).map(k=>({action:"revoke_user_security_role_project",role_id:k,user_id:s,project_id:o})),R=g.filter(k=>f.includes(k)===!1).map(k=>({action:"grant_user_security_role_project",role_id:k,user_id:s,project_id:o}));v.call([..._,...R]).then(()=>{i(!1),n()}).catch(k=>{i(!1),r&&r(k)})};let L;if(a)L=e.jsx(xt,{sx:{display:"block",m:"3.2rem auto 0.8rem"}});else if(m.length===0)L=e.jsx(M,{sx:{fontSize:"fontSizeRegular",color:"text.secondary"},children:e.jsx(x,{...wt["user-has-no-access"],values:{selectedUser:u}})});else if(m.length===1){const _=e.jsx(C,{component:"span",sx:{fontWeight:"fontWeightBold"},children:m[0].name});L=e.jsx(M,{sx:{fontSize:"fontSizeRegular",color:"text.secondary"},children:e.jsx(x,{...wt["user-has-single-role"],values:{selectedUser:u,roleName:_}})})}else L=e.jsx(Cl,{children:m.map(_=>{const R=k=>{I(_.id,k.target.checked)};return e.jsx(gt,{sx:{mr:0},control:e.jsx(ws,{checked:g.includes(_.id),disabled:j.includes(_.id),onChange:R,sx:{p:"0.6rem"}}),label:e.jsx(ci,{..._})},_.id)})});return e.jsxs(We,{open:!0,onClose:t,PaperProps:{sx:{width:"400px",minHeight:"360px"}},children:[e.jsx(Oe,{children:e.jsx(x,{...wt["title-user"],values:{selectedUser:u}})}),e.jsxs(Be,{children:[e.jsx(Ct,{sx:{pb:"1.9rem"},children:e.jsx(x,{...wt.description,values:{selectedUser:u}})}),L]}),e.jsxs(Ve,{children:[e.jsx(U,{onClick:t,color:"neutral",children:e.jsx(x,{...wt.cancel})}),e.jsx(U,{disabled:!l,onClick:E,children:e.jsx(x,{...wt.save})})]})]})}di.propTypes={onClose:W.func,userId:W.string.isRequired,projectId:W.string.isRequired,onSave:W.func,onError:W.func};const uf=J(e.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"})),pf={id:"DUMMY_NEW_ENTITY",name:"NEW ENTITY",color:"primary"},mf={id:"DUMMY_ANY_STATUS",name:"Any"},ff={id:"DUMMY_NONE_STATUS",name:"None"},Ro=F({"new-status":{id:"ftrack-spark.components.manage-status-permissions.new-status",description:"status label",defaultMessage:"NEW ENTITY"},"any-status":{id:"ftrack-spark.components.manage-status-permissions.any-status",description:"status label",defaultMessage:"Any"},"none-status":{id:"ftrack-spark.components.manage-status-permissions.none-status",description:"status label",defaultMessage:"None"}});function bn(){const t=oe();return{new:{...pf,name:t.formatMessage(Ro["new-status"])},any:{...mf,name:t.formatMessage(Ro["any-status"])},none:{...ff,name:t.formatMessage(Ro["none-status"])}}}function Us({status:t}){const s=Ue();oe();const o=bn();let n,r,a,i,l;switch(r=t.name,t.id){case o.new.id:n=e.jsx(Ml,{}),a=s.palette.primary.main,i=s.palette.primary.main,l=s.palette.primary.main;break;case o.any.id:n=e.jsx(ea,{}),a=s.palette.success.main;break;case o.none.id:n=e.jsx(nn,{}),a=s.palette.error.main;break;default:n=e.jsx(qs,{}),a=t.color,i=t.color;break}return e.jsx(De,{sx:{borderColor:i,color:l,margin:.5,cursor:"inherit"},icon:n,label:r,iconColor:a})}const yt=F({title:{id:"ftrack-spark.components.manage-status-permissions.status-selector.title",description:"Title message for selector",defaultMessage:"Set permissions for {status}"},subtitle:{id:"ftrack-spark.components.manage-status-permissions.status-selector.subtitle",description:"Subtitle message for selector",defaultMessage:"Choose from which statuses the role {role} is allowed to change to {status}"},"none-label":{id:"ftrack-spark.components.manage-status-permissions.status-selector.none-label",description:"Label for 'None' option",defaultMessage:"None"},"any-label":{id:"ftrack-spark.components.manage-status-permissions.status-selector.any-label",description:"Label for 'Any' option",defaultMessage:"Any status"},"none-suffix":{id:"ftrack-spark.components.manage-status-permissions.status-selector.none-suffix",description:"Suffix for 'None' option",defaultMessage:"Never allowed"},"any-suffix":{id:"ftrack-spark.components.manage-status-permissions.status-selector.all-suffix",description:"Suffix for 'Any' option",defaultMessage:"Always allowed"},cancel:{id:"ftrack-spark.components.manage-status-permissions.status-selector.cancel",description:"Cancel button label",defaultMessage:"Cancel"},save:{id:"ftrack-spark.components.manage-status-permissions.status-selector.save",description:"Save button label",defaultMessage:"Save"}});function Ps({label:t,checked:s,onChange:o,color:n,suffix:r}){const a=Ue();return e.jsx(gt,{control:e.jsx(ws,{checked:s,onChange:o,size:"small",sx:{p:.5,ml:1}}),label:e.jsxs(e.Fragment,{children:[e.jsx(M,{variant:"body1",component:"span",sx:{color:n},children:t}),r&&e.jsxs(e.Fragment,{children:["",e.jsxs(M,{variant:"body1",component:"span",sx:{color:a.palette.text.secondary},children:["(",r,")"]})]})]})})}function hf({group:t,projectSchemaId:s,role:o,entityTypeObj:n,toStatus:r,allStatuses:a,anchorEl:i,onClose:l,onChange:c}){const u=Ue(),d=H(),m=bn(),h=t?.status_rules?.map(S=>S.status_id??null)??null,[f,b]=p.useState(h),g=p.useMemo(()=>a.filter(S=>S.id!==r.id),[a,r]),y=p.useMemo(()=>[null,...g.map(S=>S.id)],[g]),[j,w]=p.useState(!1);function v(){return!f}function I(S){return v()||f.includes(S)}function E(){return!!f&&f.length===0}function L(S,A){b(A?y.filter(z=>f.includes(z)||z===S):f===null?y.filter(z=>z!==S):f.filter(z=>z!==S))}function _(){b([])}function R(){v()?b(y):b(null)}const k=p.useCallback(async()=>{if(f===h){l();return}w(!0);const S=n.id==="AssetVersion"?"AssetVersionStatusRuleGroup":"TypedContextStatusRuleGroup";if(f===null)await d.delete(S,t.id);else{const A=t??(await d.create(S,{schema_id:s,role_id:o.id,object_type_id:n.typeId,status_id:r.id})).data;let z,P;h?(P=A.status_rules?.filter(T=>!f.includes(T.status_id))??[],z=f.filter(T=>!h.includes(T))):(P=[],z=f),await d.call([...P.map(T=>X.delete("StatusRule",T.id)),...z.map(T=>X.create("StatusRule",{status_id:T,status_rule_group_id:A.id}))],{decodeDatesAsIso:!0})}c(),w(!1)},[d,f,h,t,c,l,s,o,n,r]);return e.jsx(ta,{open:!0,anchorEl:i,onClose:l,children:e.jsxs(ae,{spacing:1,sx:{margin:"2rem"},children:[e.jsx(M,{variant:"h6",children:e.jsx(x,{...yt.title,values:{status:r.name}})}),e.jsx(M,{variant:"body2",sx:{color:u.palette.text.secondary,maxWidth:"24em"},children:e.jsx(x,{...yt.subtitle,values:{role:o.name,status:e.jsx(M,{variant:"subtitle2",component:"span",sx:{color:u.palette.text.primary},children:r.name})}})}),e.jsx(je,{}),e.jsxs(Rn,{children:[e.jsx(Ps,{label:e.jsx(x,{...yt["none-label"]}),checked:E(),onChange:_,suffix:e.jsx(x,{...yt["none-suffix"]}),color:"primary"}),e.jsx(Ps,{label:e.jsx(x,{...yt["any-label"]}),checked:v(),onChange:R,suffix:e.jsx(x,{...yt["any-suffix"]}),color:"primary"})]}),e.jsx(je,{}),e.jsxs(Rn,{children:[e.jsx(Ps,{label:m.new.name,checked:I(null),onChange:S=>L(null,S.target.checked),color:m.new.color},null),g.map(S=>e.jsx(Ps,{label:S.name,checked:I(S.id),onChange:A=>L(S.id,A.target.checked),color:null},S.id))]}),e.jsx(je,{}),e.jsxs(ae,{direction:"row",sx:{justifyContent:"flex-end"},children:[e.jsx(U,{color:"neutral",onClick:l,children:e.jsx(x,{...yt.cancel})}),e.jsx(U,{onClick:k,loading:j,children:e.jsx(x,{...yt.save})})]})]})})}function gf({role:t,toStatus:s,group:o,entityTypeObj:n,onChange:r,projectSchemaId:a,allStatuses:i,disabled:l}){const c=Ue(),[u,d]=p.useState(null),m=bn();function h(g){d(g.currentTarget)}function f(){r(),d(null)}function b(g){return g?i.find(y=>y.id===g):m.new}return e.jsxs(e.Fragment,{children:[e.jsxs(ae,{direction:"row",sx:{backgroundColor:c.palette.action.selected,borderRadius:"4px",padding:.5,cursor:l?"initial":"pointer",pointerEvents:l?"none":"initial","&:hover":{backgroundColor:c.palette.action.focus}},onClick:h,children:[e.jsx(ie,{color:"primary",children:e.jsx(co,{fontSize:"inherit"})}),e.jsx(C,{sx:{display:"flex",flexWrap:"wrap"},children:o?o.status_rules.length>0?o.status_rules.map(g=>e.jsx(Us,{status:b(g.status_id)},g.status_id)):e.jsx(Us,{status:m.none}):e.jsx(Us,{status:m.any})})]}),u&&e.jsx(hf,{role:t,toStatus:s,group:o,projectSchemaId:a,allStatuses:i,anchorEl:u,entityTypeObj:n,onClose:()=>d(null),onChange:f})]})}const kt=F({title:{id:"ftrack-spark.components.manage-status-permissions.title",description:"Title message for dialog",defaultMessage:"Manage status permissions for {entityType} in {workflowName} Workflow"},"select-role":{id:"ftrack-spark.components.manage-status-permissions.select-role.title",description:"Subtitle",defaultMessage:"Role"},"status-rules":{id:"ftrack-spark.components.manage-status-permissions.status-rules.title",description:"Subtitle",defaultMessage:"Status rules"},"status-rules-description":{id:"ftrack-spark.components.manage-status-permissions.status-rules.description",description:"Description",defaultMessage:"Choose from which statuses (left side) the status could be changed to (right side)."},"status-rules-description-note":{id:"ftrack-spark.components.manage-status-permissions.status-rules.description-note",description:"Description",defaultMessage:"Please note that you have to select NEW_ENTITY on at least one of the statuses to allow the {role} to create a new {entityType}."},"from-status":{id:"ftrack-spark.components.manage-status-permissions.status-rules.from",description:"Label for from status",defaultMessage:"From"},"to-status":{id:"ftrack-spark.components.manage-status-permissions.status-rules.to",description:"Label for to status",defaultMessage:"To"},"role-placeholder":{id:"ftrack-spark.components.manage-status-permissions.role-placeholder",description:"Placeholder for role selector",defaultMessage:"Select a role to edit status permissions"}});function xf(t){const s=H(),[o,n]=p.useState(null);return p.useEffect(()=>{(async()=>{const r=Tl(s.schemas,t);let a;r?a=(await s.query(et({entityType:"ObjectType",projection:["name"],filter:[`id = "${r}"`]}),{decodeDatesAsIso:!0})).data[0].name:a=$s[t]?.name??t,typeof a=="string"&&(a=a.toLowerCase()),n({id:t,name:a,typeId:r})})()},[t,s]),o}function bf(t,s){const o=H(),[n,r]=p.useState(null);return p.useEffect(()=>{(async()=>{if(!s)return;const i=[...await El.getStatuses(o,t,s.id,s.typeId)];i.sort((l,c)=>-(l.sort-c.sort)),r(i)})()},[t,s,o]),n}function yf(t){const{data:s,isLoading:o}=Vt({entityType:"ProjectSchema",entityId:t,projection:["name"],name:"manage-status-permissions-workflow"});return{data:s,isLoading:o}}function jf(t,s,o){const n=H(),{data:r,isLoading:a,isFetching:i}=Zs({gcTime:0,queryKey:["statusRuleGroups",t,s?.id,o?.id],queryFn:async()=>{const c=o.typeId,u=[`schema_id = "${t}"`,`role_id = "${s?.id}"`];return c&&u.push(`object_type_id = "${c}"`),(await n.query(et({entityType:c?"TypedContextStatusRuleGroup":"AssetVersionStatusRuleGroup",projection:["status_id","status_rules.status_id"],filter:u}),{decodeDatesAsIso:!0})).data},enabled:!!s&&!!o});return{data:p.useMemo(()=>a||!r?null:Object.fromEntries(r.map(c=>[c.status_id,c])),[r,a]),isLoading:a,isFetching:i}}function kf({onChange:t}){const s=oe();return e.jsx(It,{onChange:t,additionalProjections:["name"],entityType:"SecurityRole",placeholder:s.formatMessage(kt["role-placeholder"])})}function ui({projectSchemaId:t,entityType:s,onClose:o}){const n=Ue(),{data:r,isLoading:a}=yf(t),[i,l]=p.useState(null),c=xf(s),u=bf(t,c),{data:d,isFetching:m}=jf(t,i,c),h=eo();function f(){h.invalidateQueries(["statusRuleGroups",t,i.id,s])}const b=!!(d&&!m);return e.jsxs(We,{open:!a,fullWidth:!0,onClose:o,children:[e.jsx(Oe,{onClose:o,children:e.jsx(x,{...kt.title,values:{entityType:c?.name,workflowName:r?.name}})}),e.jsx(Be,{sx:{minHeight:"50rem",pb:2},children:e.jsxs(ae,{spacing:3,children:[e.jsxs(C,{sx:{"& .Select-placeholder":{color:"text.secondary"}},children:[e.jsx(M,{variant:"h6",children:e.jsx(x,{...kt["select-role"]})}),e.jsx(kf,{onChange:l})]}),e.jsxs(C,{sx:{opacity:b?1:.25},children:[e.jsx(M,{variant:"h6",children:e.jsx(x,{...kt["status-rules"]})}),e.jsxs(M,{variant:"body2",sx:{color:n.palette.text.secondary},children:[e.jsx(x,{...kt["status-rules-description"]})," ",i?.name&&e.jsx("b",{children:e.jsx(x,{...kt["status-rules-description-note"],values:{role:i?.name,entityType:c?.name}})})]})]}),e.jsxs(ae,{spacing:1,sx:{opacity:b?1:.25},children:[e.jsxs(ae,{direction:"row",children:[e.jsx(M,{sx:{flex:"2"},children:e.jsx(x,{...kt["from-status"]})}),e.jsx(M,{sx:{flex:"1"},children:e.jsx(x,{...kt["to-status"]})})]}),e.jsx(ae,{spacing:1,children:u?u.map(g=>e.jsxs(ae,{direction:"row",children:[e.jsxs(ae,{direction:"row",sx:{flex:"2",justifyContent:"space-between"},children:[e.jsx(gf,{group:d?d[g.id]:null,disabled:!b,toStatus:g,allStatuses:u,role:i,entityTypeObj:c,projectSchemaId:t,onChange:f}),e.jsx(uf,{sx:{marginTop:1,marginRight:.5,marginBottom:1,marginLeft:.5}})]}),e.jsx(C,{sx:{flex:"1",padding:.5},children:e.jsx(Us,{status:g})})]},g.id)):e.jsx(xt,{sx:{alignSelf:"center"}})})]})]})})]})}ui.propTypes={entityType:W.string.isRequired,projectSchemaId:W.string.isRequired,onClose:W.func.isRequired};const wf={entering:{transform:"none"},entered:{transform:"none"}},vf=p.forwardRef(function(s,o){const n=Ue(),r={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{addEndListener:a,appear:i=!0,children:l,easing:c,in:u,onEnter:d,onEntered:m,onEntering:h,onExit:f,onExited:b,onExiting:g,style:y,timeout:j=r,TransitionComponent:w=Rl,...v}=s,I=p.useRef(null),E=Pl(I,Al(l),o),L=T=>N=>{if(T){const Y=I.current;N===void 0?T(Y):T(Y,N)}},_=L(h),R=L((T,N)=>{Ll(T);const Y=Pn({style:y,timeout:j,easing:c},{mode:"enter"});T.style.webkitTransition=n.transitions.create("transform",Y),T.style.transition=n.transitions.create("transform",Y),d&&d(T,N)}),k=L(m),S=L(g),A=L(T=>{const N=Pn({style:y,timeout:j,easing:c},{mode:"exit"});T.style.webkitTransition=n.transitions.create("transform",N),T.style.transition=n.transitions.create("transform",N),f&&f(T)}),z=L(b),P=T=>{a&&a(I.current,T)};return e.jsx(w,{appear:i,in:u,nodeRef:I,onEnter:R,onEntered:k,onEntering:_,onExit:A,onExited:z,onExiting:S,addEndListener:P,timeout:j,...v,children:(T,{ownerState:N,...Y})=>p.cloneElement(l,{style:{transform:"scale(0)",visibility:T==="exited"&&!u?"hidden":void 0,...wf[T],...y,...l.props.style},ref:E,...Y})})}),pi=({value:t="#888888",onChange:s,border:o=!1,sx:n,ref:r})=>{const[a,i]=p.useState(null),[l,c]=p.useState(!1),u=p.useCallback(f=>{i(f.currentTarget)},[]),d=p.useCallback(()=>{i(null)},[]),m=p.useCallback(f=>{s(f.hex.toUpperCase()),d()},[s,d]),h=p.useCallback(f=>()=>c(f),[]);return e.jsxs("div",{children:[e.jsx(ie,{onMouseOver:h(!0),onMouseOut:h(!1),onFocus:h(!0),onBlur:h(!1),onClick:u,sx:[{backgroundColor:t,"&:hover":{backgroundColor:t,backgroundImage:"linear-gradient(rgba(0, 0, 0, 0.3) 0 0)"}},o?{border:2,borderColor:"background.paper"}:null,...Array.isArray(n)?n:[n]],ref:r,size:"large","aria-label":"edit",children:e.jsx(vf,{in:l,children:e.jsx(Br,{fontSize:"inherit",sx:{fill:"white"}})})}),e.jsx(ta,{id:"color-picker",open:!!a,anchorEl:a,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{mt:1,ml:-8},children:e.jsx(Dl,{color:t,onChange:m,colors:bs})})]})},Sf=Object.freeze(Object.defineProperty({__proto__:null,default:pi},Symbol.toStringTag,{value:"Module"}));function mi({projectId:t,onSuccess:s,onError:o}){const[n,r]=p.useState(null),a=H();p.useEffect(()=>{r(null),t&&a.query(`select color from Project where id is "${t}"`).then(l=>{const c=l.data[0].color;r(c)})},[t,a]);function i(l){if(_e.debug("Changing project color",t,l),!t)return;const c=n;r(l),a.update("Project",[t],{color:l}).then(u=>{s&&s({response:u,projectId:t,value:l})}).catch(u=>{r(c),o&&o(u)})}return e.jsx(pi,{value:n,onChange:i})}mi.propTypes={projectId:W.string,onSuccess:W.func,onError:W.func};function fi({baseUrl:t,steps:s,...o}){return e.jsx(Ol,{steps:s.map(n=>({...n,image:n.image?`${t}${n.image}`:null,actions:n.actions})),...o})}fi.propTypes={steps:W.arrayOf(W.shape({title:W.node,text:W.node,image:W.node,layout:W.string})),baseUrl:W.string};const _f=()=>null;function hi({url:t,...s}){const[o,n]=p.useState(null);return p.useEffect(()=>{function r(){fetch(t).then(a=>a.json()).then(a=>n(a)).catch(a=>{_e.error("Error when loading configuration data:",a)})}r()},[t]),o?e.jsx(Xt,{fallback:_f,children:e.jsx(fi,{active:!0,steps:o.steps,url:t,...s})}):null}hi.propTypes={url:W.string};const Po=F({title:{id:"ftrack-spark-components.set-thumbnail-dialog.title",defaultMessage:"Set thumbnail for {entityName}"},"remove-button":{id:"ftrack-spark-components.set-thumbnail-dialog.remove-button",defaultMessage:"Remove image"},"info-text":{id:"ftrack-spark-components.set-thumbnail-dialog.info-text",defaultMessage:"You can also drop the image you want to use as a thumbnail in the top section of the sidebar"}});function gi({entityId:t,entityType:s,onClose:o,onError:n,open:r}){const a=[...$s[s].labelProjection,...$s[s].thumbnailProjection],{isLoading:i,data:l}=Vt({entityType:s,entityId:t,projection:a,onError:n,name:"set-thumbnail-dialog"}),c=l&&$s[s].formatter(l),u=l?.thumbnail_id,d=l?.thumbnail_source_id?l?.thumbnail_source_id===t:!0,{mutate:m,isLoading:h}=st({entityType:s,entityId:t,projection:a,optimisticallyMutate:!1,onError:n});return e.jsxs(We,{open:r,onClose:o,maxWidth:!1,PaperProps:{sx:{width:"448px",height:"328px",pt:1}},children:[e.jsx(zl,{sx:{fontSize:"h4",fontWeight:"fontWeightRegular",marginRight:2,paddingBottom:0},children:c?e.jsx(x,{...Po.title,values:{entityName:c}}):e.jsx(ys,{width:210})}),o?e.jsx(ie,{onClick:()=>o(),sx:{position:"absolute",right:"16px",top:"16px"},children:e.jsx(nn,{})}):null,e.jsx(U,{onClick:()=>m({thumbnail_id:null}),variant:"text",disabled:!d||!u,sx:{fontSize:"fontSizeSmall",marginLeft:2,alignSelf:"self-start"},children:e.jsx(x,{...Po["remove-button"]})}),e.jsx(Fl,{onUploadError:n,loading:h||i,onChange:f=>{m({thumbnail_id:f}),ye("sidebar-updated-thumbnail-through-dialog")},value:d?u:void 0,infoMessage:e.jsx(x,{...Po["info-text"]})})]})}gi.propTypes={entityId:W.string.isRequired,entityType:W.string.isRequired,onClose:W.func,open:W.bool,onError:W.func};function yn(t,s=null){const o=p.lazy(t);return r=>e.jsx(p.Suspense,{fallback:s,children:e.jsx(o,{...r})})}const If=rn(yn(()=>$e(()=>import("../my_tasks_scheduler-D0XFZDgi.js"),__vite__mapDeps([28,1,2,8,9,29,16,18,13]),import.meta.url)));rn(yn(()=>$e(()=>import("../project_scheduler-BaQrButZ.js"),__vite__mapDeps([11,1,2,3,8,9,12,13]),import.meta.url)));rn(yn(()=>$e(()=>import("../user_scheduler-YiWjA8Zy.js"),__vite__mapDeps([14,1,2,3,8,9,12]),import.meta.url)));const Ao=F({total:{id:"ftrack-spark-components.insights.tasks",description:"Total task count",defaultMessage:"Tasks"},"not-started":{id:"ftrack-spark-components.insights.not-started",description:"Not started task count",defaultMessage:"Not started"},"in-progress":{id:"ftrack-spark-components.insights.in-progress",description:"In progress task count",defaultMessage:"In progress"}}),Cf={"&.MuiStack-root":{height:50,alignItems:"end",py:.5,"& .outerContainer":{minWidth:100,display:"flex",justifyContent:"center"},"& .innerContainer":{width:"max-content",textAlign:"center",height:40,justifyContent:"center",display:"flex",flexDirection:"column",span:{fontSize:"fontSizeSmall",fontWeight:"fontWeightThin",color:"text.secondary"}},"& .MuiSkeleton-root":{width:"100%"},"& .MuiTypography-root":{fontSize:"2rem",fontWeight:"fontWeightMedium",lineHeight:"1.6rem"}}},Mf=t=>e.jsx($l,{children:e.jsx(Tf,{...t})}),Tf=({resourceId:t})=>{const{data:s}=Jo({});let o=`assignments.resource_id is ${t}`;const n=[];if(s)for(const d of s)d?.state?.short==="BLOCKED"&&n.push(`"${d?.id}"`);if(n.length){const d=`select id from TypedContext where status_id in (${n.join(",")})`;o+=` and (not ancestors.id in (${d})) and project.status is "active"`}const{data:r,isLoading:a}=ve({name:"my-tasks-insights",projection:["count(id)"],entityType:"Task",groupBy:"status_id",filter:o,enabled:!!s?.length,invalidateOnUpdates:!1}),i={};function l(d){for(const m of s||[])if(m.id===d)return m.state?.short}if(r&&s)for(const d of r){const m=l(d.status_id);i[m]=(i[m]||0)+d.count_id}const c=["TOTAL","NOT_STARTED","IN_PROGRESS"];function u(d){return d==="NOT_STARTED"?e.jsx(x,{...Ao["not-started"]}):d==="IN_PROGRESS"?e.jsx(x,{...Ao["in-progress"]}):e.jsx(x,{...Ao.total})}return e.jsxs(ae,{direction:"row",divider:e.jsx(je,{orientation:"vertical",flexItem:!0}),sx:Cf,children:[c.map(d=>{const m=u(d);return e.jsx("span",{className:"outerContainer",children:e.jsxs("div",{className:"innerContainer",children:[a?e.jsx(ys,{height:16,sx:{margin:"0 auto"},"data-testid":"skeleton"}):e.jsx(Ef,{statusTypes:i,statusFilter:d}),m]})},d.toLowerCase())}),e.jsx(je,{orientation:"vertical",flexItem:!0})]})},Ef=({statusTypes:t,statusFilter:s})=>{function o(){if(s==="TOTAL"){let r=0;for(const a in t){const i=a!=="DONE"&&a!=="BLOCKED"?t[a]:0;r=r+i}return r||"-"}else return t[s]||"-"}const n=o();return e.jsx(M,{component:"h2",children:n})};function As({value:t=!1,onChange:s,label:o,description:n,help:r=null,name:a,sx:i}){return e.jsx(gt,{control:e.jsx(lo,{color:"primary",onChange:(l,c)=>s(a,c),checked:t,edge:"end"}),sx:{justifyContent:"space-between",width:"100%",ml:0,alignItems:"flex-start",...i},label:e.jsxs(C,{sx:{flex:1},children:[e.jsxs(vs,{sx:{color:"text.primary"},children:[o,r?e.jsx(Z,{title:r,children:e.jsx(sa,{fontSize:"inherit",sx:{mb:-.25,ml:.5,color:"text.secondary"}})}):null]}),e.jsx(uo,{children:n})]}),labelPlacement:"start"})}function Rf({onChange:t,label:s,description:o,name:n,value:r}){return e.jsxs(C,{children:[e.jsx(vs,{sx:{color:"text.primary"},children:s}),e.jsx(uo,{sx:{mb:1},children:o}),e.jsx(It,{entityType:"Status",isMultiple:!0,onChange:a=>t(n,a?.map(i=>i.id)),initialValue:r})]})}function Pf({config:t,onChange:s,onEditTaskColumns:o}){const n=p.useCallback((r,a)=>{const i={...t,[r]:a};s(i)},[s,t]);return e.jsxs(ae,{spacing:4,sx:{margin:2,maxWidth:"660px"},children:[e.jsxs(C,{children:[e.jsx(vs,{sx:{color:"text.primary"},children:e.jsx(x,{defaultMessage:"My tasks columns",id:"QTYG4D"})}),e.jsx(U,{sx:{float:"right"},color:"primary",onClick:o,children:e.jsx(x,{defaultMessage:"Edit",id:"wEQDC6"})}),e.jsx(uo,{children:e.jsx(x,{defaultMessage:"Open dialog to edit what columns are available on 'My tasks'",id:"bqfxZW"})})]}),e.jsx(je,{}),e.jsx(As,{label:e.jsx(x,{defaultMessage:"Available tasks",id:"MWCkCQ"}),description:e.jsx(x,{defaultMessage:"Allow users to assign tasks to themselves from 'My tasks > Available tasks'.",id:"+S/xf5"}),value:t.availableTasks,name:"availableTasks",onChange:n}),t.availableTasks?e.jsxs(e.Fragment,{children:[e.jsx(As,{label:e.jsx(x,{defaultMessage:"Project team",id:"Tb4ijW"}),description:e.jsx(x,{defaultMessage:"Limit tasks to projects where the user is a member of the team.",id:"ORspVs"}),help:e.jsx(x,{defaultMessage:"Go to Team->Organise team in your project to add members to the team.",id:"CQHDkg"}),value:t.projectTeam,name:"projectTeam",onChange:n}),e.jsx(As,{label:e.jsx(x,{defaultMessage:"Group assignments",id:"8j4a07"}),description:e.jsx(x,{defaultMessage:"Limit tasks based on if the user is a member of an assigned group.",id:"t9fTeL"}),help:e.jsx(x,{defaultMessage:"Group assignments are done by assigning a group of users to one of the tasks parents such as a Shot or Folder.",id:"QQPcdf"}),value:t.groupAssignments,name:"groupAssignments",onChange:n}),e.jsx(As,{label:e.jsx(x,{defaultMessage:"User skills based on task types",id:"jF98eq"}),description:e.jsx(x,{defaultMessage:"Limit tasks based on the task types that the user is associated with.",id:"UUFI/Z"}),help:e.jsx(x,{defaultMessage:"Go to Resources->Users & groups to associate a task type with a user.",id:"tOnvMs"}),value:t.userSkills,name:"userSkills",onChange:n}),e.jsx(Rf,{label:e.jsx(x,{defaultMessage:"Selected statuses",id:"+nmfxL"}),description:e.jsx(x,{defaultMessage:"By default tasks with a status corresponding to 'Not started' will be available.",id:"Yaklt6"}),name:"selectedStatuses",value:t.selectedStatuses,onChange:n})]}):null]})}function Af({onEditTaskColumns:t}){const s=H(),[o,n]=p.useState(null);p.useEffect(()=>{s.query("select value from Setting where group is DEFAULT and name is my_tasks_available_tasks").then(a=>{a.data.length&&a.data[0].value?n(JSON.parse(a.data[0].value)):n({availableTasks:!1,projectTeam:!1,groupAssignments:!1,userSkills:!1,selectedStatuses:[]})})},[s,n]);const r=p.useCallback(a=>{const i={name:"my_tasks_available_tasks",group:"DEFAULT",value:JSON.stringify(a)};s.ensure("Setting",i,["name","group"]),n(a)},[n,s]);return o===null?null:e.jsx(Pf,{config:o,onChange:r,onEditTaskColumns:t})}const xi=p.createContext();function Lf(t){return Te("MuiTable",t)}Ee("MuiTable",["root","stickyHeader"]);const Df=t=>{const{classes:s,stickyHeader:o}=t;return Re({root:["root",o&&"stickyHeader"]},Lf,s)},Of=le("table",{name:"MuiTable",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,o.stickyHeader&&s.stickyHeader]}})(ht(({theme:t})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...t.typography.body2,padding:t.spacing(2),color:(t.vars||t).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:s})=>s.stickyHeader,style:{borderCollapse:"separate"}}]}))),mr="table",jn=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiTable"}),{className:r,component:a=mr,padding:i="normal",size:l="medium",stickyHeader:c=!1,...u}=n,d={...n,component:a,padding:i,size:l,stickyHeader:c},m=Df(d),h=p.useMemo(()=>({padding:i,size:l,stickyHeader:c}),[i,l,c]);return e.jsx(xi.Provider,{value:h,children:e.jsx(Of,{as:a,role:a===mr?null:"table",ref:o,className:ue(m.root,r),ownerState:d,...u})})}),go=p.createContext();function zf(t){return Te("MuiTableBody",t)}Ee("MuiTableBody",["root"]);const Ff=t=>{const{classes:s}=t;return Re({root:["root"]},zf,s)},$f=le("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),Nf={variant:"body"},fr="tbody",kn=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiTableBody"}),{className:r,component:a=fr,...i}=n,l={...n,component:a},c=Ff(l);return e.jsx(go.Provider,{value:Nf,children:e.jsx($f,{className:ue(c.root,r),as:a,ref:o,role:a===fr?null:"rowgroup",ownerState:l,...i})})});function Wf(t){return Te("MuiTableCell",t)}const Bf=Ee("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),Vf=t=>{const{classes:s,variant:o,align:n,padding:r,size:a,stickyHeader:i}=t,l={root:["root",o,i&&"stickyHeader",n!=="inherit"&&`align${Jt(n)}`,r!=="normal"&&`padding${Jt(r)}`,`size${Jt(a)}`]};return Re(l,Wf,s)},Uf=le("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,s[o.variant],s[`size${Jt(o.size)}`],o.padding!=="normal"&&s[`padding${Jt(o.padding)}`],o.align!=="inherit"&&s[`align${Jt(o.align)}`],o.stickyHeader&&s.stickyHeader]}})(ht(({theme:t})=>({...t.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:t.vars?`1px solid ${t.vars.palette.TableCell.border}`:`1px solid
    ${t.palette.mode==="light"?t.lighten(t.alpha(t.palette.divider,1),.88):t.darken(t.alpha(t.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(t.vars||t).palette.text.primary,lineHeight:t.typography.pxToRem(24),fontWeight:t.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(t.vars||t).palette.text.primary}},{props:{variant:"footer"},style:{color:(t.vars||t).palette.text.secondary,lineHeight:t.typography.pxToRem(21),fontSize:t.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${Bf.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:s})=>s.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(t.vars||t).palette.background.default}}]}))),re=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiTableCell"}),{align:r="inherit",className:a,component:i,padding:l,scope:c,size:u,sortDirection:d,variant:m,...h}=n,f=p.useContext(xi),b=p.useContext(go),g=b&&b.variant==="head";let y;i?y=i:y=g?"th":"td";let j=c;y==="td"?j=void 0:!j&&g&&(j="col");const w=m||b&&b.variant,v={...n,align:r,component:y,padding:l||(f&&f.padding?f.padding:"normal"),size:u||(f&&f.size?f.size:"medium"),sortDirection:d,stickyHeader:w==="head"&&f&&f.stickyHeader,variant:w},I=Vf(v);let E=null;return d&&(E=d==="asc"?"ascending":"descending"),e.jsx(Uf,{as:y,ref:o,className:ue(I.root,a),"aria-sort":E,scope:j,ownerState:v,...h})});function Hf(t){return Te("MuiTableContainer",t)}Ee("MuiTableContainer",["root"]);const qf=t=>{const{classes:s}=t;return Re({root:["root"]},Hf,s)},Gf=le("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),wn=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiTableContainer"}),{className:r,component:a="div",...i}=n,l={...n,component:a},c=qf(l);return e.jsx(Gf,{ref:o,as:a,className:ue(c.root,r),ownerState:l,...i})});function Kf(t){return Te("MuiTableHead",t)}Ee("MuiTableHead",["root"]);const Yf=t=>{const{classes:s}=t;return Re({root:["root"]},Kf,s)},Jf=le("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),Qf={variant:"head"},hr="thead",vn=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiTableHead"}),{className:r,component:a=hr,...i}=n,l={...n,component:a},c=Yf(l);return e.jsx(go.Provider,{value:Qf,children:e.jsx(Jf,{as:a,className:ue(c.root,r),ref:o,role:a===hr?null:"rowgroup",ownerState:l,...i})})});function Xf(t){return Te("MuiTableRow",t)}const gr=Ee("MuiTableRow",["root","selected","hover","head","footer"]),Zf=t=>{const{classes:s,selected:o,hover:n,head:r,footer:a}=t;return Re({root:["root",o&&"selected",n&&"hover",r&&"head",a&&"footer"]},Xf,s)},eh=le("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,o.head&&s.head,o.footer&&s.footer]}})(ht(({theme:t})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${gr.hover}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${gr.selected}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity),"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`)}}}))),xr="tr",vt=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiTableRow"}),{className:r,component:a=xr,hover:i=!1,selected:l=!1,...c}=n,u=p.useContext(go),d={...n,component:a,hover:i,selected:l,head:u&&u.variant==="head",footer:u&&u.variant==="footer"},m=Zf(d);return e.jsx(eh,{as:a,ref:o,className:ue(m.root,r),role:a===xr?null:"row",ownerState:d,...c})}),bi=J(e.jsx("path",{d:"M16 9v10H8V9zm-1.5-6h-5l-1 1H5v2h14V4h-3.5zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2z"})),Sn=J(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),Ls=F({ip:{id:"ftrack-spark-components.ip-allow-list-table-row.ip",defaultMessage:"IP address"},description:{id:"ftrack-spark-components.ip-allow-list-table-row.description",defaultMessage:"Description"},edit:{id:"ftrack-spark-components.ip-allow-list-table-row.edit",defaultMessage:"Edit"},delete:{id:"ftrack-spark-components.ip-allow-list-table-row.delete",defaultMessage:"Delete"},more:{id:"ftrack-spark-components.ip-allow-list-table-row.more",defaultMessage:"More"},disabled:{id:"ftrack-spark-components.ip-allow-list-table-row.disabled",defaultMessage:"You cannot remove your own IP address."}});function th({ip:t,index:s,onEdit:o,onRemove:n}){const{ipAddress:r,description:a}=t;return e.jsxs(vt,{children:[e.jsx(re,{children:e.jsx(Z,{title:r,children:e.jsx(M,{sx:{overflow:"hidden",textOverflow:"ellipsis"},children:r})})}),e.jsx(re,{colSpan:2,children:e.jsx(M,{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a})}),e.jsx(re,{align:"right",children:e.jsxs(en,{button:e.jsx(Z,{title:e.jsx(x,{...Ls.more}),children:e.jsx(ie,{children:e.jsx(Sn,{})})}),children:[o&&e.jsxs(tt,{onClick:()=>{o?.(s)},children:[e.jsx(Le,{children:e.jsx(co,{})}),e.jsx(we,{primary:e.jsx(x,{...Ls.edit})})]}),e.jsx(Z,{title:n?"":e.jsx(x,{...Ls.disabled}),children:e.jsx("div",{children:e.jsxs(tt,{onClick:()=>n?.(s),disabled:!n,children:[e.jsx(Le,{children:e.jsx(bi,{})}),e.jsx(we,{primary:e.jsx(x,{...Ls.delete})})]})})})]})})]})}const br=F({ip:{id:"ftrack-spark-components.ip-allow-list-table.ip",defaultMessage:"IP address"},description:{id:"ftrack-spark-components.ip-allow-list-table.description",defaultMessage:"Description"}});function sh({ips:t,onRemove:s,onEdit:o,isEnabled:n}){const a=H()?.serverInformation?.client_ip,i=t.map(({ipAddress:l,description:c},u)=>e.jsx(th,{ip:{ipAddress:l,description:c},onEdit:d=>o(d),onRemove:a===l?void 0:d=>s(d),index:u},l));return e.jsx(wn,{sx:{maxHeight:"80%",borderRadius:1,boxShadow:({palette:l})=>`0 0 0 1px ${l.divider}`,"& .MuiTableCell-root:not(:last-child)":{color:n?"text.primary":"text.disabled"}},children:e.jsxs(jn,{stickyHeader:!0,sx:{tableLayout:"fixed",minWidth:450},children:[e.jsx(vn,{sx:{"& .MuiTableCell-root":{fontSize:"fontSizeRegular",bgcolor:"background.raised",lineHeight:"2px",textWrap:"nowrap"}},children:e.jsxs(vt,{children:[e.jsx(re,{children:e.jsx(x,{...br.ip})}),e.jsx(re,{colSpan:2,children:e.jsx(x,{...br.description})}),e.jsx(re,{})]})}),e.jsx(kn,{sx:{"& .MuiTableCell-root":{fontSize:"fontSizeSmall"}},children:i})]})})}const oh=J(e.jsx("path",{d:"M18.92 12c.04.33.08.66.08 1 0 2.08-.8 3.97-2.1 5.39-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H7v-2h2c.55 0 1-.45 1-1V8h2c1.1 0 2-.9 2-2V3.46c-.95-.3-1.95-.46-3-.46C5.48 3 1 7.48 1 13s4.48 10 10 10 10-4.48 10-10c0-.34-.02-.67-.05-1zM10 20.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L8 16v1c0 1.1.9 2 2 2zM22 4v-.5C22 2.12 20.88 1 19.5 1S17 2.12 17 3.5V4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h5c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1m-1 0h-3v-.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5z"})),Ds=F({heading:{id:"ftrack-spark-components.ip-allow-list-enterprise.heading",defaultMessage:"Limit access to specific IP addresses"},description:{id:"ftrack-spark-components.ip-allow-list-enterprise.description",defaultMessage:"IP allow list provides enhanced security by limiting access to specific IP addresses. Upgrade to Enterprise to unlock IP allow list."},"contact-sales":{id:"ftrack-spark-components.ip-allow-list-enterprise.contact-sales",defaultMessage:"Contact Sales"},"learn-more":{id:"ftrack-spark-components.ip-allow-list-enterprise.learn-more",defaultMessage:"Learn more about IP allow list"}});function nh(){return e.jsxs(ae,{spacing:4,sx:{alignItems:"center",minHeight:"100%",justifyContent:"center","&.MuiStack-root a.MuiButtonBase-root:hover":{textDecoration:"none"},"&.MuiStack-root a.MuiButtonBase-root":{color:"primary.main"}},children:[e.jsx(oh,{sx:{fontSize:128,color:"blue.main"}}),e.jsxs(C,{sx:{textAlign:"center"},children:[e.jsx(M,{variant:"h3",children:e.jsx(x,{...Ds.heading})}),e.jsx(M,{sx:{color:"text.secondary"},children:e.jsx(x,{...Ds.description})})]}),e.jsx(U,{href:"mailto:sales@ftrack.com",variant:"outlined",color:"primary",sx:{borderRadius:32},children:e.jsx(x,{...Ds["contact-sales"]})}),e.jsx(M,{children:e.jsx(es,{href:"https://help.ftrack-studio.backlight.co",target:"_blank",sx:{color:"blue.main"},children:e.jsx(x,{...Ds["learn-more"]})})})]})}const Rt=F({"ip-label":{id:"ftrack-spark-components.ip-allow-dialog-form.ip-label",defaultMessage:"IP address"},"ip-description":{id:"ftrack-spark-components.ip-allow-dialog-form.ip-description",defaultMessage:"Description"},cancel:{id:"ftrack-spark-components.ip-allow-dialog-form.cancel",defaultMessage:"Cancel"},save:{id:"ftrack-spark-components.ip-allow-dialog-form.save",defaultMessage:"Save"},"save-changes":{id:"ftrack-spark-components.ip-allow-dialog-form.save-changes",defaultMessage:"Save changes"},"max-character-limit":{id:"ftrack-spark-components.ip-allow-dialog-form.max-character-limit",defaultMessage:"{fieldName} can only be up to {limit} characters."},"invalid-ip-address":{id:"ftrack-spark-components.ip-allow-dialog-form.invalid-ip-address",defaultMessage:"Please enter a valid IP address."}}),yr=128,rh=/^(([a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}|([a-fA-F0-9]{1,4}:){1,7}:|([a-fA-F0-9]{1,4}:){1,6}:[a-fA-F0-9]{1,4}|([a-fA-F0-9]{1,4}:){1,5}(:[a-fA-F0-9]{1,4}){1,2}|([a-fA-F0-9]{1,4}:){1,4}(:[a-fA-F0-9]{1,4}){1,3}|([a-fA-F0-9]{1,4}:){1,3}(:[a-fA-F0-9]{1,4}){1,4}|([a-fA-F0-9]{1,4}:){1,2}(:[a-fA-F0-9]{1,4}){1,5}|[a-fA-F0-9]{1,4}:((:[a-fA-F0-9]{1,4}){1,6})|:((:[a-fA-F0-9]{1,4}){1,7}|:))(\/(12[0-8]|1[01][0-9]|[1-9]?[0-9]))?$/,ah=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\/([0-9]|[1-2][0-9]|3[0-2]))?$/;function ih({onSubmit:t,defaultValues:s,onValidation:o,currentIP:n}){const{setConfirmClose:r,handleCancel:a}=ao(),i=oe(),{control:l,handleSubmit:c,formState:{isDirty:u}}=Ut({defaultValues:s});r(u);const d=m=>{t(m)};return e.jsxs("form",{onSubmit:c(d),children:[e.jsx(Be,{sx:{mb:2},children:e.jsxs(ae,{spacing:2,sx:{py:1},children:[e.jsx(Me,{label:e.jsx(x,{...Rt["ip-label"]}),name:"ipAddress",required:!0,pattern:{value:new RegExp(ah.source+"|"+rh.source),message:i.formatMessage(Rt["invalid-ip-address"])},validate:o,variant:"outlined",autoFocus:!0,helperText:"",size:"small",control:l,defaultValue:s?.ipAddress??"",disabled:s?.ipAddress?s.ipAddress===n:!1}),e.jsx(Me,{label:e.jsx(x,{...Rt["ip-description"]}),name:"description",maxLength:{value:yr,message:i.formatMessage(Rt["max-character-limit"],{fieldName:i.formatMessage(Rt["ip-description"]),limit:yr})},variant:"outlined",size:"small",control:l,defaultValue:s?.description??""})]})}),e.jsxs(Ve,{children:[e.jsx(U,{color:"neutral",onClick:()=>{a()},children:e.jsx(x,{...Rt.cancel})}),e.jsx(U,{type:"submit",children:e.jsx(x,{...Rt[s?.ipAddress?"save-changes":"save"]})})]})]})}const lh=F({add:{id:"ftrack-spark-components.ip-allow-list-add-dialog.add",defaultMessage:"Add IP address"},edit:{id:"ftrack-spark-components.ip-allow-list-edit-dialog.edit",defaultMessage:"Edit IP address"}}),jr=({onCancel:t,defaultValues:s,...o})=>e.jsxs(ro,{open:!0,onCancel:t,PaperProps:{sx:{minWidth:"480px"}},children:[e.jsx(Oe,{children:e.jsx(x,{...lh[s?.ipAddress?"edit":"add"]})}),e.jsx(ih,{defaultValues:s,...o})]}),ch=({className:t,onChange:s,label:o,name:n,value:r,description:a,help:i,sx:l,moreInfo:c,labelClassName:u,descriptionClassName:d,disabled:m,color:h})=>{const f=o&&a,b={title:{color:"text.primary",fontWeight:"fontWeightMedium",fontSize:"fontSizeRegular",display:"flex",alignItems:"center"},description:{color:m?"action.disabled":"text.secondary",fontWeight:"fontWeightMedium",fontSize:"fontSizeSmall"}};return e.jsxs(C,{className:t,children:[e.jsx(gt,{disabled:m,sx:{flexDirection:"row-reverse",pl:1.4,display:"flex",mb:-1,mr:-1,"&>.MuiTypography-root":{flexGrow:2},...l},control:e.jsx(lo,{name:n,checked:r,onChange:g=>s(g.target.checked),sx:{bottom:f?"1rem":void 0},color:h}),label:e.jsxs(ae,{sx:{"&:hover .MuiSvgIcon-root":{opacity:.5}},children:[e.jsxs(M,{className:u,sx:f?b.title:b.description,children:[o,i?e.jsx(oa,{text:i}):null]}),e.jsx(M,{sx:b.description,className:d,children:a})]})}),c&&e.jsx(M,{sx:{mt:3,...b.description},className:d,children:c})]})},dt=F({header:{id:"ftrack-spark-components.ip-allow-list.header",defaultMessage:"IP allow list"},description:{id:"ftrack-spark-components.ip-allow-list.description",defaultMessage:"Once enabled, only the IP addresses listed below will be able to access the workspace."},help:{id:"ftrack-spark-components.ip-allow-list.help",defaultMessage:"Enterprise feature to allow restricted access."},add:{id:"ftrack-spark-components.ip-allow-list.add",defaultMessage:"Add IP address"},"current-ip":{id:"ftrack-spark-components.ip-allow-list.current-ip",defaultMessage:"IP for {email}"},"duplicate-ip-error":{id:"ftrack-spark-components.ip-allow-list.duplicate-ip-error",defaultMessage:"IP address already exists in the list."},"delete-dialog-title":{id:"ftrack-spark-components.ip-allow-list.delete-dialog-title",defaultMessage:"Confirm delete?"},"remove-info":{id:"ftrack-spark-components.ip-allow-list.remove-info",defaultMessage:"You are about the remove <warning>{ipAddress}</warning> from the list of allowed ip addresses. ftrack will no longer be available from this IP."}});function dh(){const[t,s]=p.useState(!1),[o,n]=p.useState({index:null,mode:null}),r=H(),a=oe(),{FT:i}=de(),l=r.serverInformation?.client_ip,c=p.useMemo(()=>({ipAddress:l,description:a.formatMessage(dt["current-ip"],{email:r.apiUser})}),[l,a,r.apiUser]),{data:u=[],isLoading:d,refetch:m}=ve({entityType:"Setting",name:"ip-allow-list-enable",projection:["value"],filter:"group is 'SECURITY' and name is 'server_ip_allow_list_enabled'",limit:1}),{data:h=[],isLoading:f,refetch:b}=ve({entityType:"Setting",name:"ip-allow-list-ranges",projection:["value"],filter:"group is 'SECURITY' and name is 'server_ip_allow_list_ranges'",limit:1}),g=d||f,y=p.useMemo(()=>{let k=!1;if(u?.[0]?.value&&!g)try{k=JSON.parse(u[0].value)}catch{}return k},[u,g]),j=p.useMemo(()=>{if(h?.[0]?.value&&!g){let k=[];try{k=JSON.parse(h?.[0].value?.replaceAll("ip_address","ipAddress"))}catch{}return k?.some(S=>S.ipAddress===l)?k:[c,...k]}else return[c]},[l,h,g,c]),w=p.useCallback(async k=>{const S={name:"server_ip_allow_list_ranges",group:"SECURITY",value:JSON.stringify(k)?.replaceAll("ipAddress","ip_address")};await r.ensure("Setting",S,["name","group"]).catch(A=>i.notifyError(A.message)),b()},[r,b,i]),v=p.useCallback(async k=>{const S=[...j,k];await w(S),s(!1)},[w,j,s]),I=p.useCallback(async k=>{if(o.index!==null){const S=[...j];S[o.index]=k,await w(S)}n({index:null,mode:null})},[w,j,n,o.index]),E=p.useCallback(async k=>{h?.[0]?.value?.includes(l)||await w(j);const S={name:"server_ip_allow_list_enabled",group:"SECURITY",value:JSON.stringify(k)};await r.ensure("Setting",S,["name","group"]).catch(A=>i.notifyError(A.message)),m()},[r,m,h,j,w,i,l]),L=p.useCallback(async()=>{const k=j.filter((S,A)=>A!==o.index);await w(k),n({index:null,mode:null})},[w,n,j,o.index]);if(!r.serverInformation?.license?.some(k=>k.feature_id==="ftrack-enterprise"))return e.jsx(nh,{});const _=k=>{if(j?.some(S=>S.ipAddress===k))return a.formatMessage(dt["duplicate-ip-error"])},R=k=>{if(o.index!==null){const S=j?.find(P=>P.ipAddress===k);if(j[o.index].ipAddress!==k&&S)return a.formatMessage(dt["duplicate-ip-error"])}};return!g&&e.jsxs(ae,{spacing:1,sx:{margin:2,maxWidth:"660px",height:"100%"},children:[t?e.jsx(jr,{onSubmit:v,onCancel:()=>s(!1),onValidation:_}):null,o.mode==="edit"&&o.index!==null?e.jsx(jr,{onSubmit:I,onCancel:()=>n({index:null,mode:null}),defaultValues:j[o.index],onValidation:R,currentIP:l}):null,e.jsx(Nl,{open:o.mode==="delete"&&o.index!==null,title:e.jsx(x,{...dt["delete-dialog-title"]}),description:e.jsx(x,{...dt["remove-info"],values:{warning:k=>e.jsx(C,{component:"span",sx:{color:"text.primary",fontWeight:"fontWeightMedium"},children:k}),ipAddress:o?.index?j[o?.index].ipAddress:""}}),onDelete:L,onCancel:()=>n({index:null,mode:null})}),e.jsx(ch,{label:a.formatMessage(dt.header),description:a.formatMessage(dt.description),help:a.formatMessage(dt.help),value:y,name:"enableIpAllowList",onChange:E,sx:{mb:1}}),e.jsx(C,{sx:{display:"flex",justifyContent:"right"},children:e.jsx(U,{onClick:()=>s(!0),variant:"outlined",children:e.jsx(x,{...dt.add})})}),e.jsx(sh,{ips:j,onRemove:k=>n({index:k,mode:"delete"}),onEdit:k=>n({index:k,mode:"edit"}),isEnabled:y})]})}const uh=J(e.jsx("path",{d:"M10 15h5.88c.27-.31.67-.5 1.12-.5.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5c-.44 0-.84-.19-1.12-.5H11.9c-.46 2.28-2.48 4-4.9 4-2.76 0-5-2.24-5-5 0-2.42 1.72-4.44 4-4.9v2.07c-1.16.41-2 1.53-2 2.83 0 1.65 1.35 3 3 3s3-1.35 3-3zm2.5-11c1.65 0 3 1.35 3 3h2c0-2.76-2.24-5-5-5s-5 2.24-5 5c0 1.43.6 2.71 1.55 3.62l-2.35 3.9c-.68.14-1.2.75-1.2 1.48 0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5c0-.16-.02-.31-.07-.45l3.38-5.63C10.49 9.61 9.5 8.42 9.5 7c0-1.65 1.35-3 3-3m4.5 9c-.64 0-1.23.2-1.72.54l-3.05-5.07C11.53 8.35 11 7.74 11 7c0-.83.67-1.5 1.5-1.5S14 6.17 14 7c0 .15-.02.29-.06.43l2.19 3.65c.28-.05.57-.08.87-.08 2.76 0 5 2.24 5 5s-2.24 5-5 5c-1.85 0-3.47-1.01-4.33-2.5h2.67c.48.32 1.05.5 1.66.5 1.65 0 3-1.35 3-3s-1.35-3-3-3"})),Os=F({heading:{id:"ftrack-spark-components.webhooks-empty-state.heading",defaultMessage:"Listen to events from ftrack Studio"},description:{id:"ftrack-spark-components.webhooks-empty-state.description",defaultMessage:"Create webhooks to listen to events from ftrack Studio. Webhooks are triggered when an event occurs in ftrack Studio, for example when a task is created or updated."},"create-button":{id:"ftrack-spark-components.webhooks-empty-state.create-button",defaultMessage:"Create new webhook"},"learn-more":{id:"ftrack-spark-components.webhooks-empty-state.learn-more",defaultMessage:"Learn more about webhooks"}});function ph({onCreateClick:t}){return e.jsxs(ae,{spacing:4,sx:{alignItems:"center",minHeight:"100%",justifyContent:"center"},children:[e.jsx(uh,{sx:{fontSize:128,color:"blue.main"}}),e.jsxs(C,{sx:{textAlign:"center"},children:[e.jsx(M,{variant:"h3",children:e.jsx(x,{...Os.heading})}),e.jsx(M,{sx:{color:"text.secondary"},children:e.jsx(x,{...Os.description})})]}),e.jsx(U,{onClick:t,variant:"outlined",color:"primary",sx:{borderRadius:32},children:e.jsx(x,{...Os["create-button"]})}),e.jsx(M,{children:e.jsx(es,{href:"https://help.ftrack-studio.backlight.co",target:"_blank",sx:{color:"blue.main"},children:e.jsx(x,{...Os["learn-more"]})})})]})}const mh=J(e.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"})),zs=F({status:{id:"ftrack-spark-components.webhooks-logs-table.status",defaultMessage:"Status"},"created-at":{id:"ftrack-spark-components.webhooks-logs-table.created-at",defaultMessage:"Created at"},message:{id:"ftrack-spark-components.webhooks-logs-table.message",defaultMessage:"Message"},"no-records":{id:"ftrack-spark-components.webhooks-logs-table.no-records",defaultMessage:"No records found."}}),fh=({logEvent:t,scrollRef:s,isLoading:o})=>e.jsx(wn,{sx:{borderRadius:1,flexGrow:1,height:"100%",boxShadow:({palette:n})=>`inset 0 0 0 1px ${n.divider}`,"& .MuiTable-root":{height:!o&&t?.length===0?"100%":"auto"}},children:e.jsxs(jn,{stickyHeader:!0,children:[e.jsx(vn,{sx:{"& .MuiTableCell-root":{fontSize:"fontSizeRegular",bgcolor:"background.raised",lineHeight:"2px",textWrap:"nowrap"}},children:e.jsxs(vt,{children:[e.jsx(re,{width:1,align:"center",children:e.jsx(x,{...zs.status})}),e.jsx(re,{width:1,children:e.jsx(x,{...zs["created-at"]})}),e.jsx(re,{width:1,children:e.jsx(x,{...zs.message})})]})}),e.jsxs(kn,{sx:{"& .MuiTableCell-root":{fontSize:"fontSizeSmall"},"& .MuiTableRow-root:nth-of-type(even)":{backgroundColor:"action.hover"}},children:[o?e.jsx(vt,{sx:{"& .MuiTableCell-root":{border:"none"}},children:e.jsx(re,{colSpan:4,children:e.jsx(C,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:e.jsx(rt,{})})})}):null,t?.length?t?.map(n=>e.jsxs(vt,{children:[e.jsx(re,{children:e.jsx(M,{sx:{display:"flex",justifyContent:"center","& .MuiSvgIcon-root":{fontSize:"2.4rem",mr:.5,color:n.status==="success"?"success.main":"error.main"}},children:e.jsx(Z,{title:n.status,children:n.status==="success"?e.jsx(ea,{}):e.jsx(nn,{})})})}),e.jsx(re,{children:e.jsx(an,{date:n.created_at,showTime:!0})}),e.jsx(re,{children:e.jsx(M,{sx:{fontSize:"fontSizeRegular"},children:e.jsx("code",{children:n.message})})})]},n.id)):null,!o&&t?.length===0?e.jsx(vt,{sx:{"& .MuiTableCell-root":{border:"none"}},children:e.jsx(re,{colSpan:4,children:e.jsxs(C,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[e.jsx(zr,{sx:{fontSize:"9.5rem",color:"text.secondary"}}),e.jsx(M,{children:e.jsx(x,{...zs["no-records"]})})]})})}):null,e.jsx(C,{id:"scroll-ref",sx:{height:"1px"},ref:s,component:"tr"})]})]})}),Pt=F({id:{id:"ftrack-spark-components.webhooks-logs.id",defaultMessage:"ID: {id}"},back:{id:"ftrack-spark-components.webhooks-logs.back",defaultMessage:"Back"},"created-at":{id:"ftrack-spark-components.webhooks-logs.created-at",defaultMessage:"Created at"},"created-by":{id:"ftrack-spark-components.webhooks-logs.created-by",defaultMessage:"Created by"},status:{id:"ftrack-spark-components.webhooks-logs.status",defaultMessage:"Status"},"edit-webhook":{id:"ftrack-spark-components.webhooks-logs.edit-webhook",defaultMessage:"Edit webhook"},refresh:{id:"ftrack-spark-components.webhooks-logs.refresh",defaultMessage:"Refresh logs"}}),hh=({handleBackNavigation:t,onEditClick:s,webhook:o})=>{const n=p.useRef(null),{data:r,isLoading:a,isFetchingNextPage:i,fetchNextPage:l,hasNextPage:c,isFetching:u,refetch:d}=ve({name:"webhooks-trigger-logs",entityType:"ActionLog",projection:["id","action_id","created_at","action","message","status"],filter:`action_id = '${o.id}'`,orderBy:"created_at desc",enabled:!!o.id}),{data:m,isLoading:h}=Vt({name:"webhooks-user",entityType:"BaseUser",entityId:o.automation?.created_by,projection:["id","first_name","last_name"],enabled:!!o.automation?.created_by});return Xr(n,l,!c||u),e.jsxs(C,{sx:{px:2,border:"none",overflow:"hidden",position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(U,{sx:{color:"text.secondary",width:"max-content"},startIcon:e.jsx(Wl,{}),disableElevation:!0,disableFocusRipple:!0,disableRipple:!0,size:"medium",onClick:t,children:e.jsx(x,{...Pt.back})}),e.jsx(M,{variant:"h3",sx:{mt:2},children:o.automation?.name}),e.jsxs(C,{sx:{display:"flex",flexWrap:"wrap",flexDirection:{xs:"column",md:"row"},rowGap:2,alignItems:{xs:"flex-start",md:"flex-end"},justifyContent:"space-between"},children:[e.jsxs(C,{sx:{maxWidth:"70%"},children:[e.jsxs(C,{sx:{display:"flex",mt:1,backgroundColor:"background.raised",borderRadius:1,maxWidth:"fit-content",alignItems:"center"},children:[e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeRegular",lineHeight:1,p:1,overflow:"hidden",textOverflow:"ellipsis"},children:e.jsx("code",{children:o.webhook_url})}),e.jsx(ie,{onClick:()=>{window.navigator.clipboard?.writeText(o.webhook_url??"")},children:e.jsx(An,{sx:{"&.MuiSvgIcon-root":{fontSize:"fontSizeRegular",float:"right"}}})})]}),e.jsxs(C,{sx:{display:"flex",mt:1,backgroundColor:"background.raised",borderRadius:1,width:"max-content"},children:[e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeRegular",lineHeight:1,p:1,overflow:"hidden",textOverflow:"ellipsis"},children:e.jsx("code",{children:e.jsx(x,{...Pt.id,values:{id:o.id}})})}),e.jsx(ie,{onClick:()=>{window.navigator.clipboard?.writeText(o.id??"")},children:e.jsx(An,{sx:{"&.MuiSvgIcon-root":{fontSize:"fontSizeRegular",float:"right"}}})})]})]}),e.jsxs(C,{sx:{display:"flex",flexWrap:"wrap",rowGap:2},children:[e.jsx(U,{variant:"outlined",startIcon:e.jsx(co,{}),onClick:()=>s(o),children:e.jsx(x,{...Pt["edit-webhook"]})}),e.jsx(U,{loading:i||a,loadingPosition:"start",variant:"outlined",startIcon:e.jsx(mh,{}),onClick:()=>d(),sx:{ml:2},children:e.jsx(x,{...Pt.refresh})})]})]}),e.jsxs(C,{sx:{display:"flex",justifyContent:"space-around",flexWrap:"wrap",fontSize:"fontSizeRegular",my:2,"& .MuiDivider-root":{mx:2},border:({palette:f})=>`1px solid ${f.divider}`,borderRadius:1,p:1},children:[e.jsx(Lo,{label:e.jsx(x,{...Pt.status}),chip:e.jsx(na,{iconColor:o.automation?.enabled?"success.main":"error.main",label:o.automation?.enabled?"Active":"Inactive",variant:"outlined"})}),e.jsx(je,{orientation:"vertical",flexItem:!0}),e.jsx(Lo,{label:e.jsx(x,{...Pt["created-by"]}),chip:h?e.jsx(De,{icon:e.jsx(ys,{variant:"circular",sx:{width:14,height:14}}),label:e.jsx(ys,{sx:{width:50}}),sx:{borderColor:"divider"}}):e.jsx(Bl,{editable:!1,resources:[m]})}),e.jsx(je,{orientation:"vertical",flexItem:!0}),e.jsx(Lo,{label:e.jsx(x,{...Pt["created-at"]}),chip:e.jsx(De,{iconColor:"primary.main",label:e.jsx(an,{date:o.automation?.created_at||"",showTime:!0}),icon:e.jsx(Vl,{}),sx:{"& .MuiChip-label":{maxWidth:"22ch"}}})})]}),e.jsx(fh,{logEvent:r,scrollRef:n,isLoading:i||a})]})},Lo=({label:t,chip:s})=>e.jsxs(ae,{sx:{alignItems:"center"},children:[e.jsx(M,{sx:{color:"text.secondary",fontSize:"fontSizeSmall",fontWeight:"fontWeightMedium"},children:t}),s]}),gh=J(e.jsx("path",{d:"M17 10h-3.61l2.28 2.28zm0-8H7v1.61l6.13 6.13zm-13.59.86L2 4.27l5 5V13h3v9l3.58-6.15L17.73 20l1.41-1.41z"})),xh=J(e.jsx("path",{d:"M7 2v11h3v9l7-12h-4l3-8z"})),yi=p.createContext({displayLogs:null,setDisplayLogs:()=>{}}),ji=()=>p.useContext(yi),jt=F({logs:{id:"ftrack-spark-components.webhooks-list.logs",defaultMessage:"Logs"},enable:{id:"ftrack-spark-components.webhooks-list.enable",defaultMessage:"Enable"},disable:{id:"ftrack-spark-components.webhooks-list.disable",defaultMessage:"Disable"},edit:{id:"ftrack-spark-components.webhooks-list.edit",defaultMessage:"Edit"},delete:{id:"ftrack-spark-components.webhooks-list.delete",defaultMessage:"Delete"},more:{id:"ftrack-spark-components.webhooks-list.more",defaultMessage:"More"},"logs-tooltip":{id:"ftrack-spark-components.webhooks-list.logs-tooltip",defaultMessage:"Click to view webhook logs"},"max-limit-tooltip":{id:"ftrack-spark-components.webhooks-list.max-limit-tooltip",defaultMessage:"Number of active webhooks has exceeded {max}. Disable some of existing webhooks to activate this webhook."}});function bh({enabled:t}){return e.jsx(na,{variant:"outlined",label:t?"Active":"Inactive",iconColor:t?"success.main":"error.main"})}const yh=({webhook:t,activeWebhookCount:s,totalAutomation:o,isLoading:n,onStatusChange:r,onDelete:a,onLogsClick:i,onEditClick:l})=>{const u=H().serverInformation?.max_automations??1/0,d=typeof s=="number"&&s>=u&&!t.automation?.enabled,{setDisplayLogs:m}=ji(),h=p.useCallback(({filters:j})=>{const w=[],v=[];let I=0;return j?.forEach((E,L)=>{if(E.includes("entity.entity_type")){const _=E.substring(E.indexOf('"')+1,E.indexOf('" and '));if(w[L]=`${_}`,v[L]="",E.includes('"create"')&&(v[L]+="Create",I+=1),E.includes("entity.new")){const R=E.substring(E.indexOf("entity.new.")+11,E.indexOf(" != "));v[L]+=`Update on (${R})`,I+=1}else E.includes("update")&&(v[L]+="Any updates",I+=1)}else if(E.includes("entity.new")){v[L]="";let _="";for(let k=L-1;k>=0;k--)if(j[k].includes("entity.entity_type")){_=j[k].substring(j[k].indexOf('"')+1,j[k].indexOf('" and '));break}const R=E.substring(E.indexOf("entity.new.")+11,E.indexOf(" != "));w[L]=`${_}`,v[L]+=`Update on (${R})`,I+=1}}),{webhookSchemaType:w,webhookEvents:v,webhookEventsCount:I}},[]);let f=[],b=[],g=[],y=0;if(t?.automation?.triggers){f=t.automation.triggers[0].filter?.replace(/[()]/g,"").split(" or ");const{webhookSchemaType:j,webhookEvents:w,webhookEventsCount:v}=h({filters:f});b=[...j],g=[...w],y=v}return e.jsxs(vt,{children:[e.jsxs(re,{colSpan:5,children:[e.jsx(M,{children:t.automation?.name}),e.jsx(M,{noWrap:!0,sx:{color:"text.secondary"},children:t.webhook_url})]}),e.jsx(re,{children:e.jsx(bh,{enabled:t.automation?.enabled})}),e.jsx(re,{colSpan:2,children:e.jsx(an,{date:t.automation?.created_at,showTime:!0})}),e.jsx(re,{colSpan:1,children:e.jsx(Z,{title:y>0?e.jsx(M,{component:"span",sx:{pr:1,display:"block",maxHeight:"400px",overflowY:"auto"},children:b.map((j,w)=>e.jsxs(M,{component:"span",sx:{fontSize:"fontSizeSmall"},children:[w===0||b[w-1]!==j?e.jsx(e.Fragment,{children:e.jsx(M,{sx:{fontSize:"fontSizeSmall",color:"light.dark"},children:j})}):null,e.jsx(M,{sx:{fontSize:"fontSizeSmall",color:"light.main"},children:g[w]}),b[w+1]!==j&&b[w+1]!==void 0?e.jsx("br",{}):null]},w))}):null,children:e.jsx(M,{component:"span",children:e.jsx(Dr,{sx:{backgroundColor:"primary.main"},children:e.jsx(M,{component:"span",sx:{fontSize:"fontSizeSmall",color:"background.default"},children:y})})})})}),e.jsx(re,{children:n?e.jsx(xt,{size:20,sx:{display:"flex",justifyContent:"flex-start"}}):e.jsx(M,{children:o})}),e.jsx(re,{children:e.jsx(Z,{title:e.jsx(x,{...jt["logs-tooltip"]}),children:e.jsx(U,{size:"small",color:"blue",onClick:()=>i(t),startIcon:e.jsx(ln,{}),children:e.jsx(x,{...jt.logs})})})}),e.jsx(re,{children:e.jsxs(en,{button:e.jsx(Z,{title:e.jsx(x,{...jt.more}),children:e.jsx(ie,{children:e.jsx(Sn,{})})}),children:[e.jsxs(tt,{onClick:()=>{l(t),m(null)},children:[e.jsx(Le,{children:e.jsx(co,{})}),e.jsx(we,{primary:e.jsx(x,{...jt.edit})})]}),e.jsx(Z,{title:d?e.jsx(x,{...jt["max-limit-tooltip"],values:{max:u}}):null,children:e.jsx("span",{children:e.jsxs(tt,{disabled:d,onClick:()=>r({id:t.automation?.id??"",enabled:!t.automation?.enabled}),children:[e.jsx(Le,{children:t.automation?.enabled?e.jsx(gh,{}):e.jsx(xh,{})}),e.jsx(we,{primary:t.automation?.enabled?e.jsx(x,{...jt.disable}):e.jsx(x,{...jt.enable})})]})})}),e.jsxs(tt,{onClick:()=>a(t.automation?.id),children:[e.jsx(Le,{children:e.jsx(bi,{})}),e.jsx(we,{primary:e.jsx(x,{...jt.delete})})]})]})})]},t.id)},Ye=F({webhooks:{id:"ftrack-spark-components.webhooks-list.webhooks",defaultMessage:"Webhooks"},"create-webhook-button":{id:"ftrack-spark-components.webhooks-list.create-webhook-button",defaultMessage:"Create webhook"},name:{id:"ftrack-spark-components.webhooks-list.name",defaultMessage:"Name"},logs:{id:"ftrack-spark-components.webhooks-list.logs",defaultMessage:"Logs"},status:{id:"ftrack-spark-components.webhooks-list.status",defaultMessage:"Status"},"created-at":{id:"ftrack-spark-components.webhooks-list.created-at",defaultMessage:"Created at"},events:{id:"ftrack-spark-components.webhooks-list.events",defaultMessage:"Events"},usage:{id:"ftrack-spark-components.webhooks-list.usage",defaultMessage:"Usage"},"usage-tooltip":{id:"ftrack-spark-components.webhooks-list.usage-tooltip",defaultMessage:"Number of triggered automations in the last {days} days"},"add-webhook":{id:"ftrack-spark-components.webhooks-list.add-webhook",defaultMessage:"Add webhook"},"learn-more":{id:"ftrack-spark-components.webhooks-list.learn-more",defaultMessage:"Learn more about webhooks in the <link>documentation</link>."}}),jh=({webhooks:t,onCreateClick:s,onLogsClick:o,onDelete:n,onStatusChange:r,onEditClick:a})=>{const i=t?.filter(y=>y.automation?.enabled)?.length,c=H().serverInformation?.automation_limit_days??1/0,u=p.useMemo(()=>K().tz().subtract(c,"day").toISOString(),[c]),m=`action_id in (${t.map(y=>`'${y.id}'`).join(",")}) and created_at > "${u}"`,{data:h,isLoading:f}=ve({name:"automation-action-count",entityType:"ActionLog",projection:["count(id)"],enabled:!!c,filter:m,groupBy:"action_id"}),b=h,g=p.useMemo(()=>t?.map(y=>{const j=b?.find(w=>w.action_id===y.id)?.count_id??0;return e.jsx(yh,{webhook:y,activeWebhookCount:i,totalAutomation:j,isLoading:f,onLogsClick:o,onStatusChange:r,onDelete:n,onEditClick:a},y.id)}),[b,i,f,n,a,o,r,t]);return e.jsxs(C,{sx:{position:"relative",p:1,overflow:"hidden"},children:[e.jsxs(C,{sx:{py:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(M,{variant:"h3",children:[e.jsx(x,{...Ye.webhooks}),e.jsx(M,{sx:{color:"text.secondary"},children:e.jsx(x,{...Ye["learn-more"],values:{link:y=>e.jsx(es,{target:"_blank",href:"https://developer.ftrack.com/extending-ftrack/webhooks",children:y})}})})]}),e.jsx(U,{onClick:s,variant:"outlined",startIcon:e.jsx(cn,{}),sx:{float:"right"},children:e.jsx(x,{...Ye["add-webhook"]})})]}),e.jsx(wn,{sx:{maxHeight:"80%",borderRadius:1,boxShadow:({palette:y})=>`0 0 0 1px ${y.divider}`},children:e.jsxs(jn,{stickyHeader:!0,sx:{tableLayout:"fixed",minWidth:450},children:[e.jsx(vn,{sx:{"& .MuiTableCell-root":{fontSize:"fontSizeRegular",bgcolor:"background.raised",lineHeight:"2px",textWrap:"nowrap"}},children:e.jsxs(vt,{children:[e.jsx(re,{colSpan:5,children:e.jsx(x,{...Ye.name})}),e.jsx(re,{children:e.jsx(x,{...Ye.status})}),e.jsx(re,{colSpan:2,children:e.jsx(x,{...Ye["created-at"]})}),e.jsx(re,{colSpan:1,children:e.jsx(x,{...Ye.events})}),e.jsx(re,{children:e.jsxs(C,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(x,{...Ye.usage}),e.jsx(Z,{title:e.jsx(x,{...Ye["usage-tooltip"],values:{days:c}}),children:e.jsx(M,{component:"span",sx:{color:"text.secondary"},children:e.jsx(sa,{fontSize:"xsmall",sx:{ml:.5}})})})]})}),e.jsx(re,{children:e.jsx(x,{...Ye.logs})}),e.jsx(re,{})]})}),e.jsx(kn,{sx:{"& .MuiTableCell-root":{fontSize:"fontSizeSmall"},"& .MuiTableRow-root:nth-of-type(even)":{backgroundColor:"action.hover"}},children:g})]})})]})};function kh({webhooks:t,onCreateClick:s,onEditClick:o,onUpdateAutomation:n}){const{displayLogs:r,setDisplayLogs:a}=ji(),[i,l]=p.useState("");p.useEffect(()=>{if(r){const b=t.find(g=>g.id===r.id);b&&a(b)}},[r,a,t]);const{mutate:c}=st({entityId:i,entityType:"Automation",name:"webhooks-action-delete",projection:["id"],optimisticallyMutate:!0,onError:b=>_e.error("Failed to delete:",b),action:"delete",onSuccess:n}),{mutate:u}=st({entityId:i,entityType:"Automation",name:"webhooks-automation-mutation",projection:["id"],optimisticallyMutate:!0,onError:b=>_e.error("Failed to update changes:",b),onSuccess:n}),d=p.useCallback(b=>{l(b),c({id:b}),ye("webhook-deleted",{automation_id:b})},[c]),m=p.useCallback(b=>{l(b.id),u(b)},[u]),h=p.useCallback(b=>{a(b)},[a]),f=p.useCallback(()=>{a(null)},[a]);return r?e.jsx(hh,{handleBackNavigation:f,onEditClick:o,webhook:r}):e.jsx(jh,{webhooks:t,onLogsClick:h,onStatusChange:m,onDelete:d,onCreateClick:s,onEditClick:o})}const wh=J(e.jsx("path",{d:"M7 11v2h10v-2zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),At=F({headers:{id:"ftrack-spark-components.headers-field-array.headers",defaultMessage:"Headers"},"headers-description":{id:"ftrack-spark-components.headers-field-array.headers-description",defaultMessage:"Include additional header properties to send along request."},"header-label":{id:"ftrack-spark-components.headers-field-array.header-label",defaultMessage:"Header"},"value-label":{id:"ftrack-spark-components.headers-field-array.value-label",defaultMessage:"Value"},"add-headers":{id:"ftrack-spark-components.headers-field-array.add-headers",defaultMessage:"Add headers"},"remove-header":{id:"ftrack-spark-components.headers-field-array.remove-header",defaultMessage:"Remove header"},"ascii-error-message":{id:"ftrack-spark-components.headers-field-array.ascii-error-message",defaultMessage:"Header keys and values can only contain basic characters like letters (A-Z, a-z), numbers (0-9), and basic punctuation marks."}});function vh(){const t=oe(),{control:s}=me(),{fields:o,append:n,remove:r}=ra({control:s,name:"headers"}),a=i=>{if(!i.match(/^[\p{ASCII}]*$/u))return t.formatMessage(At["ascii-error-message"])};return e.jsxs(e.Fragment,{children:[o.length?e.jsxs(C,{sx:{bgcolor:"action.hover",p:2,mt:0,pt:1,borderRadius:1,border:"1px solid",borderColor:"divider",overflow:"hidden",maxHeight:"65%"},children:[e.jsx(M,{variant:"subtitle1",children:e.jsx(x,{...At.headers})}),e.jsx(M,{sx:{color:"text.secondary"},children:e.jsx(x,{...At["headers-description"]})}),e.jsx(C,{sx:{overflow:"auto",maxHeight:"89%"},children:o.map((i,l)=>e.jsxs(C,{sx:{pt:2,display:"flex",gap:2,justifyContent:"space-between",maxHeight:300,overflow:"auto"},children:[e.jsx(Me,{size:"small",label:e.jsx(x,{...At["header-label"]}),variant:"outlined",name:`headers.${l}.header`,required:!0,validate:{isHeaderValid:c=>a(c)},sx:{flexGrow:1,width:"45%"}}),e.jsx(Me,{size:"small",label:e.jsx(x,{...At["value-label"]}),variant:"outlined",name:`headers.${l}.value`,required:!0,validate:{isHeaderValid:c=>a(c)},sx:{flexGrow:1,width:"45%"}}),e.jsx(Z,{title:e.jsx(x,{...At["remove-header"]}),children:e.jsx(ie,{onClick:()=>r(l),children:e.jsx(wh,{color:"error"})})})]},i.id))})]}):null,e.jsx(Ul,{label:e.jsx(x,{...At["add-headers"]}),icon:e.jsx(tn,{}),onClick:n,editable:!0,sx:{width:"fit-content"}})]})}const kr=2083,wr=128,Fe=F({endpoint:{id:"ftrack-spark-components.webhooks-form.endpoint",defaultMessage:"Configure endpoint"},name:{id:"ftrack-spark-components.webhooks-form.name",defaultMessage:"Name"},"name-helper-text":{id:"ftrack-spark-components.webhooks-form.name-helper-text",defaultMessage:"Name of the webhook configuration."},url:{id:"ftrack-spark-components.webhooks-form.url",defaultMessage:"Endpoint URL"},"url-helper-text":{id:"ftrack-spark-components.webhooks-form.url-helper-text",defaultMessage:"URL to send the webhook to. Only https protocol is supported."},"learn-more":{id:"ftrack-spark-components.webhooks-form.learn-more",defaultMessage:"Set up your webhook endpoint to receive events from ftrack or <link>learn more about webhooks</link>."},"max-character-limit":{id:"ftrack-spark-components.webhooks-form.max-character-limit",defaultMessage:"{fieldName} can only be up to {limit} characters."},"invalid-url":{id:"ftrack-spark-components.webhooks-form.invalid-url",defaultMessage:'URL must start with "https://".'}});function Sh(){const t=oe(),{control:s}=me();return e.jsx(C,{sx:{border:"none",bgcolor:"background.paper",width:"100%"},children:e.jsxs(ae,{spacing:2,sx:{height:"100%","& .MuiInputBase-input":{height:"auto"}},children:[e.jsxs(M,{variant:"h3",children:[e.jsx(x,{...Fe.endpoint}),e.jsx(M,{sx:{color:"text.secondary"},children:e.jsx(x,{...Fe["learn-more"],values:{link:o=>e.jsx(es,{target:"_blank",href:"https://developer.ftrack.com/extending-ftrack/webhooks",children:o})}})})]}),e.jsx(Me,{label:e.jsx(x,{...Fe.name}),name:"automation_name",required:!0,maxLength:{value:wr,message:t.formatMessage(Fe["max-character-limit"],{fieldName:t.formatMessage(Fe.name),limit:wr})},variant:"outlined",autoFocus:!0,helperText:e.jsx(x,{...Fe["name-helper-text"]}),size:"small",control:s}),e.jsx(Me,{label:e.jsx(x,{...Fe.url}),name:"webhook_url",required:!0,maxLength:{value:kr,message:t.formatMessage(Fe["max-character-limit"],{fieldName:t.formatMessage(Fe.url),limit:kr})},validate:{urlValidation:o=>{if(!o.startsWith("https://"))return t.formatMessage(Fe["invalid-url"])}},variant:"outlined",helperText:e.jsx(x,{...Fe["url-helper-text"]}),size:"small",control:s}),e.jsx(vh,{})]})})}const _h=J(e.jsx("path",{d:"M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-3 12.59L17.59 17 14 13.41 10.41 17 9 15.59 12.59 12 9 8.41 10.41 7 14 10.59 17.59 7 19 8.41 15.41 12z"})),Gt=F({create:{id:"ftrack-spark-components.webhooks-accordion-details.create",defaultMessage:"Create"},"create-description":{id:"ftrack-spark-components.webhooks-accordion-details.create-description",defaultMessage:"Trigger event when a new {entityType} is created."},"any-updates":{id:"ftrack-spark-components.webhooks-accordion-details.any-updates",defaultMessage:"Any updates"},"any-updates-description":{id:"ftrack-spark-components.webhooks-accordion-details.any-updates-description",defaultMessage:"Trigger when any properties of {entityType} are updated."},"update-on":{id:"ftrack-spark-components.webhooks-accordion-details.update-on",defaultMessage:"Update on"},"update-on-description":{id:"ftrack-spark-components.webhooks-accordion-details.update-on-description",defaultMessage:"Trigger when selected properties of {entityType} are updated."}}),Hs=p.memo(function({label:s,description:o=null,disabled:n,sx:r,name:a,control:i}){return e.jsx(Me,{name:a,control:i,renderInput:({field:{onChange:l,value:c,ref:u}})=>e.jsx(gt,{sx:r,disabled:n,label:e.jsxs(C,{sx:{py:.5},children:[e.jsx(M,{variant:"subtitle1",children:s}),e.jsx(M,{sx:{fontWeight:"fontWeightThin",fontSize:"fontSizeSmall",color:"text.secondary"},children:o})]}),control:e.jsx(ws,{inputRef:u,checked:c??!1,onChange:d=>{l(d.target.checked)},size:"small",disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0})})},a)}),Ih=p.memo(function({schema:s}){const{control:o}=me(),n=new Set(s.computed);return e.jsx(e.Fragment,{children:Object.entries(s.properties).sort((r,a)=>r[0]>a[0]?1:-1).map(r=>{const a="$ref"in r[1],i=r[1]?.type==="array"||r[1]?.type==="mapped_array";return a||i||n.has(r[0])||r[0]?.charAt(0)==="_"?null:e.jsx(Hs,{label:r[0],name:`entityTypes.${s.id}.properties.${r[0]}`,sx:{"& .MuiSvgIcon-root":{fontSize:"fontSizeRegular"},"& .MuiTypography-root":{fontSize:"fontSizeSmall"}},control:o},`${s.id}-${r[0]}`)})})}),Ch=p.memo(function({schema:s}){const{control:o}=me(),n=`entityTypes.${s.id}.event.update_on`,r=`entityTypes.${s.id}.event.update_any`,a=`entityTypes.${s.id}.event.create`,i=!!pt({name:n,control:o}),l=!!pt({name:r,control:o});return e.jsxs(ae,{sx:{"& .MuiFormControlLabel-root:hover":{bgcolor:"action.hover"}},children:[e.jsx(Hs,{label:e.jsx(x,{...Gt.create}),description:e.jsx(x,{...Gt["create-description"],values:{entityType:s.id}}),name:a,control:o}),e.jsx(Hs,{label:e.jsx(x,{...Gt["any-updates"]}),description:e.jsx(x,{...Gt["any-updates-description"],values:{entityType:s.id}}),name:r,disabled:i,control:o}),e.jsx(Hs,{label:e.jsx(x,{...Gt["update-on"]}),description:e.jsx(x,{...Gt["update-on-description"],values:{entityType:s.id}}),name:n,disabled:l,control:o}),i&&e.jsx(ae,{sx:{mx:3,pl:2,py:1,mt:.5,"& .MuiFormControlLabel-root:hover":{bgcolor:"action.hover"},border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"action.hover"},children:e.jsx(Ih,{schema:s})},`${s.id}-properties`)]},"events")}),vr=F({"selected-events":{id:"ftrack-spark-components.webhooks-accordion-title.selected-events",defaultMessage:"{count, plural, =1 {# event} other {# events}}"},warning:{id:"ftrack-spark-components.webhooks-accordion-title.warning",defaultMessage:"At least one property must be selected"}}),Mh=({schemaId:t,count:s=0,isWarning:o})=>e.jsxs(C,{sx:{display:"flex",width:"100%",justifyContent:"space-between",height:24,alignItems:"center"},children:[e.jsx(M,{children:t}),e.jsxs(C,{sx:{display:"flex",height:24,alignItems:"center",gap:1},children:[s>0&&e.jsx(De,{label:e.jsx(x,{...vr["selected-events"],values:{count:s}}),iconColor:"success.main",icon:e.jsx(Hl,{color:"success"})}),o&&e.jsx(Z,{title:e.jsx(x,{...vr.warning}),children:e.jsx(ql,{color:"warning"})})]})]}),Fs=F({"select-events":{id:"ftrack-spark-components.webhooks-accordions.select-events",defaultMessage:"Select events"},"search-placeholder":{id:"ftrack-spark-components.webhooks-accordions.search-placeholder",defaultMessage:"Search by schema name or property"},"empty-search-result":{id:"ftrack-spark-components.webhooks-accordions.empty-search-result",defaultMessage:"Couldn't find any event."},"learn-more":{id:"ftrack-spark-components.webhooks-accordions.learn-more",defaultMessage:"Set up type of events from ftrack or <link>learn more about schemas</link>."}}),Th=p.memo(function({schema:s}){const{control:o}=me(),n=pt({name:`entityTypes.${s.id}.properties`,control:o}),r=+!!pt({name:`entityTypes.${s.id}.event.create`,control:o}),a=+!!pt({name:`entityTypes.${s.id}.event.update_any`,control:o}),i=pt({name:`entityTypes.${s.id}.event.update_on`,control:o}),l=p.useMemo(()=>i?Object.values(n??{}).reduce((c,u)=>c+ +!!u,0):0,[n,i]);return e.jsx(ho,{title:e.jsx(Mh,{schemaId:s.id,count:l+r+a,isWarning:!l&&i}),size:"small",sx:{"&.MuiAccordion-root.Mui-expanded":{mb:1,mt:0}},children:e.jsx(Ch,{schema:s})},s.id)}),Eh=p.memo(function(){const s=H(),o=oe(),[n,r]=p.useState(""),a=p.useMemo(()=>s.schemas?.filter(l=>{const c=l.metadata?.entity_event&&!l.deprecated;return n?c&&(Object.entries(l.properties).some(u=>{const d=u[1]?.items&&Object.prototype.hasOwnProperty.call(u[1]?.items,"$ref");return u[0].toLowerCase().includes(n?.toLowerCase().trim())&&!d})||l.id.toLowerCase().includes(n?.toLowerCase().trim())):c}).sort((l,c)=>l.id>c.id?1:-1)??[],[n,s.schemas]),i=p.useCallback(l=>{r(l.target.value)},[]);return e.jsxs(C,{sx:{border:"none",bgcolor:"background.paper",overflow:"hidden",width:"100%"},children:[e.jsxs(M,{variant:"h3",sx:{mb:2},children:[e.jsx(x,{...Fs["select-events"]}),e.jsx(M,{sx:{color:"text.secondary"},children:e.jsx(x,{...Fs["learn-more"],values:{link:l=>e.jsx(es,{href:"https://developer.ftrack.com/api/schemas",target:"_blank",children:l})}})})]}),e.jsx(ca,{large:!0,disableClose:!0,iconColor:"text.primary",sx:{borderColor:"other.standardFieldLine","& input::placeholder":{color:"text.disabled"},"& .MuiSvgIcon-root":{color:"text.disabled"}},onChange:i,debounce:500,placeholder:o.formatMessage(Fs["search-placeholder"]),resetIcon:e.jsx(_h,{}),matches:n===""?null:a?.length}),e.jsx(C,{sx:{height:"82%",overflowY:"auto",bgcolor:"transparent","& .MuiAccordion-root":{mb:1,bgcolor:"action.hover"},my:2},children:a.length>0?a.map(l=>e.jsx(Th,{schema:l},l.id)):e.jsx(M,{sx:{color:"text.secondary",display:"flex",justifyContent:"center"},children:e.jsx(x,{...Fs["empty-search-result"]})})})]})}),Rh=({error:t})=>e.jsx(Z,{title:t,children:e.jsx(M,{sx:{maxWidth:"500px",color:"error.main",fontSize:"fontSizeSmall",mr:4,overflow:"hidden",textOverflow:"ellipsis",display:"flex",alignItems:"center","& .MuiSvgIcon-root":{mr:1}},children:t&&e.jsxs(e.Fragment,{children:[e.jsx(sn,{}),t]})})}),Do=F({cancel:{id:"ftrack-spark-components.webhooks-page.cancel",defaultMessage:"Cancel"},"create-webhook-button":{id:"ftrack-spark-components.webhooks-page.create-webhook-button",defaultMessage:"Create webhook"},"save-changes-button":{id:"ftrack-spark-components.webhooks-page.save-changes-button",defaultMessage:"Save changes"}}),Ph=({onCancel:t,onSubmit:s,error:o,mode:n})=>{const r=Ue(),a=xs(r.breakpoints.down("md"));return e.jsx(Kr,{sx:{p:4,height:"100%",bgcolor:"background.paper",borderRadius:1,overflow:"hidden",position:"relative",display:"flex"},children:e.jsxs("form",{onSubmit:s,style:{width:"100%"},children:[e.jsxs(C,{sx:{display:"flex",rowGap:2,height:"96%",pb:1,overflow:"hidden",[r.breakpoints.down("md")]:{flexDirection:"column"}},children:[e.jsx(Sh,{}),e.jsx(je,{orientation:a?"horizontal":"vertical",sx:{mx:2,height:"initial"}}),e.jsx(Eh,{})]}),e.jsxs(C,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsx(U,{variant:"outlined",color:"neutral",onClick:t,children:e.jsx(x,{...Do.cancel})}),e.jsxs(C,{sx:{display:"flex",alignItems:"center",maxHeight:"36px"},children:[e.jsx(Rh,{error:o}),e.jsx(U,{variant:"outlined",color:"primary",type:"submit",sx:{float:"right"},children:n==="create"?e.jsx(x,{...Do["create-webhook-button"]}):e.jsx(x,{...Do["save-changes-button"]})})]})]})]})})},Sr=({displayLogs:t,setDisplayLogs:s,children:o})=>e.jsx(yi.Provider,{value:{displayLogs:t,setDisplayLogs:s},children:o}),Ah=({filters:t})=>{const s={};return t?.forEach((o,n)=>{if(o.includes("entity.entity_type")){const r=o.substring(o.indexOf('"')+1,o.indexOf('" and '));if(o.includes('"create"')&&(s[`entityTypes.${r}.event.create`]=!0),o.includes("entity.new")){s[`entityTypes.${r}.event.update_on`]=!0;const a=o.substring(o.indexOf("entity.new.")+11,o.indexOf(" != "));s[`entityTypes.${r}.properties.${a}`]=!0}else o.includes("update")&&(s[`entityTypes.${r}.event.update_any`]=!0,s[`entityTypes.${r}.properties`]=null)}else if(o.includes("entity.new")){let r=null;for(let i=n-1;i>=0;i--)if(t[i].includes("entity.entity_type")){r=t[i].substring(t[i].indexOf('"')+1,t[i].indexOf('" and '));break}const a=o.substring(o.indexOf("entity.new.")+11,o.indexOf(" != "));r&&(s[`entityTypes.${r}.properties.${a}`]=!0)}}),s},ms=F({"event-count-error":{id:"ftrack-spark-components.webhooks-page.event-count-error",defaultMessage:"At least one event should be selected to create a webhook."},"property-error":{id:"ftrack-spark-components.webhooks-page.property-error",defaultMessage:'At least one property for "{entityType}" should to be selected.'},"create-webhook-success":{id:"ftrack-spark-components.webhooks-page.create-webhook-success",defaultMessage:"New webhook created successfully!"},"edit-webhook-success":{id:"ftrack-spark-components.webhooks-page.edit-webhook-success",defaultMessage:"{name} webhook edited successfully!"},"create-webhook-inactive":{id:"ftrack-spark-components.webhooks-page.create-webhook-inactive",defaultMessage:"Webhook created successfully but inactive due to number of webhooks exceeded limit of {count}"}}),_r=t=>Object.entries(t).map(([s,o])=>({[s]:o})),Lh=(t,s)=>{const o=[];for(const[n,{event:r,properties:a}]of Object.entries(t.entityTypes))if(r){if(r.create&&o.push(`(entity.entity_type = "${n}" and entity.operation = "create")`),r.update_on){const i=[];for(const l in a)a?.[l]&&i.push(`(entity.new.${l} != entity.old.${l})`);if(i.length)o.push(`(entity.entity_type = "${n}" and entity.operation = "update" and (${i.join(" or ")}))`);else throw new Error(s.formatMessage(ms["property-error"],{entityType:n}))}r.update_any&&o.push(`(entity.entity_type = "${n}" and entity.operation = "update")`)}return o},Dh=t=>{const s=t?.headers?.map(o=>({[`${o.header}`]:`${o.value}`}))??[];return Object.assign({},...s)},Oh=({formData:t,filter:s,headers:o,disableAutomation:n})=>{const r=Qe();return[X.create("Automation",{id:r,name:t.automation_name,...n?{enabled:!1}:{}}),X.create("Trigger",{automation_id:r,filter:s?`${s.join(" or ")}`:""}),X.create("WebhookAction",{automation_id:r,webhook_url:t.webhook_url,headers:JSON.stringify(o)})]},zh=p.memo(function(){const[s,o]=p.useState(),[n,r]=p.useState(),[a,i]=p.useState(),[l,c]=p.useState(null),u=H(),d=u.serverInformation?.max_automations??1/0,m=Ut({defaultValues:{automation_name:"",webhook_url:"",headers:[]}}),h=m.reset,f=oe(),{FT:b}=de(),{data:g,isLoading:y,refetch:j}=ve({name:"webhooks-list",entityType:"WebhookAction",projection:["id","webhook_url","headers","automation.id","automation.name","automation.enabled","automation.triggers.id","automation.triggers.filter","automation.created_at","automation.created_by","automation.description"],filter:"",orderBy:"automation.created_at desc",enabled:!n,limit:1e3}),{mutate:w}=st({entityId:a?.id??"",entityType:"WebhookAction",name:"webhooks-action-mutation",projection:["id"],optimisticallyMutate:!0,onError:k=>_e.error("Failed to update webhook actions:",k)}),{mutate:v}=st({entityId:a?.automation?.id??"",entityType:"Automation",name:"webhooks-automation-mutation",projection:["id"],optimisticallyMutate:!0,onError:k=>_e.error("Failed to update automation:",k)}),{mutate:I}=st({entityId:a?.automation?.triggers?.[0]?.id??"",entityType:"Trigger",name:"webhooks-trigger-mutation",projection:["id"],optimisticallyMutate:!0,onError:k=>_e.error("Failed to update trigger:",k)}),E=p.useCallback(()=>{h(),r(null)},[h]),L=p.useCallback(({filters:k})=>{const S=Ah({filters:k});Object.entries(S).forEach(([A,z])=>{m.setValue(A,z)})},[m]),_=p.useCallback(k=>{if(i(k),c(k),k.automation&&(m.setValue("automation_name",k.automation.name),m.setValue("webhook_url",k.webhook_url),k.automation.triggers)){const S=k.automation.triggers[0].filter?.replace(/[()]/g,"").split(" or ");L({filters:S})}if(!k.headers||k.headers==="{}")m.setValue("headers",[]);else{const S=JSON.parse(k?.headers);Object.entries(S).forEach((A,z)=>{m.setValue(`headers.${z}.header`,A[0]),m.setValue(`headers.${z}.value`,A[1])})}r("edit")},[m,c,L]),R=p.useCallback(async k=>{try{const S=Lh(k,f);if(S.length===0)throw new Error(f.formatMessage(ms["event-count-error"]));const A=Dh(k),z=g?.filter(T=>T.automation?.enabled)?.length;let P;if(n==="edit")w({webhook_url:k.webhook_url,headers:JSON.stringify(A)}),v({name:k.automation_name}),I({filter:S?`${S.join(" or ")}`:""}),P=f.formatMessage(ms["edit-webhook-success"],{name:k.automation_name}),ye("webhook-edited",{automation_name:k.automation_name,events:_r(k.entityTypes)});else{const T=Oh({formData:k,filter:S,headers:A,disableAutomation:!!(z&&z>=d)}),N=await u.call(T,{additionalHeaders:{...A}});P=z&&z>=d?f.formatMessage(ms["create-webhook-inactive"],{count:d}):f.formatMessage(ms["create-webhook-success"]),_e.debug("Create automation",N),ye("webhook-created",{automation_name:k.automation_name,events:_r(k.entityTypes)})}h(),o(void 0),r(null),b.notifySuccess(P)}catch(S){_e.error(S.message),o(S.message)}},[f,g,n,h,d,b,w,v,I,u]);return n?e.jsx(Sr,{displayLogs:l,setDisplayLogs:c,children:e.jsx(on,{...m,children:e.jsx(Ph,{onCancel:E,onSubmit:m.handleSubmit(R),error:s,mode:n})})}):e.jsxs(Sr,{displayLogs:l,setDisplayLogs:c,children:[y?e.jsx(C,{sx:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(rt,{sx:{display:"block",m:"3.2rem auto"}})}):null,!y&&g?.length===0?e.jsx(ph,{onCreateClick:()=>{r("create")}}):null,!y&&g&&g.length>0?e.jsx(kh,{webhooks:g,onUpdateAutomation:j,onCreateClick:()=>{m.reset(),r("create")},onEditClick:_}):null]})}),Fh=p.lazy(()=>$e(()=>import("../group_by_dialog-C1b6D7Wu.js"),__vite__mapDeps([30,1,2,6,3,10]),import.meta.url)),$h=t=>e.jsx(Gl,{component:Fh,...t}),Lt=F({"act-as-user-title":{id:"ftrack-spark-components.act-as-user-dialog.act-as-user-title",defaultMessage:"Act as user"},"act-as-user-description":{id:"ftrack-spark-components.act-as-user-dialog.act-as-user-description",defaultMessage:"Temporarily act as the user:"},"read-only-label":{id:"ftrack-spark-components.act-as-user-dialog.url-dialog.read-only-label",defaultMessage:"Read-only"},"read-only-enabled":{id:"ftrack-spark-components.act-as-user-dialog.url-dialog.read-only-enabled",defaultMessage:"User will only be able to perform read-only actions"},"read-only-disabled":{id:"ftrack-spark-components.act-as-user-dialog.url-dialog.read-only-disabled",defaultMessage:"User will be able to perform any action"},cancel:{id:"ftrack-spark-components.act-as-user-dialog.url-dialog.cancel",defaultMessage:"Cancel"},confirm:{id:"ftrack-spark-components.act-as-user-dialog.url-dialog.confirm",defaultMessage:"Confirm"}}),Nh=({onCancel:t,defaultValues:s})=>{const[o,n]=p.useState(s?.readOnly??!1),{data:r}=Vt({entityType:"BaseUser",entityId:s?.userId,projection:["first_name","last_name","thumbnail_id"],enabled:!!s?.userId,name:"act-as-user-dialog"}),a=H(),{FT:i}=de(),l=async c=>{c.preventDefault(),await a.call([{action:"assume_user",user_id:s?.userId,read_only:o}]).then(()=>{window.history.pushState("",document.title,window.location.pathname),window.location.reload()}).catch(u=>i.notifyError(u.message))};return e.jsx(We,{open:!0,onClose:()=>t(),PaperProps:{sx:{minWidth:"500px",p:3}},children:e.jsxs("form",{onSubmit:l,style:{marginBottom:0},children:[e.jsx(Oe,{sx:{p:0,mb:1},children:e.jsx(x,{...Lt["act-as-user-title"]})}),e.jsxs(Be,{sx:{p:0},children:[e.jsx(Ct,{sx:{mb:3},children:e.jsx(x,{...Lt["act-as-user-description"]})}),e.jsxs(C,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Zr,{entity:{first_name:r?.first_name,last_name:r?.last_name,thumbnail_id:r?.thumbnail_id}}),e.jsxs(M,{sx:{color:"text.primary",ml:1,fontWeight:"fontWeightMedium"},children:[r?.first_name," ",r?.last_name]})]}),e.jsx(gt,{control:e.jsx(lo,{name:"readOnly",checked:o,onChange:()=>n(!o),size:"small"}),sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%",ml:0,pb:4},label:e.jsxs(C,{children:[e.jsx(vs,{sx:{color:"text.primary"},children:e.jsx(x,{...Lt["read-only-label"]})}),e.jsx(uo,{sx:{fontSize:"fontSizeRegular"},children:o?e.jsx(x,{...Lt["read-only-enabled"]}):e.jsx(x,{...Lt["read-only-disabled"]})})]}),labelPlacement:"start"})]}),e.jsxs(Ve,{sx:{p:0},children:[e.jsx(U,{color:"neutral",onClick:()=>t(),children:e.jsx(x,{...Lt.cancel})}),e.jsx(U,{type:"submit",children:e.jsx(x,{...Lt.confirm})})]})]})})},ki=p.createContext({tag:null,setTag:()=>{},isCreatingNewTag:!1,setIsCreatingNewTag:()=>{},isEditing:!1,setIsEditing:()=>{},configurationId:""}),Ms=()=>{const t=p.use(ki);if(!t)throw new Error("useTagDialogContext must be used within a TagDialogContextProvider");return t},Wh=({configurationId:t,children:s})=>{const[o,n]=p.useState(null),[r,a]=p.useState(!1),[i,l]=p.useState(!1),c=p.useMemo(()=>({tag:o,setTag:n,isCreatingNewTag:r,setIsCreatingNewTag:a,isEditing:i,setIsEditing:l,configurationId:t}),[o,r,i,t]);return e.jsx(ki,{value:c,children:s})},Bh=()=>{const t=Math.floor(Math.random()*bs.length);return bs[t]},ke=F({"add-tag":{id:"ftrack-spark-components.tag-dialog.create-tag",defaultMessage:"Add tag"},select:{id:"ftrack-spark-components.tag-dialog.select",defaultMessage:"Select"},"missing-tags":{id:"ftrack-spark-components.tag-dialog.missing-tags",defaultMessage:"{inputText} is not matching any previously added tag. Do you want to add it as a new tag?"},"no-existing-tags":{id:"ftrack-spark-components.tag-dialog.no-existing-tags",defaultMessage:"Could not find any existing tags. Do you want to create a new tag?"},"cancel-button":{id:"ftrack-spark-components.tag-dialog.cancel-button",defaultMessage:"Cancel"},"edit-tag":{id:"ftrack-spark-components.tag-dialog.edit-tag",defaultMessage:"Edit tag"},"delete-tag":{id:"ftrack-spark-components.tag-dialog.delete-tag",defaultMessage:"Delete tag"},"name-label":{id:"ftrack-spark-components.tag-dialog.name-label",defaultMessage:"Name"},"confirm-delete-title":{id:"ftrack-spark-components.tag-dialog.confirm-delete-title",defaultMessage:"Confirm delete?"},"confirm-delete-description":{id:"ftrack-spark-components.tag-dialog.confirm-delete-description",defaultMessage:"{linkFound} Are you sure you want to delete {tagName}?"},"tag-link-found":{id:"ftrack-spark-components.tag-dialog.tag-link-found",defaultMessage:"This tag is linked to other entities."}}),Ir=({itemCount:t,isLoading:s,searchValue:o,onClose:n,onEditClose:r})=>{const a=!t,[i,l]=p.useState(a),{configurationId:c,isCreatingNewTag:u,isEditing:d}=Ms(),m=da({entityType:"Tag",entityData:{configuration_id:c}});p.useEffect(()=>{l(u||d?!0:a)},[a,u,d]);const h=()=>{l(b=>!b)},f=b=>{h(),n(b)};return m?s?e.jsx(rt,{}):i?e.jsx(C,{sx:{overflowY:"scroll"},children:e.jsx(Vh,{textInput:o,onCancel:f,onEditClose:r,isEmpty:a,itemCount:t})}):null:null},Vh=({textInput:t,onCancel:s,onEditClose:o,isEmpty:n,itemCount:r})=>{const[a,i]=p.useState(!1),[l,c]=p.useState(null),{handleSubmit:u,control:d,setValue:m}=Ut({mode:"onSubmit"}),h=H(),{configurationId:f,tag:b,setTag:g,setIsCreatingNewTag:y,isEditing:j,setIsEditing:w}=Ms();p.useEffect(()=>{t!==""&&m("tagName",t)},[t,m]);const{mutateAsync:v}=st({entityType:"Tag",entityId:b?.id||"",name:"edit-tag",projection:["id","name","color","configuration_id"],optimisticallyMutate:!0,onError:_=>{console.error("Failed to save changes:",_),c(_.message)}}),{mutateAsync:I}=st({entityId:b?.id??"",entityType:"Tag",name:"delete-tag",projection:["id"],action:"delete",onError:_=>{console.error("Failed to delete tag:",_),c(_.message)}}),E=async _=>{await h.create("Tag",{name:_.tagName,color:_.color,configuration_id:f,__entity_type__:"Tag"}).then(R=>{y(!1),s(R.data)}).catch(R=>{console.error(R),c(R.message)})},L=async _=>{j?(await v({name:_.tagName,color:_.color,configuration_id:f}),o(b),w(!1),g(null)):E(_)};return e.jsxs(C,{sx:{display:"flex",flexDirection:"column",border:"1px solid",borderColor:"primary.main",p:3,pb:1,my:2,width:"100%",borderRadius:2},onClick:_=>_.stopPropagation(),onMouseDown:_=>_.stopPropagation(),onKeyDown:_=>_.stopPropagation(),children:[e.jsx(Hh,{textInput:t,children:e.jsx(qh,{itemCount:r,textInput:t,isEditing:j,isEmpty:n})}),e.jsx("form",{onSubmit:u(L),autoComplete:"off",children:e.jsxs(C,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Xe,{name:"color",control:d,defaultValue:b?.color||Bh(),render:({field:{onChange:_,value:R,ref:k}})=>e.jsx(Za,{value:R,border:!0,onChange:_,ref:k})}),e.jsx(Me,{name:"tagName",autoFocus:!0,variant:"outlined",control:d,defaultValue:b?.name||t,label:e.jsx(x,{...ke["name-label"]}),required:!0,shrink:!0,onChange:()=>{l&&c(null)},sx:{width:"100%","& .Mui-focused":{backgroundColor:"transparent"}}})]}),e.jsxs(C,{sx:{display:"flex",flexDirection:"row",justifyContent:j?"space-between":"flex-end"},children:[j&&e.jsx(U,{sx:{color:"error.main"},onClick:()=>i(!0),children:e.jsx(x,{...ke["delete-tag"]})}),e.jsxs("div",{children:[!n&&e.jsx(U,{sx:{color:"text.secondary"},onClick:()=>{y(!1),w(!1),g(null),s(null)},children:e.jsx(x,{...ke["cancel-button"]})}),e.jsx(U,{"data-testid":"submit-button",type:"submit",children:j?e.jsx(x,{...ke["edit-tag"]}):e.jsx(x,{...ke["add-tag"]})})]})]}),l&&e.jsx(M,{sx:{color:"error.main"},children:l}),a&&e.jsx(p.Suspense,{fallback:null,children:e.jsx(Uh,{tag:b,configurationId:f,onClose:()=>i(!1),onConfirm:async()=>{await I({id:b?.id}),i(!1),w(!1),g(null)}})})]})})]})},Uh=({tag:t,configurationId:s,onClose:o,onConfirm:n})=>{const{data:r}=ve({name:"tag-link-count",entityType:"CustomAttributeLink",projection:["id"],enabled:!!t?.id,filter:`configuration_id is "${s}" and to_id is "${t?.id}"`,limit:1});return e.jsxs(We,{open:!0,onClose:o,children:[e.jsx(Oe,{children:e.jsx(x,{...ke["confirm-delete-title"]})}),e.jsx(aa,{sx:{pb:4},children:e.jsx(Ct,{children:e.jsx(x,{...ke["confirm-delete-description"],values:{tagName:e.jsx(M,{component:"span",sx:{fontWeight:"bold",color:"text.primary"},children:t?.name}),linkFound:r?.length&&e.jsx(x,{...ke["tag-link-found"]})}})})}),e.jsxs(Ve,{children:[e.jsx(U,{onClick:o,sx:{color:"text.secondary"},children:e.jsx(x,{...ke["cancel-button"]})}),e.jsx(U,{onClick:n,sx:{color:"error.main"},children:e.jsx(x,{...ke["delete-tag"]})})]})]})},Hh=({children:t})=>e.jsx(M,{sx:{fontSize:"fontSizeSmall",color:"text.secondary",mb:3},children:t}),qh=({itemCount:t,textInput:s,isEditing:o,isEmpty:n})=>{const r=e.jsx(M,{component:"span",sx:{color:"text.primary",fontWeight:"fontWeightBold",fontSize:"fontSizeSmall"},children:s});return t>0&&!o?null:s?e.jsx(x,{...ke["missing-tags"],values:{inputText:r}}):n?e.jsx(x,{...ke["no-existing-tags"]}):null},Gh=({children:t,ref:s,...o})=>e.jsx(aa,{sx:{height:"70vh",overflow:"hidden",display:"flex",flexDirection:"column"},ref:s,...o,children:t}),Kh=({entity:t})=>{const{setTag:s,setIsEditing:o}=Ms(),n=r=>{r.stopPropagation(),s(t),o(!0)};return e.jsx(Z,{title:e.jsx(x,{...ke["edit-tag"]}),children:e.jsx(ie,{size:"small",sx:{position:"absolute",right:"8px",display:"flex",alignSelf:"center",color:"text.primary"},onClick:n,children:e.jsx(Sn,{})})})},Yh=({children:t})=>{const{setIsCreatingNewTag:s}=Ms();return e.jsxs(C,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(U,{startIcon:e.jsx(cn,{}),onClick:()=>s(!0),sx:{"& .MuiButton-startIcon":{mr:.5}},children:e.jsx(M,{sx:{color:"primary.main",fontWeight:"fontWeightMedium"},children:e.jsx(x,{...ke["add-tag"]})})}),e.jsx("div",{children:t})]})},Jh=({contextId:t,disableContextFilterToggle:s,selected:o,onSelected:n,onClose:r})=>{const{configurationId:a,isCreatingNewTag:i,isEditing:l}=Ms(),c=i||l,u=`configuration_id is "${a}"`;return e.jsx(We,{open:!0,PaperProps:{sx:{width:"480px",py:2,px:1}},children:e.jsx(Kl,{entityType:"Tag",contextId:t,disableContextFilterToggle:s,selected:o,onSelected:n,onClose:r,saveButtonText:ke.select,mode:Yl.Multi,baseFilter:u,ContentComponent:Gh,ActionsComponent:Yh,CustomEntityListItem:Kh,CustomEmptyContent:Ir,BottomContent:Ir,renderListOption:!c})})},Qh=({configurationId:t,...s})=>e.jsx(Wh,{configurationId:t,children:e.jsx(Jh,{...s})}),Xh=[];function Zh({itemId:t}){const{data:s,mutate:o,isLoading:n}=hn({key:`${t}-pinned-dashboards`,select:r=>so(r),fallback:Xh});return{pinnedDashboardIds:s,updatePinnedDashboards:o,isPinnedLoading:n}}const eg=F({dashboards:{id:"ftrack-spark-components.page-top-header-tabs.dashboards",defaultMessage:"Configure dashboards"}}),tg=({defaultTabs:t,customDashboards:s,defaultSelectedTab:o,DashboardOptions:n,selectedItem:r,selectedTab:a,onTabChange:i,MoreElements:l,sortId:c,onDashboardSave:u})=>{const[d,m]=p.useState({id:null,anchor:null}),[h,f]=p.useState(o??!1),b=p.useRef(h),{pinnedDashboardIds:g,isPinnedLoading:y}=Zh({itemId:c}),j=p.useMemo(()=>s?(g??[]).map(P=>s?.find(T=>P===T.value)).filter(be):[],[s,g]),w=a??h,v=p.useMemo(()=>[...t??[],...s??[]].find(P=>P.value===w),[t,s,w]),I=p.useCallback((P,T)=>{f(T),T&&i?.(T)},[i]),E=p.useCallback((P,T,N)=>{f(T),T&&i?.(T),N?(b.current=w,m({id:"multi_menu",anchor:P.currentTarget})):m({id:null,anchor:null})},[w,i]),L=p.useCallback(P=>{P?.stopPropagation&&P.stopPropagation(),f(b.current),b.current&&i?.(b.current),m({id:null,anchor:null})},[b,i]),_=p.useMemo(()=>v?.isMultipleItemMenu&&Array.isArray(v.menuOptions)&&v.menuOptions?.length>0,[v]),R=p.useMemo(()=>{if(!j)return s??[];const P=j?.map(N=>N.value);return s?.filter(N=>!P?.includes(N.value))??[]},[j,s]),k=p.useCallback(P=>(P??[]).find(T=>T.value===a)??(P??[]).find(T=>T.value===w)??(P??[]).find(T=>T?.menuOptions?.some(N=>N.value===a)),[w,a]),S=p.useMemo(()=>k(R),[k,R]),A=p.useMemo(()=>y?[]:[...t??[],...j??[],...S?[S]:[]].filter(be),[y,t,j,S]),z=p.useMemo(()=>A?k(A)?.value:w,[k,w,A]);return e.jsxs(e.Fragment,{children:[e.jsxs(C,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,pr:1,width:"100%",justifyContent:"space-between",pl:c?0:2},children:[e.jsxs(C,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,width:"100%",minWidth:100},children:[A?.length?e.jsx(Jl,{variant:"scrollable",scrollButtons:!0,allowScrollButtonsMobile:!0,value:z,onChange:I,sx:{width:"100%","& .MuiTabs-scrollButtons.Mui-disabled":{opacity:c?.3:0,display:c?"flex":"none"},"& .MuiTab-root":{color:"text.primary",minHeight:"48px","& .MuiTypography-root":{fontSize:"fontSizeRegular"}},"& .MuiButtonBase-root.MuiTab-root":{textTransform:"initial"},"&.MuiTabs-indicator":{width:"100%"}},children:A.map((P,T)=>e.jsx(Ql,{value:P.value,label:e.jsx(Z,{title:P.label,children:e.jsxs(M,{sx:{textOverflow:c?"ellipsis":"inherit",overflow:c?"hidden":"initial",display:P.isMultipleItemMenu?"flex":"block",alignItems:"center",fontWeight:"fontWeightMedium"},children:[P.label,P.isMultipleItemMenu?e.jsx(Dc,{sx:{width:"16px",height:"16px"}}):null]})}),onClick:N=>P.isMultipleItemMenu?E(N,P.value,P.isMultipleItemMenu):P.onClick?.(),icon:P.icon,iconPosition:"start",disableRipple:!0,sx:{fontWeight:"fontWeightRegular","&.MuiTab-root":{textTransform:"capitalize",borderBottom:"none",maxWidth:c&&A.length-1!==T?172:void 0,minWidth:c?0:"max-content",whiteSpace:"nowrap",justifyContent:c?"flex-start":"center"},"& .MuiTab-icon":{ml:0},"& .Mui-selected":{color:"primary.main","&>.MuiBox-root .MuiSvgIcon-root":{color:"primary.main"}},"& .MuiSvgIcon-root":{fontSize:"fontSizeLarge",mr:.5}}},P.value))}):e.jsx(ys,{variant:"rectangular",animation:"wave",sx:{width:"100%",borderRadius:"8px",ml:1,bgcolor:"background.paper"}}),c&&e.jsx(Z,{title:e.jsx(x,{...eg.dashboards}),disableInteractive:!0,children:e.jsx(ie,{onClick:P=>m({id:"dashboard",anchor:P.currentTarget}),sx:{bgcolor:d.id==="dashboard"?"action.selected":"transparent","& .MuiSvgIcon-root":{fontSize:"2rem",color:"text.secondary",fontWeight:"fontWeightBold"}},children:e.jsx(Ar,{fontSize:"inherit"})})})]}),(l||c)&&e.jsx(C,{sx:{display:"flex",alignItems:"center",height:48,justifyContent:"space-between",gap:1},children:l||null})]}),(_||s)&&e.jsx(oo,{anchorEl:d.anchor,open:!!d.id,onClose:L,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{"& .MuiPaper-root ":{overflow:"hidden"}},children:d.id==="dashboard"&&n?e.jsx(n,{onMenuItemClicked:()=>m({id:null,anchor:null}),onDashboardSave:u}):d.id==="multi_menu"&&h?e.jsx(sg,{menuOptions:t?.find(P=>P.value===h)?.menuOptions??[],onMenuItemClicked:()=>m({id:null,anchor:null}),selectedItem:r}):null})]})},sg=({menuOptions:t,onMenuItemClicked:s,selectedItem:o})=>t.map(n=>[e.jsxs(tt,{selected:n.value===o,onClick:()=>{s(),n.onClick(n)},children:[e.jsx(Le,{children:n.icon}),e.jsx(we,{children:n.label})]},"multi_menu_"+n.value)]),fs=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];function Wt(t){return t?.start&&t?.end?"period":"default"}function og({workSchedules:t}){const o=t.filter(r=>r.start&&r.end).map(r=>K.utc(r.end));return K.max(o)||K().utc()}function wi(t){const o=og({workSchedules:t}).utc().startOf("day"),n=o.add(1,"month").add(1,"day").startOf("day");return{start:o.toISOString(),end:n.toISOString()}}const ng=({duration:t,userId:s,workweek:o,workday_length:n,workSchedules:r})=>{const a=t==="period"?wi(r??[]):{start:void 0,end:void 0};return{id:Qe(),resource_id:s||"",start:a.start,end:a.end,schedule_data:fs.map((i,l)=>({[i]:o.includes(l)?n/(60*60):0})).reduce((i,l)=>({...i,...l}),{}),created_at:zo(K())}};function rg(t){return t?Object.values(t).reduce((s,o)=>s+o,0):0}function ag(t,s){return t?.some((o,n)=>Wt(o)==="default"&&n!==s)??!1}function ig(t,s){return t?t.map((o,n)=>n===s||!o.start||!o.end?null:{start:K.utc(o.start),end:K.utc(o.end)}).filter(be):[]}function lg(t,s){return t&&s?`${K.utc(t).format("ll")} - ${K.utc(Gs(s)).format("ll")}`:null}function cg(t){return t==="period"}K.extend(ia);function dg(t){if(!K(t).isValid())return"Invalid date format."}function ug(t,s,o){if(t&&s&&K(t).isAfter(K(s)))return o}function pg(t,s,o){if(s&&t&&K(t).isBefore(K(s)))return o}function mg(t,s){const o=t?.filter(n=>Wt(n)==="default");if(o&&o.length>1)return s}function fg(t){const s=t?.filter(n=>Wt(n)==="period"&&n?.start&&n?.end)||[];if(s.length<=1)return;const o=s.map(n=>({start:K.utc(n.start),end:K.utc(n.end)})).sort((n,r)=>n.start.valueOf()-r.start.valueOf());for(let n=0;n<o.length-1;n++){const r=o[n],a=o[n+1];if(r.end.isAfter(a.start))return{schedule1:r,schedule2:a}}}function hg(t,s){const o=fg(t);if(o)return s(o.schedule1.start.format("ll"),K.utc(Gs(o.schedule1.end)).format("ll"),o.schedule2.start.format("ll"),K.utc(Gs(o.schedule2.end)).format("ll"))}function gg(t,s){const o=mg(t,s.multipleDefaults);if(o)return o;const n=hg(t,s.overlapping);if(n)return n}const xg=J(e.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}));function bg(t){return Te("MuiAccordionActions",t)}Ee("MuiAccordionActions",["root","spacing"]);const yg=t=>{const{classes:s,disableSpacing:o}=t;return Re({root:["root",!o&&"spacing"]},bg,s)},jg=le("div",{name:"MuiAccordionActions",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,!o.disableSpacing&&s.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",variants:[{props:t=>!t.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),kg=p.forwardRef(function(s,o){const n=He({props:s,name:"MuiAccordionActions"}),{className:r,disableSpacing:a=!1,...i}=n,l={...n,disableSpacing:a},c=yg(l);return e.jsx(jg,{className:ue(c.root,r),ref:o,ownerState:l,...i})}),wg=J(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z"})),vg=J(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),Dt=F({sunday:{id:"ftrack-spark-components.work-schedule-dialog.sunday",defaultMessage:"Sunday"},monday:{id:"ftrack-spark-components.work-schedule-dialog.monday",defaultMessage:"Monday"},tuesday:{id:"ftrack-spark-components.work-schedule-dialog.tuesday",defaultMessage:"Tuesday"},wednesday:{id:"ftrack-spark-components.work-schedule-dialog.wednesday",defaultMessage:"Wednesday"},thursday:{id:"ftrack-spark-components.work-schedule-dialog.thursday",defaultMessage:"Thursday"},friday:{id:"ftrack-spark-components.work-schedule-dialog.friday",defaultMessage:"Friday"},saturday:{id:"ftrack-spark-components.work-schedule-dialog.saturday",defaultMessage:"Saturday"}}),Sg={0:e.jsx(x,{...Dt.sunday}),1:e.jsx(x,{...Dt.monday}),2:e.jsx(x,{...Dt.tuesday}),3:e.jsx(x,{...Dt.wednesday}),4:e.jsx(x,{...Dt.thursday}),5:e.jsx(x,{...Dt.friday}),6:e.jsx(x,{...Dt.saturday})},_g=p.memo(({scheduleIndex:t,locale:s=navigator.language,workdayLength:o,weekStart:n})=>{const{control:r,setValue:a}=me(),i=pt({name:"work_schedules",control:r}),c=new Intl.NumberFormat(s,{style:"unit",unit:"hour",unitDisplay:"narrow"}).format(1).replace(/[0-9\s.,]+/g,"").trim(),u=n?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6];return Array.from(u,(d,m)=>{const h=i?.[t]?.schedule_data?.[fs[d]]>0;return e.jsxs(Bt,{sx:{"&.MuiListItem-root .MuiTextField-root":{width:"100%"}},children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center",flexGrow:1,justifyContent:"flex-start",gap:1.5},children:[e.jsx(Me,{name:`work_schedules.${t}.schedule_data.${[fs[d]]}`,renderInput:({field:{onChange:f,value:b,ref:g}})=>e.jsx(gt,{label:"",control:e.jsx(ws,{slotProps:{input:{ref:g}},icon:e.jsx(vg,{}),checkedIcon:e.jsx(wg,{}),checked:b,onChange:y=>{f(y.target.checked?o:0),a(`work_schedules.${t}.schedule_data.${[fs[d]]}`,y.target.checked?o:0)}})})}),e.jsx(M,{sx:{color:h?"text.primary":"text.secondary"},children:Sg[Number(d)]})]}),e.jsx(Me,{sx:{width:160},name:`work_schedules.${t}.schedule_data.${[fs[d]]}`,renderInput:({field:{onChange:f,value:b,ref:g},id:y,fieldState:{error:j}})=>e.jsx(gs,{variant:"outlined",size:"small",type:"number",label:"",id:y,onChange:w=>f(Number(w.target.value)),value:b?.toString(),inputRef:g,slotProps:{htmlInput:{step:.5,min:0,max:24},input:{error:!!j,sx:{"& .MuiInputBase-input":{mr:1},color:h?"text.primary":"text.secondary"},endAdornment:e.jsx(Wr,{position:"end",children:c})}},sx:{alignItems:"end"}})})]},t.toString()+m)})}),vi=452,Cr=p.memo(({scheduleIndex:t,fieldType:s,displayWeekNum:o,dateRanges:n,label:r,errorMessage:a})=>{const{control:i}=me(),l=p.useCallback(u=>n.some(d=>(u.isAfter(d.start)||u.isSame(d.start,"day"))&&u.isBefore(d.end)),[n]),c=s==="start";return e.jsx(Me,{control:i,name:`work_schedules.${t}.${s}`,sx:{flex:1,"& .MuiFormControl-root.MuiTextField-root .MuiInputAdornment-root":{pb:0}},required:!0,validate:{isValidFormat:dg,dateRangeValidation:(u,d)=>{const m=c?"end":"start",h=d.work_schedules?.[t]?.[m];return c?ug(u,h,a):pg(u,h,a)}},renderInput:({field:{onChange:u,value:d,ref:m},fieldState:{error:h}})=>{const f=c||!d?Ln(d):Ln(Gs(d));return e.jsx(Oo,{inputRef:m,onChange:b=>{const g=K.utc(b).startOf("day"),y=c?g.toISOString():Xl(g);u(y)},value:f,size:"small",displayWeekNumber:o,shouldDisableDate:l,slotProps:{textField:{required:!0,variant:"outlined",label:r,error:!!h}}})}})}),Ae=F({duration:{id:"ftrack-spark-components.work-schedule-dialog.duration",defaultMessage:"Duration"},"start-date":{id:"ftrack-spark-components.work-schedule-dialog.start-date",defaultMessage:"Start date"},"end-date":{id:"ftrack-spark-components.work-schedule-dialog.end-date",defaultMessage:"End date"},title:{id:"ftrack-spark-components.work-schedule-dialog.title",defaultMessage:"Work schedule"},delete:{id:"ftrack-spark-components.work-schedule-dialog.delete",defaultMessage:"Delete"},"all-time":{id:"ftrack-spark-components.work-schedule-dialog.all-time",defaultMessage:"Default"},"selected-period":{id:"ftrack-spark-components.work-schedule-dialog.selected-period",defaultMessage:"Selected period"},"help-duration":{id:"ftrack-spark-components.work-schedule-dialog.help-duration",defaultMessage:"Can have only one default schedule per user."},"error-start-date":{id:"ftrack-spark-components.work-schedule-dialog.error-start-date",defaultMessage:"Start date must be before end date."},"error-end-date":{id:"ftrack-spark-components.work-schedule-dialog.error-end-date",defaultMessage:"End date must be after start date."},success:{id:"ftrack-spark-components.work-schedule-dialog.success",defaultMessage:"Saved changes"},warning:{id:"ftrack-spark-components.work-schedule-dialog.warning",defaultMessage:"Unsaved changes"},error:{id:"ftrack-spark-components.work-schedule-dialog.error",defaultMessage:"Errors present"},week:{id:"ftrack-spark-components.work-schedule-dialog.week",defaultMessage:"week"}}),Ig=p.memo(({weeklyTotalHours:t,locale:s,hasErrors:o,dateTextInTitle:n})=>{const r=oe(),a=new Intl.NumberFormat(s,{style:"unit",unit:"hour",unitDisplay:"narrow"}).format(t);return e.jsxs(e.Fragment,{children:[e.jsxs(M,{sx:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",display:"flex",gap:"4px",alignItems:"center"},children:[o?e.jsx(Z,{title:e.jsx(x,{...Ae.error}),placement:"left",children:e.jsx(ec,{color:"error"})}):null,e.jsx("span",{className:"dateSummary",children:n})]}),e.jsx(tc,{label:`${a}/${r.formatMessage(Ae.week)}`,color:"blue.main"})]})}),Cg=p.memo(({scheduleIndex:t,displayWeekNum:s,disabledDateRanges:o})=>{const n=oe();return e.jsxs(C,{sx:{display:"flex",gap:2,flexGrow:1,my:1},children:[e.jsx(Cr,{scheduleIndex:t,fieldType:"start",displayWeekNum:s,dateRanges:o,label:n.formatMessage(Ae["start-date"]),errorMessage:n.formatMessage(Ae["error-start-date"])}),e.jsx(Cr,{scheduleIndex:t,fieldType:"end",displayWeekNum:s,dateRanges:o,label:n.formatMessage(Ae["end-date"]),errorMessage:n.formatMessage(Ae["error-end-date"])})]})}),Mg=p.memo(({scheduleIndex:t,isDefaultDurationDisabled:s})=>{const o=oe(),{setValue:n,getValues:r,watch:a}=me(),i=a(`work_schedules.${t}`),l=Wt(i),c=p.useCallback(u=>{if(u.target.value==="period"){const m=wi(r("work_schedules"));n(`work_schedules.${t}.start`,m.start),n(`work_schedules.${t}.end`,m.end)}else n(`work_schedules.${t}.start`,void 0),n(`work_schedules.${t}.end`,void 0)},[r,t,n]);return e.jsxs(C,{sx:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",display:"flex"},children:[e.jsx(vs,{component:"legend",sx:{mb:0},children:e.jsxs(C,{component:"span",sx:{display:"inline-flex",alignItems:"center"},children:[e.jsx(x,{...Ae.duration}),e.jsx(oa,{text:o.formatMessage(Ae["help-duration"])})]})}),e.jsxs(Zl,{value:l,onChange:c,row:!0,children:[e.jsx(gt,{value:"default",control:e.jsx(Dn,{}),label:e.jsx(x,{...Ae["all-time"]}),disabled:s}),e.jsx(gt,{value:"period",control:e.jsx(Dn,{}),label:e.jsx(x,{...Ae["selected-period"]})})]})]})}),Tg=p.memo(({field:t,scheduleIndex:s,expanded:o,onToggle:n,onRemove:r,displayWeekNum:a,locale:i,workdayLength:l,weekStart:c})=>{const{control:u,formState:d}=me(),m=d?.errors?.work_schedules,h=Array.isArray(m)?m[s]:void 0,f=pt({name:"work_schedules",control:u}),b=f?.[s],g=p.useMemo(()=>rg(b?.schedule_data),[b?.schedule_data]),y=p.useMemo(()=>ag(f,s),[f,s]),j=p.useMemo(()=>ig(f,s),[s,f]),w=p.useMemo(()=>{const I=lg(b?.start,b?.end);return Wt(b)==="period"?I:e.jsx(x,{...Ae["all-time"]})},[b]),v=cg(Wt(b));return e.jsx(ho,{disableGutters:!0,expanded:o===s,sx:{"&.MuiAccordion-root":{border:1,borderColor:h?"error.main":"divider",borderRadius:1,mb:1,width:vi,"& .dateSummary":{whiteSpace:"nowrap"},"& .MuiAccordionSummary-content":{display:"flex",alignItems:"center",justifyContent:"space-between"},"& .MuiAccordionDetails-root":{pt:1,pb:0}},borderBottom:1,borderColor:"divider"},onChange:(I,E)=>n(E,s),title:e.jsx(Ig,{weeklyTotalHours:g??0,locale:i,hasErrors:!!h,dateTextInTitle:w}),children:e.jsxs(e.Fragment,{children:[e.jsx(Mg,{scheduleIndex:s,isDefaultDurationDisabled:y}),v&&e.jsx(Cg,{scheduleIndex:s,displayWeekNum:a,disabledDateRanges:j}),e.jsx(St,{sx:{px:2,py:.5,borderRadius:1,mt:.5,backgroundColor:"background.paper","& .MuiListItem-root":{display:"flex",gap:1,alignItems:"center",px:0,justifyContent:"space-between",py:.5,"& .MuiTextField-root":{width:"50%"}}},children:e.jsx(_g,{scheduleIndex:s,locale:i,workdayLength:l,weekStart:c})}),e.jsx(kg,{children:e.jsx(U,{color:"error",onClick:()=>r(s),children:e.jsx(x,{...Ae.delete})})})]})},t.id)}),Mr=F({empty:{id:"ftrack-spark-components.work-schedule-dialog.empty",defaultMessage:"No work schedules created."},help:{id:"ftrack-spark-components.work-schedule-dialog.help",defaultMessage:"Click <style>Add Work Schedule</style> to create one."}}),Eg=p.memo(()=>e.jsx(hs,{icon:e.jsx(xg,{}),label:e.jsx(x,{...Mr.help,values:{style:t=>e.jsx("span",{style:{fontStyle:"italic"},children:t})}}),header:e.jsx(x,{...Mr.empty}),sx:{"& h2":{mb:1},"& h5":{fontSize:"fontSizeRegular"}}})),Rg=({workdayLength:t,weekStart:s,setExpanded:o,expanded:n,workSchedules:r,onRemove:a})=>{const{displayWeekNum:i}=la(),l=H().serverInformation?.preferred_language,c=Zo(l),u=p.useCallback(m=>{a(m),!(m===0&&r?.length===1)&&o(m===0?0:m-1)},[r?.length,a,o]),d=p.useCallback((m,h)=>{o(m?h:!1)},[o]);return r?.length?e.jsx(e.Fragment,{children:r?.map((m,h)=>e.jsx(Tg,{field:m,scheduleIndex:h,expanded:n,onToggle:d,onRemove:u,displayWeekNum:i,locale:c,workdayLength:t,weekStart:s},m.id))}):e.jsx(Eg,{})};K.extend(sc);const is=F({cancel:{id:"ftrack-spark-components.work-schedule-dialog.cancel",defaultMessage:"Cancel"},save:{id:"ftrack-spark-components.work-schedule-dialog.save",defaultMessage:"Save"},description:{id:"ftrack-spark-components.work-schedule-dialog.description",defaultMessage:"Manage work schedules for <style>{user}</style>."},title:{id:"ftrack-spark-components.work-schedule-dialog.title",defaultMessage:"Work schedules"},add:{id:"ftrack-spark-components.work-schedule-dialog.add",defaultMessage:"Add work schedule"},success:{id:"ftrack-spark-components.work-schedule-dialog.success",defaultMessage:"Successfully updated work schedule."}}),Pg=p.memo(({record:t,error:s,isSaving:o})=>{const[n,r]=p.useState(0),{workweek:a,workday_length:i,weekStartDay:l}=la(),{formState:c,control:u}=me(),{setConfirmClose:d,handleCancel:m}=ao();d(c.isDirty);const h=pt({name:"work_schedules",control:u}),{append:f,fields:b,remove:g}=ra({name:"work_schedules",control:u}),y=p.useCallback(()=>{const j=h?.some(v=>Wt(v)==="default")?"period":"default",w=ng({duration:j,userId:t.userid,workweek:a,workday_length:i,workSchedules:h});f(w),r(b.length)},[f,b.length,t.userid,h,i,a]);return e.jsxs(p.Suspense,{fallback:e.jsx(oc,{children:e.jsx(rt,{sx:{display:"flex",m:"auto",top:0,left:0,right:0,bottom:0,position:"absolute",zIndex:"tooltip"},size:45})}),children:[e.jsx(Oe,{onClose:m,children:e.jsx(x,{...is.title})}),e.jsxs(Be,{children:[e.jsx(Ct,{sx:{fontWeight:"fontWeightMedium"},children:e.jsx(x,{...is.description,values:{user:t?.firstname+" "+t?.lastname||"user",style:j=>e.jsx(C,{component:"span",sx:{fontWeight:"fontWeightBold"},children:j})}})}),e.jsx(ae,{sx:{display:"flex",mt:1,height:"67vh"},children:e.jsx(Rg,{workdayLength:i/(60*60),weekStart:l,expanded:n,setExpanded:r,workSchedules:b,onRemove:g})})]}),e.jsxs(Ve,{sx:{mt:2,display:"flex",flexDirection:"column",height:73,pl:3,pr:2},children:[s&&e.jsx(M,{maxWidth:vi,sx:{color:"error.main",fontSize:"fontSizeSmall",display:"flex",alignItems:"center","& .MuiSvgIcon-root":{mr:1},alignSelf:"baseline",mb:1,pl:2},children:e.jsxs(e.Fragment,{children:[e.jsx(sn,{}),s]})}),e.jsxs(C,{sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx(U,{variant:"outlined",onClick:y,type:"button",startIcon:e.jsx(tn,{}),sx:{height:32},children:e.jsx(x,{...is.add})}),e.jsxs(C,{children:[e.jsx(U,{sx:{color:"neutral.main"},onClick:()=>m(),type:"button",children:e.jsx(x,{...is.cancel})}),e.jsx(U,{type:"submit",disabled:!c.isDirty||o,children:e.jsx(x,{...is.save})})]})]})]})]})}),Tr=F({"more-default-error":{id:"ftrack-spark-components.work-schedule-dialog.more-default-error",defaultMessage:"A user can have only one 'default' work schedule."},"overlapping-error":{id:"ftrack-spark-components.work-schedule-dialog.overlapping-error",defaultMessage:"Work schedule periods cannot overlap. Found overlap between {schedule1} and {schedule2}."}}),Ag=p.memo(({onCancel:t,record:s,workSchedules:o,mutateWorkSchedules:n})=>{const[r,a]=p.useState(),i=oe(),l=Ut({mode:"onTouched",defaultValues:{work_schedules:o}}),c=p.useCallback(async d=>{try{const m=gg(d.work_schedules,{multipleDefaults:i.formatMessage(Tr["more-default-error"]),overlapping:(h,f,b,g)=>i.formatMessage(Tr["overlapping-error"],{schedule1:`${h} - ${f}`,schedule2:`${b} - ${g}`})});if(m)throw new Error(m);await n.mutateAsync(d.work_schedules||[]),t()}catch(m){a(m.message)}},[i,n,t]),u=d=>{if(d.key==="Enter")if(d.metaKey||d.ctrlKey)l.handleSubmit(c)();else{d.preventDefault();return}};return e.jsx(on,{...l,children:e.jsx(We,{open:!0,slotProps:{paper:{sx:{minWidth:512}}},children:e.jsx("form",{onSubmit:l.handleSubmit(c),style:{width:"100%"},onKeyDown:u,children:e.jsx(Pg,{record:s,error:r,isSaving:n.isPending})})})})}),Lg=F({success:{id:"ftrack-spark-components.work-schedule-dialog.success",defaultMessage:"Successfully updated work schedule."}}),Dg=(t,s)=>{const o={start:t.start??void 0,end:t.end??void 0,schedule_data:t.schedule_data},n={start:s.start,end:s.end,schedule_data:s.schedule_data};return!nc(o,n)},Og=(t,s,o)=>{const n=[],r=new Set(s.map(l=>l.id)),a=new Set(t.map(l=>l.id));for(const l of t)if(r.has(l.id)){const u=s.find(d=>d.id===l.id);if(u&&Dg(u,l)){const d={resource_id:o,start:l.start,end:l.end,schedule_data:l.schedule_data,created_at:zo(K())};n.push(X.update("WorkSchedule",[l.id],d))}}else{const u={resource_id:o,start:l.start,end:l.end,schedule_data:l.schedule_data,created_at:zo(K())};n.push(X.create("WorkSchedule",u))}const i=Array.from(r).filter(l=>!a.has(l)).map(l=>X.delete("WorkSchedule",[l]));return n.push(...i),n},zg=t=>Hr({entityType:"WorkSchedule",name:"work-schedule",projection:["id","start","end","schedule_data","created_at"],filter:`resource_id is "${t}"`,orderBy:"start",limit:1e3}),Fg=({onCancel:t,record:s})=>{const o=H(),n=oe(),{FT:r}=de(),a=zg(s?.userid||""),{data:i}=Ur(a),l=eo(),c=to({mutationFn:async u=>{const d=Og(u,i,s?.userid||"");await o.call(d)},onSuccess:()=>{l.removeQueries(a),r.notifySuccess(n.formatMessage(Lg.success))}});return e.jsx(ro,{open:!0,onCancel:t,slotProps:{paper:{sx:{minWidth:"480px"}}},children:e.jsx(Ag,{onCancel:t,record:s,workSchedules:i,mutateWorkSchedules:c})})},$g=Object.freeze(Object.defineProperty({__proto__:null,ActAsUserDialog:Nh,ActionsForm:rc,AddProjectAccessDialog:li,ChangeProjectRoleDialog:di,CustomAttributeLinksFilter:ac,DateTimePicker:ic,DisableTwoFactorDialog:lc,EntityPicker:On,EntityPickerModal:On,GenerateBackupCodesDialog:cc,GroupByDialog:$h,IPAllowList:dh,Insights:Mf,ManageStatusPermissionsDialog:ui,ModeSwitch:dc,MyTasksScheduler:If,PageTopHeaderTabs:tg,PersistedAvailableTasksSettings:Af,PersistedSplitTaskDialog:uc,ProjectAccessSwitch:Yr,ProjectColorPicker:mi,ProjectSetupDialog:Xm,RemoteConfigurationTour:hi,ReviewProSplashScreenWithLink:pc,ReviewProSplashScreenWithText:mc,SetThumbnailDialog:gi,SplitTaskDialog:fc,TagDialog:Qh,TrialExpiryButton:Qa,TwoFactorDialog:hc,UrlDialog:xn,UserRoleDialog:ai,WebhooksWidget:zh,WorkScheduleDialog:Fg},Symbol.toStringTag,{value:"Module"}));function Ng(){const[t,s]=p.useState([]),o=H(),n=p.useRef(!1);return p.useEffect(()=>{if(n.current)return;n.current=!0;function r({component:l,props:c={},domNode:u}){const d=zn.createPortal(e.jsx(Fn,{children:e.jsx(l,{...c})}),u);return _e.debug("spark-mount",d),s(m=>[...m,d]),{component:d}}function a(l){_e.debug("spark-unmount",l),s(c=>c.filter(u=>u!==l))}function i({oldRenderedComponent:l,newComponent:c,props:u,domNode:d}){const m=zn.createPortal(e.jsx(Fn,{children:e.jsx(c,{...u})}),d);return _e.debug("spark-update",l,m),s(h=>h.map(f=>f===l?m:f)),{component:m}}window.ftrackSpark={i18n:im,getSession:Qt,components:$g,mountComponent:r,unmountComponent:a,updateComponent:i,initialized:new Promise(l=>{for(const c of window.ExtList??[]){const u=document.createElement("script");u.type="text/javascript",u.src=c,u.async=!1,c===window.ExtList[window.ExtList.length-1]&&(u.onload=()=>{window.Ext.onReady(function(){var d,m=window.Ext.decode(window.__directDescriptors__);for(d=0;d<m.length;d++){const h=m[d].remoteAPI;window.Ext.Direct.addProvider(h)}window.FTrack.loadFTrack("web",{defaultModule:window.__defaultModule__}),l(window.ftrackSpark)})}),document.head.appendChild(u)}})}},[o]),t}K.extend(ia);K.extend(gc);const Wg=xc([{path:"/*",element:e.jsx(Up,{})}]),Je=Qt();function Er({dayJsLocale:t,workspaceTimezone:s,messages:o,locale:n}){const[r,a]=p.useState(window.document.documentElement.getAttribute("data-theme")==="dark"?"dark":"light");return Hp(window.document.documentElement,p.useCallback(i=>{for(const l of i)if(l.type==="attributes"){const c=l.target.getAttribute("data-theme");a(c==="dark"?"dark":"light")}},[]),{attributes:!0}),e.jsx(_c,{name:"overview",updateProps:{},children:e.jsx(Ic,{session:Je,children:e.jsx(Cc,{injectFirst:!0,children:e.jsx(Mc,{theme:r==="light"?Tc:Ec,children:e.jsx(Rc,{onError:i=>{if(i.code!=="MISSING_TRANSLATION")throw i},locale:n,timeZone:s,messages:o,defaultLocale:"en-US",textComponent:"span",children:e.jsx(Pc,{dateAdapter:Oc,adapterLocale:t?.name,children:e.jsx(td,{children:e.jsxs(Kp,{children:[e.jsx(Yp,{}),e.jsxs(Nc,{children:[e.jsx(Qp,{children:e.jsx(Ng,{})}),e.jsx(Ac,{router:Wg})]})]})})})})})})})})}async function Bg(){const t=bc.createRoot(document.getElementById("app"));try{if(await Je.initializing,!Je.serverInformation)throw new Error("No server information available");yc(Je);const s=Je.serverInformation.preferred_language,o=Je.serverInformation.i18n_message_url_ftrack_spark_overview,n=Je.serverInformation.use_workspace_timezone_enabled&&Je.serverInformation.workspace_timezone?Je.serverInformation.workspace_timezone:Intl.DateTimeFormat().resolvedOptions().timeZone;K.tz.setDefault(n);const{language:r,locale:a}=jc(s),i=Je.serverInformation.week_startday,l=await kc(a,{weekStart:i}),c=await(o?wc(o):vc(r));t.render(e.jsx(Er,{dayJsLocale:l,workspaceTimezone:n,messages:c,locale:a}))}catch(s){console.error("Error initializing app",s),s instanceof Error&&Sc(s)&&Ne({view:"about",itemId:"newconfigure"}),t.render(e.jsx(Er,{dayJsLocale:"en",messages:{},locale:"en"}))}}Bg();export{Lp as A,qg as H,Hg as M,tg as P,Qp as S,Pp as a,Zh as u};
//# sourceMappingURL=-CW7a5z4x.js.map
